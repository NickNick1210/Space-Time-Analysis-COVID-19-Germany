Jade Hochschule - Standort Oldenburg<br>
Fachbereich: Bauwesen Geoinformation Gesundheitstechnologie<br>
Studiengang: Geoinformationswissenschaften (M.Sc.)

<center><img src="https://www.jade-hs.de/fileadmin/_migrated/pics/Logo_JadeHochschule_7.jpg" width="400" /></center>

# <center>Raumzeitliche Analyse der Ausbreitung von COVID-19 in Deutschland</center>

**<center>Masterprojekt<br>
Wintersemester 2021/22</center>**

Erarbeitet von: &hairsp; Ricarda Sodermanns (6020924), ricarda.sodermanns@student.jade-hs.de<br>
&emsp; &emsp; &emsp; &emsp; &emsp; &ensp; Nicklas Meyer (6020989), nicklas.meyer@student.jade-hs.de

&emsp; &emsp; &emsp; &emsp; &emsp; &ensp; Oldenburg, 24. Januar 2022

Prüfer: &emsp; &emsp; &emsp; Prof. Dr. rer. nat. habil. Roland Pesch

## Gliederung

* [Datenimport](#datenimport)
* [Datensichtung](#datensichtung)
* [Datenvorbereitung](#datenvorbereitung)
* [Analyse](#analyse)
    * [Verlauf](#analyse-verlauf)
    * [Kartendarstellung der 7-Tage-Inzidenz](#analyse-map)
    * [HotSpot-Analyse](#analyse-hsa)
    * [Ausreißer-Analyse](#analyse-outlier)
    * [Space Time Cubes](#analyse-stc)
        * [Space Time Cubes berechnen](#analyse-stc-create)
        * [Emerging Hot Spot Analyse](#analyse-stc-emerg)
        * [Visualisierung in 3D](#analyse-stc-vis3D)
        * [Time Series Clustering](#analyse-stc-clust)
* [Datenexport](#export)

Zur Durchführung des Skripts sollte in der ArcGIS-Enterprise Umgebung ein Ordner mit dem Namen 'Masterprojekt' erstellt werden, da dort zum Teil Ergebnisse abgespeichert werden.

### Imports

Import der benötigten Pakete


```python
# Standard
import os
import pandas as pd
import numpy

# ArcGIS (Geofunktonalitäten)
import arcgis
from arcgis.gis import GIS
from arcgis import geoanalytics
from arcgis.features import SpatialDataFrame
from arcgis import features
import arcpy

# Matplotlib (Diagramme)
import matplotlib.pyplot as plt
import matplotlib.dates as mdates
import matplotlib

# Diverses
import zipfile
from copy import deepcopy
from datetime import datetime
```

#### arcpy-Workspace

Für die arcpy-Funktionen wird ein Workspace benötigt. Dieser wird im Home-Verzeichnis auf dem ArcGIS-Enterprise angelegt und dort eine Geodatabase zum Speichern der Ergebnisse erzeugt.


```python
home_dir = os.path.join(os.getcwd(), 'home')
if not arcpy.Exists(os.path.join(home_dir, 'Results.gdb')):
    arcpy.CreateFileGDB_management(home_dir, 'Results.gdb')
```


```python
arcpy.env.workspace = os.path.join(home_dir,'Results.gdb')
results_dir = os.path.join(home_dir,'Results.gdb')
```

## Datenimport <a class="anchor" id="datenimport"></a>

### Karte erstellen

Erzeugen einer Karte zur Darstellung der Layerdaten.


```python
gis = GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis")
map = gis.map("Germany")
map
```


    MapView(layout=Layout(height='400px', width='100%'))



<div class="map-static-img-preview-770f691e-0722-42a1-82ec-5e08605bad08"><img src=""></img></div>



<div class="map-html-embed-preview-770f691e-0722-42a1-82ec-5e08605bad08"></div>


### Layer: Kreisgrenzen

Einladen der Kreisgrenzen als Polygondaten. Die Daten können direkt aus dem ArcGIS-Hub als Layer-Datei verwendet werden.
Verwendet werden die Landkreisdaten des RKI mit Coronadaten, um die zu den Daten passenden Geometrien (Berlin in Stadteile aufgeteilt) sowie Einwohnerzahlen pro Landkreis zu erhalten.

Quelle: Robert Koch-Institut (RKI), dl-de/by-2-0


```python
# Item Added From Toolbar
# Title: RKI Corona Landkreise | Type: Feature Service | Owner: help1@esri
agol_gis = GIS(set_active=False)
kreise = agol_gis.content.get("917fc37a709542548cc3be077a786c17")
kreise
```




<div class="item_container" style="height: auto; overflow: hidden; border: 1px solid #cfcfcf; border-radius: 2px; background: #f6fafa; line-height: 1.21429em; padding: 10px;">
                    <div class="item_left" style="width: 210px; float: left;">
                       <a href='https://www.arcgis.com/home/item.html?id=917fc37a709542548cc3be077a786c17' target='_blank'>
                        <img src='https://www.arcgis.com/sharing/rest//content/items/917fc37a709542548cc3be077a786c17/info/thumbnail/thumbnail1585239528624.png' class="itemThumbnail">
                       </a>
                    </div>

                    <div class="item_right"     style="float: none; width: auto; overflow: hidden;">
                        <a href='https://www.arcgis.com/home/item.html?id=917fc37a709542548cc3be077a786c17' target='_blank'><b>RKI Corona Landkreise</b>
                        </a>
                        <br/>Feature Service mit den aktuellen Covid-19 Infektionen pro 100.000 Einwohner auf die deutschen Landkreise.<img src='https://www.arcgis.com/home/js/jsapi/esri/css/images/item_type_icons/featureshosted16.png' style="vertical-align:middle;">Feature Layer Collection by help1@esri
                        <br/>Last Modified: January 12, 2022
                        <br/>0 comments, 1,985,224,456 views
                    </div>
                </div>




Diese Daten werden in der zuvor erzeugten Karte dargestellt.


```python
map.add_layer(kreise)
```

Umwandeln der Layerdaten in ein "spatially-enabled" Dataframe um mit den Daten im Notebook arbeiten zu können und aber die geografischen Informationen beizubehalten.


```python
kreise_df = pd.DataFrame.spatial.from_layer(kreise.layers[0])
```

### Corona-Daten

Einladen der tagesaktuellen Coronadaten für den gesamten Zeitraum. Die Daten können direkt aus dem ArcGIS-Hub als CSV-Datei verwendet werden.

Quelle: Robert Koch-Institut (RKI), dl-de/by-2-0


```python
# Item Added From Toolbar
# Title: RKI_COVID19 | Type: CSV | Owner: help6@esri
agol_gis = GIS(set_active=False)
data = agol_gis.content.get("f10774f1c63e40168479a1feb6c7ca74")
data
```




<div class="item_container" style="height: auto; overflow: hidden; border: 1px solid #cfcfcf; border-radius: 2px; background: #f6fafa; line-height: 1.21429em; padding: 10px;">
                    <div class="item_left" style="width: 210px; float: left;">
                       <a href='https://www.arcgis.com/home/item.html?id=f10774f1c63e40168479a1feb6c7ca74' target='_blank'>
                        <img src='https://www.arcgis.com/sharing/rest//content/items/f10774f1c63e40168479a1feb6c7ca74/info/thumbnail/thumbnail1586188372673.png' class="itemThumbnail">
                       </a>
                    </div>

                    <div class="item_right"     style="float: none; width: auto; overflow: hidden;">
                        <a href='https://www.arcgis.com/home/item.html?id=f10774f1c63e40168479a1feb6c7ca74' target='_blank'><b>RKI_COVID19</b>
                        </a>
                        <br/>CSV mit den aktuellen Covid-19 Infektionen pro Tag (Zeitreihe).<img src='https://www.arcgis.com/home/js/jsapi/esri/css/images/item_type_icons/layers16.png' style="vertical-align:middle;">CSV by help6@esri
                        <br/>Last Modified: January 20, 2022
                        <br/>654 comments, 1,422,637 views
                    </div>
                </div>




Umwandeln der CSV-Daten in ein Pandas-Dataframe. Dabei werden die Spalten 'Meldedatum', 'Datenstand' und 'Refdatum' als Datum abgespeichert.


```python
data_csv = data.get_data()
data_df = pd.read_csv(data_csv, parse_dates=['Meldedatum', 'Datenstand', 'Refdatum'])
```

## Datensichtung <a class="anchor" id="datensichtung"></a>

### Attributtabelle

Sichten des Aufbaus der Corona-Daten durch Ausgabe der Größe, Spalten und Spaltentypen der Daten.


```python
data_df.shape
```




    (3627499, 18)




```python
data_df.columns
```




    Index(['FID', 'IdBundesland', 'Bundesland', 'Landkreis', 'Altersgruppe',
           'Geschlecht', 'AnzahlFall', 'AnzahlTodesfall', 'Meldedatum',
           'IdLandkreis', 'Datenstand', 'NeuerFall', 'NeuerTodesfall', 'Refdatum',
           'NeuGenesen', 'AnzahlGenesen', 'IstErkrankungsbeginn', 'Altersgruppe2'],
          dtype='object')




```python
print(data_df.dtypes)
```

    FID                              int64
    IdBundesland                     int64
    Bundesland                      object
    Landkreis                       object
    Altersgruppe                    object
    Geschlecht                      object
    AnzahlFall                       int64
    AnzahlTodesfall                  int64
    Meldedatum              datetime64[ns]
    IdLandkreis                      int64
    Datenstand                      object
    NeuerFall                        int64
    NeuerTodesfall                   int64
    Refdatum                datetime64[ns]
    NeuGenesen                       int64
    AnzahlGenesen                    int64
    IstErkrankungsbeginn             int64
    Altersgruppe2                   object
    dtype: object


Sichten von Anfang und Ende des Dataframes, um Aufbau der Daten zu überprüfen.


```python
data_df.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FID</th>
      <th>IdBundesland</th>
      <th>Bundesland</th>
      <th>Landkreis</th>
      <th>Altersgruppe</th>
      <th>Geschlecht</th>
      <th>AnzahlFall</th>
      <th>AnzahlTodesfall</th>
      <th>Meldedatum</th>
      <th>IdLandkreis</th>
      <th>Datenstand</th>
      <th>NeuerFall</th>
      <th>NeuerTodesfall</th>
      <th>Refdatum</th>
      <th>NeuGenesen</th>
      <th>AnzahlGenesen</th>
      <th>IstErkrankungsbeginn</th>
      <th>Altersgruppe2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>SK Flensburg</td>
      <td>A00-A04</td>
      <td>M</td>
      <td>1</td>
      <td>0</td>
      <td>2020-09-30</td>
      <td>1001</td>
      <td>20.01.2022, 00:00 Uhr</td>
      <td>0</td>
      <td>-9</td>
      <td>2020-09-30</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>Nicht übermittelt</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>SK Flensburg</td>
      <td>A00-A04</td>
      <td>M</td>
      <td>1</td>
      <td>0</td>
      <td>2020-10-29</td>
      <td>1001</td>
      <td>20.01.2022, 00:00 Uhr</td>
      <td>0</td>
      <td>-9</td>
      <td>2020-10-29</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>Nicht übermittelt</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>SK Flensburg</td>
      <td>A00-A04</td>
      <td>M</td>
      <td>1</td>
      <td>0</td>
      <td>2020-11-03</td>
      <td>1001</td>
      <td>20.01.2022, 00:00 Uhr</td>
      <td>0</td>
      <td>-9</td>
      <td>2020-11-03</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>Nicht übermittelt</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>SK Flensburg</td>
      <td>A00-A04</td>
      <td>M</td>
      <td>1</td>
      <td>0</td>
      <td>2020-11-20</td>
      <td>1001</td>
      <td>20.01.2022, 00:00 Uhr</td>
      <td>0</td>
      <td>-9</td>
      <td>2020-11-19</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>Nicht übermittelt</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>SK Flensburg</td>
      <td>A00-A04</td>
      <td>M</td>
      <td>1</td>
      <td>0</td>
      <td>2020-11-23</td>
      <td>1001</td>
      <td>20.01.2022, 00:00 Uhr</td>
      <td>0</td>
      <td>-9</td>
      <td>2020-11-18</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>Nicht übermittelt</td>
    </tr>
  </tbody>
</table>
</div>




```python
data_df.tail()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FID</th>
      <th>IdBundesland</th>
      <th>Bundesland</th>
      <th>Landkreis</th>
      <th>Altersgruppe</th>
      <th>Geschlecht</th>
      <th>AnzahlFall</th>
      <th>AnzahlTodesfall</th>
      <th>Meldedatum</th>
      <th>IdLandkreis</th>
      <th>Datenstand</th>
      <th>NeuerFall</th>
      <th>NeuerTodesfall</th>
      <th>Refdatum</th>
      <th>NeuGenesen</th>
      <th>AnzahlGenesen</th>
      <th>IstErkrankungsbeginn</th>
      <th>Altersgruppe2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3627494</th>
      <td>3627495</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>LK Altenburger Land</td>
      <td>A60-A79</td>
      <td>W</td>
      <td>1</td>
      <td>0</td>
      <td>2020-04-22</td>
      <td>16077</td>
      <td>20.01.2022, 00:00 Uhr</td>
      <td>0</td>
      <td>-9</td>
      <td>2020-04-17</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>Nicht übermittelt</td>
    </tr>
    <tr>
      <th>3627495</th>
      <td>3627496</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>LK Altenburger Land</td>
      <td>A60-A79</td>
      <td>W</td>
      <td>1</td>
      <td>0</td>
      <td>2020-05-18</td>
      <td>16077</td>
      <td>20.01.2022, 00:00 Uhr</td>
      <td>0</td>
      <td>-9</td>
      <td>2020-05-14</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>Nicht übermittelt</td>
    </tr>
    <tr>
      <th>3627496</th>
      <td>3627497</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>LK Altenburger Land</td>
      <td>A60-A79</td>
      <td>W</td>
      <td>1</td>
      <td>0</td>
      <td>2020-05-27</td>
      <td>16077</td>
      <td>20.01.2022, 00:00 Uhr</td>
      <td>0</td>
      <td>-9</td>
      <td>2020-05-27</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>Nicht übermittelt</td>
    </tr>
    <tr>
      <th>3627497</th>
      <td>3627498</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>LK Altenburger Land</td>
      <td>A60-A79</td>
      <td>W</td>
      <td>1</td>
      <td>0</td>
      <td>2020-09-12</td>
      <td>16077</td>
      <td>20.01.2022, 00:00 Uhr</td>
      <td>0</td>
      <td>-9</td>
      <td>2020-09-08</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>Nicht übermittelt</td>
    </tr>
    <tr>
      <th>3627498</th>
      <td>3627499</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>LK Altenburger Land</td>
      <td>A60-A79</td>
      <td>W</td>
      <td>1</td>
      <td>0</td>
      <td>2020-10-09</td>
      <td>16077</td>
      <td>20.01.2022, 00:00 Uhr</td>
      <td>0</td>
      <td>-9</td>
      <td>2020-10-09</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>Nicht übermittelt</td>
    </tr>
  </tbody>
</table>
</div>



## Datenvorbereitung <a class="anchor" id="datenvorbereitung"></a>

### Coronadaten

#### Aggregieren nach Tag und Landkreis

Da in der folgenden Analyse nicht auf Alter und Geschlecht der Personen eingegangen wird, wird durch eine Aggregation der Daten nur ein Eintrag pro Tag mit der Anzahl der Fälle, Todesfälle und Genesenen erzeugt. Im Zuge dessen werden nur die für die weitere Analyse wichtigen Spalten in das neue Dataframe überführt. Außerdem wird die Landkreis-ID auch als fünf-stelliger String abgelegt.


```python
data_df_aggr = data_df[['IdBundesland','Bundesland','IdLandkreis','Landkreis','Meldedatum','AnzahlFall','AnzahlTodesfall','AnzahlGenesen']].groupby(['IdBundesland','Bundesland','IdLandkreis','Landkreis','Meldedatum']).sum()
data_df_aggr.reset_index(inplace = True, drop = False)
data_df_aggr['IdLandkreis_str'] = data_df_aggr['IdLandkreis'].astype(str).str.zfill(5)
data_df_aggr.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>IdBundesland</th>
      <th>Bundesland</th>
      <th>IdLandkreis</th>
      <th>Landkreis</th>
      <th>Meldedatum</th>
      <th>AnzahlFall</th>
      <th>AnzahlTodesfall</th>
      <th>AnzahlGenesen</th>
      <th>IdLandkreis_str</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2020-03-14</td>
      <td>4</td>
      <td>0</td>
      <td>4</td>
      <td>01001</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2020-03-18</td>
      <td>2</td>
      <td>0</td>
      <td>2</td>
      <td>01001</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2020-03-19</td>
      <td>4</td>
      <td>0</td>
      <td>4</td>
      <td>01001</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2020-03-20</td>
      <td>2</td>
      <td>0</td>
      <td>2</td>
      <td>01001</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2020-03-21</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>01001</td>
    </tr>
  </tbody>
</table>
</div>



### Kreise

#### AGS in Berliner Bezirke

Berlin ist in den Coronadaten in zwölf Bezirke aufgeteilt. Die Polygondaten dazu liegen vor, allerdings ist dort der allgemeine Gemeindeschlüssel (AGS), der später zur Verbindung der Daten als Landkreis-ID dient, nicht vorhanden. Der dafür benötigte Schlüssel liegt in den Daten aber als Regionalschlüssel (RS) vor uns wird in den betreffenden Bezirken nun in die Spalte 'AGS' übertragen.


```python
for index, kreis in kreise_df.loc[kreise_df['AGS'].isnull()].iterrows():
    kreise_df.at[index, 'AGS'] = kreise_df.at[index, 'RS']
kreise_df.loc[kreise_df['BL_ID'] == '11']
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>OBJECTID</th>
      <th>ADE</th>
      <th>GF</th>
      <th>BSG</th>
      <th>RS</th>
      <th>AGS</th>
      <th>SDV_RS</th>
      <th>GEN</th>
      <th>BEZ</th>
      <th>IBZ</th>
      <th>...</th>
      <th>recovered</th>
      <th>EWZ_BL</th>
      <th>cases7_bl_per_100k</th>
      <th>cases7_bl</th>
      <th>death7_bl</th>
      <th>cases7_lk</th>
      <th>death7_lk</th>
      <th>cases7_per_100k_txt</th>
      <th>AdmUnitId</th>
      <th>SHAPE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>399</th>
      <td>404</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>11012</td>
      <td>11012</td>
      <td>None</td>
      <td>Berlin Reinickendorf</td>
      <td>Bezirk</td>
      <td>NaN</td>
      <td>...</td>
      <td>None</td>
      <td>3664088</td>
      <td>1154.202628</td>
      <td>42291</td>
      <td>2</td>
      <td>2477</td>
      <td>1</td>
      <td>953,7</td>
      <td>11012</td>
      <td>{"rings": [[[792389.254807112, 5839502.6115011...</td>
    </tr>
    <tr>
      <th>400</th>
      <td>405</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>11004</td>
      <td>11004</td>
      <td>None</td>
      <td>Berlin Charlottenburg-Wilmersdorf</td>
      <td>Bezirk</td>
      <td>NaN</td>
      <td>...</td>
      <td>None</td>
      <td>3664088</td>
      <td>1154.202628</td>
      <td>42291</td>
      <td>2</td>
      <td>3426</td>
      <td>0</td>
      <td>1083,4</td>
      <td>11004</td>
      <td>{"rings": [[[793095.198362989, 5828151.5797928...</td>
    </tr>
    <tr>
      <th>401</th>
      <td>406</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>11009</td>
      <td>11009</td>
      <td>None</td>
      <td>Berlin Treptow-Köpenick</td>
      <td>Bezirk</td>
      <td>NaN</td>
      <td>...</td>
      <td>None</td>
      <td>3664088</td>
      <td>1154.202628</td>
      <td>42291</td>
      <td>2</td>
      <td>2697</td>
      <td>0</td>
      <td>987,9</td>
      <td>11009</td>
      <td>{"rings": [[[811538.542027648, 5814380.5558578...</td>
    </tr>
    <tr>
      <th>402</th>
      <td>407</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>11003</td>
      <td>11003</td>
      <td>None</td>
      <td>Berlin Pankow</td>
      <td>Bezirk</td>
      <td>NaN</td>
      <td>...</td>
      <td>None</td>
      <td>3664088</td>
      <td>1154.202628</td>
      <td>42291</td>
      <td>2</td>
      <td>4399</td>
      <td>0</td>
      <td>1088,4</td>
      <td>11003</td>
      <td>{"rings": [[[804887.108273519, 5839487.9793484...</td>
    </tr>
    <tr>
      <th>403</th>
      <td>408</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>11008</td>
      <td>11008</td>
      <td>None</td>
      <td>Berlin Neukölln</td>
      <td>Bezirk</td>
      <td>NaN</td>
      <td>...</td>
      <td>None</td>
      <td>3664088</td>
      <td>1154.202628</td>
      <td>42291</td>
      <td>2</td>
      <td>5166</td>
      <td>0</td>
      <td>1621,9</td>
      <td>11008</td>
      <td>{"rings": [[[802663.802804605, 5824408.6609931...</td>
    </tr>
    <tr>
      <th>404</th>
      <td>409</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>11011</td>
      <td>11011</td>
      <td>None</td>
      <td>Berlin Lichtenberg</td>
      <td>Bezirk</td>
      <td>NaN</td>
      <td>...</td>
      <td>None</td>
      <td>3664088</td>
      <td>1154.202628</td>
      <td>42291</td>
      <td>2</td>
      <td>3119</td>
      <td>1</td>
      <td>1068,1</td>
      <td>11011</td>
      <td>{"rings": [[[807143.217535185, 5823410.5725075...</td>
    </tr>
    <tr>
      <th>405</th>
      <td>410</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>11010</td>
      <td>11010</td>
      <td>None</td>
      <td>Berlin Marzahn-Hellersdorf</td>
      <td>Bezirk</td>
      <td>NaN</td>
      <td>...</td>
      <td>None</td>
      <td>3664088</td>
      <td>1154.202628</td>
      <td>42291</td>
      <td>2</td>
      <td>564</td>
      <td>0</td>
      <td>205,8</td>
      <td>11010</td>
      <td>{"rings": [[[813266.912876663, 5823563.2786502...</td>
    </tr>
    <tr>
      <th>406</th>
      <td>411</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>11005</td>
      <td>11005</td>
      <td>None</td>
      <td>Berlin Spandau</td>
      <td>Bezirk</td>
      <td>NaN</td>
      <td>...</td>
      <td>None</td>
      <td>3664088</td>
      <td>1154.202628</td>
      <td>42291</td>
      <td>2</td>
      <td>3368</td>
      <td>0</td>
      <td>1407,0</td>
      <td>11005</td>
      <td>{"rings": [[[786759.034879274, 5831877.2038761...</td>
    </tr>
    <tr>
      <th>407</th>
      <td>412</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>11006</td>
      <td>11006</td>
      <td>None</td>
      <td>Berlin Steglitz-Zehlendorf</td>
      <td>Bezirk</td>
      <td>NaN</td>
      <td>...</td>
      <td>None</td>
      <td>3664088</td>
      <td>1154.202628</td>
      <td>42291</td>
      <td>2</td>
      <td>2040</td>
      <td>0</td>
      <td>698,8</td>
      <td>11006</td>
      <td>{"rings": [[[793370.529199325, 5821756.8627222...</td>
    </tr>
    <tr>
      <th>408</th>
      <td>413</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>11001</td>
      <td>11001</td>
      <td>None</td>
      <td>Berlin Mitte</td>
      <td>Bezirk</td>
      <td>NaN</td>
      <td>...</td>
      <td>None</td>
      <td>3664088</td>
      <td>1154.202628</td>
      <td>42291</td>
      <td>2</td>
      <td>8563</td>
      <td>0</td>
      <td>2286,0</td>
      <td>11001</td>
      <td>{"rings": [[[796652.481997282, 5832431.7310471...</td>
    </tr>
    <tr>
      <th>409</th>
      <td>414</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>11002</td>
      <td>11002</td>
      <td>None</td>
      <td>Berlin Friedrichshain-Kreuzberg</td>
      <td>Bezirk</td>
      <td>NaN</td>
      <td>...</td>
      <td>None</td>
      <td>3664088</td>
      <td>1154.202628</td>
      <td>42291</td>
      <td>2</td>
      <td>4195</td>
      <td>0</td>
      <td>1502,5</td>
      <td>11002</td>
      <td>{"rings": [[[802213.705485233, 5828350.9387527...</td>
    </tr>
    <tr>
      <th>410</th>
      <td>415</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>11007</td>
      <td>11007</td>
      <td>None</td>
      <td>Berlin Tempelhof-Schöneberg</td>
      <td>Bezirk</td>
      <td>NaN</td>
      <td>...</td>
      <td>None</td>
      <td>3664088</td>
      <td>1154.202628</td>
      <td>42291</td>
      <td>2</td>
      <td>2277</td>
      <td>0</td>
      <td>667,2</td>
      <td>11007</td>
      <td>{"rings": [[[798532.900957422, 5813120.1802016...</td>
    </tr>
  </tbody>
</table>
<p>12 rows × 48 columns</p>
</div>



#### Geometrie und Daten trennen

Für eine performantere Analyse werden die Geometrie und die restlichen Daten voneinander getrennt.

Endprodukte sind die Kreisgeometrien (*kreise_geom*) und die Kreisdaten mit den Einwohnerzahlen für den Landkreis (*kreise_ewz*).


```python
kreise_geom = kreise_df[['AGS', 'SHAPE', 'Shape__Area', 'Shape__Length']]
kreise_geom['AGS_int'] = kreise_geom['AGS'].astype(int)
kreise_ewz = kreise_df[['AGS', 'EWZ', 'EWZ_BL']]
```

    /opt/conda/lib/python3.7/site-packages/ipykernel_launcher.py:2: SettingWithCopyWarning:
    
    
    A value is trying to be set on a copy of a slice from a DataFrame.
    Try using .loc[row_indexer,col_indexer] = value instead
    
    See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
    


Außerdem werden die Einwohnerzahlen für die einzelnen Bundesländer in einem weiteren Dataframe (*bl_ewz*) gespeichert.

Dieses Dataframe hat pro Landkreis einen Eintrag. Damit nur noch ein Eintrag pro Bundesland bestehen bleibt, werden die Daten aggregiert (*bl_id*).


```python
bl_ewz = kreise_df[['BL_ID', 'BL', 'EWZ_BL']]
bl_ewz['BL_ID_str'] = bl_ewz['BL_ID'].astype(str).str.zfill(2)
```

    /opt/conda/lib/python3.7/site-packages/ipykernel_launcher.py:2: SettingWithCopyWarning:
    
    
    A value is trying to be set on a copy of a slice from a DataFrame.
    Try using .loc[row_indexer,col_indexer] = value instead
    
    See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
    



```python
bl_id = bl_ewz[['BL_ID','BL_ID_str','BL','EWZ_BL']].groupby(['BL_ID','BL_ID_str','BL','EWZ_BL']).sum()
bl_id.reset_index(inplace = True, drop = False)
bl_id.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>BL_ID</th>
      <th>BL_ID_str</th>
      <th>BL</th>
      <th>EWZ_BL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>01</td>
      <td>Schleswig-Holstein</td>
      <td>2910875</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10</td>
      <td>10</td>
      <td>Saarland</td>
      <td>983991</td>
    </tr>
    <tr>
      <th>2</th>
      <td>11</td>
      <td>11</td>
      <td>Berlin</td>
      <td>3664088</td>
    </tr>
    <tr>
      <th>3</th>
      <td>12</td>
      <td>12</td>
      <td>Brandenburg</td>
      <td>2531071</td>
    </tr>
    <tr>
      <th>4</th>
      <td>13</td>
      <td>13</td>
      <td>Mecklenburg-Vorpommern</td>
      <td>1610774</td>
    </tr>
  </tbody>
</table>
</div>



### Join

Die nicht-geometrischen Kreisdaten werden mit den Coronadaten über AGS und die Landkreis-ID verbunden (*data_ewz*).


```python
data_ewz = pd.merge(kreise_ewz, data_df_aggr, left_on='AGS', right_on="IdLandkreis_str", how='right')
data_ewz.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AGS</th>
      <th>EWZ</th>
      <th>EWZ_BL</th>
      <th>IdBundesland</th>
      <th>Bundesland</th>
      <th>IdLandkreis</th>
      <th>Landkreis</th>
      <th>Meldedatum</th>
      <th>AnzahlFall</th>
      <th>AnzahlTodesfall</th>
      <th>AnzahlGenesen</th>
      <th>IdLandkreis_str</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2020-03-14</td>
      <td>4</td>
      <td>0</td>
      <td>4</td>
      <td>01001</td>
    </tr>
    <tr>
      <th>1</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2020-03-18</td>
      <td>2</td>
      <td>0</td>
      <td>2</td>
      <td>01001</td>
    </tr>
    <tr>
      <th>2</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2020-03-19</td>
      <td>4</td>
      <td>0</td>
      <td>4</td>
      <td>01001</td>
    </tr>
    <tr>
      <th>3</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2020-03-20</td>
      <td>2</td>
      <td>0</td>
      <td>2</td>
      <td>01001</td>
    </tr>
    <tr>
      <th>4</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2020-03-21</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>01001</td>
    </tr>
  </tbody>
</table>
</div>




```python
kreise_id = data_ewz[['IdLandkreis','IdLandkreis_str','Landkreis','EWZ','IdBundesland','Bundesland','EWZ_BL']].groupby(['IdLandkreis','IdLandkreis_str','Landkreis','EWZ','IdBundesland','Bundesland','EWZ_BL']).sum()
kreise_id.reset_index(inplace = True, drop = False)
kreise_id.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>IdLandkreis</th>
      <th>IdLandkreis_str</th>
      <th>Landkreis</th>
      <th>EWZ</th>
      <th>IdBundesland</th>
      <th>Bundesland</th>
      <th>EWZ_BL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1001</td>
      <td>01001</td>
      <td>SK Flensburg</td>
      <td>89934</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>2910875</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1002</td>
      <td>01002</td>
      <td>SK Kiel</td>
      <td>246601</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>2910875</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1003</td>
      <td>01003</td>
      <td>SK Lübeck</td>
      <td>215846</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>2910875</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1004</td>
      <td>01004</td>
      <td>SK Neumünster</td>
      <td>79905</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>2910875</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1051</td>
      <td>01051</td>
      <td>LK Dithmarschen</td>
      <td>133251</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>2910875</td>
    </tr>
  </tbody>
</table>
</div>



#### Auf Bundesländer aggregieren

Für eine Auswertung pro Bundesland werden die Daten auf Bundeslandebene aggregiert. Dabei werden alle Landkreisfälle pro Tag aufsummiert.


```python
data_bl = data_ewz[['IdBundesland','Bundesland','Meldedatum','AnzahlFall','AnzahlTodesfall','AnzahlGenesen', 'EWZ_BL']].groupby(['IdBundesland','Bundesland','Meldedatum', 'EWZ_BL']).sum()
data_bl.reset_index(inplace = True, drop = False)
data_bl['IdBundesland_str'] = data_bl['IdBundesland'].astype(str).str.zfill(2)
data_bl.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>IdBundesland</th>
      <th>Bundesland</th>
      <th>Meldedatum</th>
      <th>EWZ_BL</th>
      <th>AnzahlFall</th>
      <th>AnzahlTodesfall</th>
      <th>AnzahlGenesen</th>
      <th>IdBundesland_str</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>2020-02-28</td>
      <td>2910875</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>01</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>2020-02-29</td>
      <td>2910875</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>01</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>2020-03-02</td>
      <td>2910875</td>
      <td>2</td>
      <td>0</td>
      <td>2</td>
      <td>01</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>2020-03-03</td>
      <td>2910875</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>01</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>2020-03-05</td>
      <td>2910875</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>01</td>
    </tr>
  </tbody>
</table>
</div>



### Inzidenzberechnung

Für die korrekte Berechnung der 7-Tage Inzidenz wird eine Liste aller Tage als Datum in dem zu betrachtenden Bereich erstellt. Dieser beginnt mit dem frühsten in den Daten auftrenden Fall und endet mit dem Datum des neusten Eintrag.


```python
date_list = pd.date_range(start=min(data_bl['Meldedatum']), end=max(data_bl['Meldedatum']), freq='D')
date_list
```




    DatetimeIndex(['2020-01-02', '2020-01-03', '2020-01-04', '2020-01-05',
                   '2020-01-06', '2020-01-07', '2020-01-08', '2020-01-09',
                   '2020-01-10', '2020-01-11',
                   ...
                   '2022-01-10', '2022-01-11', '2022-01-12', '2022-01-13',
                   '2022-01-14', '2022-01-15', '2022-01-16', '2022-01-17',
                   '2022-01-18', '2022-01-19'],
                  dtype='datetime64[ns]', length=749, freq='D')



Außerdem wird ein Dictionary mit 7 Einträgen mit 0.0 benötigt.


```python
values = [0.0,0.0,0.0,0.0,0.0,0.0,0.0] 
dict_clear = dict(zip(range(7), values))
dict_clear
```




    {0: 0.0, 1: 0.0, 2: 0.0, 3: 0.0, 4: 0.0, 5: 0.0, 6: 0.0}



#### Bundesländer

##### Bundesländer: Tagesinzidenz berechnen

Für die Inzidenzberechnung wird zunächst die Tagesinzidenz, also Fälle/Todesfälle/Genesenen pro 100.000 Einwohner berechnet. Diese Werte werden als neue Spalte dem Dataframe hinzugefügt.


```python
data_bl['FaelleEWZ'] = (data_bl['AnzahlFall'] / data_bl['EWZ_BL']) * 100000
data_bl['TodesfaelleEWZ'] = (data_bl['AnzahlTodesfall'] / data_bl['EWZ_BL']) * 100000
data_bl['GeneseneEWZ'] = (data_bl['AnzahlGenesen'] / data_bl['EWZ_BL']) * 100000
data_bl.tail()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>IdBundesland</th>
      <th>Bundesland</th>
      <th>Meldedatum</th>
      <th>EWZ_BL</th>
      <th>AnzahlFall</th>
      <th>AnzahlTodesfall</th>
      <th>AnzahlGenesen</th>
      <th>IdBundesland_str</th>
      <th>FaelleEWZ</th>
      <th>TodesfaelleEWZ</th>
      <th>GeneseneEWZ</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10902</th>
      <td>16</td>
      <td>Thüringen</td>
      <td>2022-01-15</td>
      <td>2120237</td>
      <td>388</td>
      <td>0</td>
      <td>3</td>
      <td>16</td>
      <td>18.299841</td>
      <td>0.000000</td>
      <td>0.141494</td>
    </tr>
    <tr>
      <th>10903</th>
      <td>16</td>
      <td>Thüringen</td>
      <td>2022-01-16</td>
      <td>2120237</td>
      <td>192</td>
      <td>0</td>
      <td>0</td>
      <td>16</td>
      <td>9.055591</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>10904</th>
      <td>16</td>
      <td>Thüringen</td>
      <td>2022-01-17</td>
      <td>2120237</td>
      <td>634</td>
      <td>1</td>
      <td>6</td>
      <td>16</td>
      <td>29.902318</td>
      <td>0.047165</td>
      <td>0.282987</td>
    </tr>
    <tr>
      <th>10905</th>
      <td>16</td>
      <td>Thüringen</td>
      <td>2022-01-18</td>
      <td>2120237</td>
      <td>1308</td>
      <td>0</td>
      <td>10</td>
      <td>16</td>
      <td>61.691217</td>
      <td>0.000000</td>
      <td>0.471645</td>
    </tr>
    <tr>
      <th>10906</th>
      <td>16</td>
      <td>Thüringen</td>
      <td>2022-01-19</td>
      <td>2120237</td>
      <td>1198</td>
      <td>0</td>
      <td>1</td>
      <td>16</td>
      <td>56.503117</td>
      <td>0.000000</td>
      <td>0.047165</td>
    </tr>
  </tbody>
</table>
</div>



##### Bundesländer: 7-Tageinzidenz berechnen

Bei der Berechnung der 7-Tagesinzidenz muss beachtet werden, dass einige Meldedaten (besonders zu Beginn der Pandemie) nicht für alle Bundesländer vorhanden sind, weil dort keine Fälle auftraten oder es Probleme bei der Meldung der Fälle gab.
Zunächst werden die drei dafür benötigten Spalten 'FaelleEWZ_7', 'TodesfaelleEWZ_7' und 'GeneseneEWZ_7' angelegt.

Die eigentliche Berechnung erfolgt über geschachtelte Schleifen.
Pro Bundesland wird eine Vorlage für einen neuen Listeneintrag angelegt, falls ein neuer Eintrag durch ein fehlendes Meldedatum erstellt werden muss. Außerdem wird für die Fälle, Todesfälle und Genesene je ein Dictionary aus der zuvor angelegten Vorlage erstellt und ein Index angelegt.

Anschließend werden alle Meldedaten aus der zuvor erstellten Liste durchlaufen.

Ist ein Eintrag für den betrachteten Tag vorhanden, dann wird die aktuelle Tagesinzidenz der Fälle/Todesfälle/Genesenen in das jeweilige Dictionary an der Stelle des Tagesindex eingefügt. Außerdem werden die Spalten der 7-Tagesinzidenzen durch die Summe der im Dictionary enthaltenen Werte gefüllt.

Ist für das betrachtete Datum kein Eintrag vorhanden wird 0 in das jeweilige Dictionary an der Stelle des Tagesindex eingefügt. Außerdem wird die erstellte Vorlage mit dem  Datum und den 7-Tagesinzidenzen als Summe der im Dictionary enthaltenen Werte gefüllt. Diese Liste wird an eine Liste aller hinzuzufügenden Daten angehängt.

Sind alle Bundesländer und Tage durchlaufen wird die Liste mit den hinzuzufügenden Daten in ein Dataframe umgewandelt und an die Ursprungsdaten angehängt.


```python
data_bl['FaelleEWZ_7'] = 0.0
data_bl['TodesfaelleEWZ_7'] = 0.0
data_bl['GeneseneEWZ_7'] = 0.0

temp_data = []

for index, bl in bl_id.iterrows():

    temp_list = [bl['BL_ID'], bl['BL'],0,bl['EWZ_BL'],0,0,0,bl['BL_ID_str'],0,0,0,0,0,0]

    dict_faelle = deepcopy(dict_clear)
    dict_todesfaelle = deepcopy(dict_clear)
    dict_genesene = deepcopy(dict_clear)
    index_dict = 0

    temp_bl = data_bl.loc[data_bl['IdBundesland_str'] == bl['BL_ID_str']]

    for day in date_list:
        index_day = index_dict%7

        temp = temp_bl.loc[data_bl['Meldedatum'] == day]
        if not temp.empty:
            i = temp.index[0]
            d = data_bl.iloc[i]
            dict_faelle[index_day] = d['FaelleEWZ']
            dict_todesfaelle[index_day] = d['TodesfaelleEWZ']
            dict_genesene[index_day] = d['GeneseneEWZ']

            data_bl.at[i, 'FaelleEWZ_7'] = sum(dict_faelle.values())
            data_bl.at[i, 'TodesfaelleEWZ_7'] = sum(dict_todesfaelle.values())
            data_bl.at[i, 'GeneseneEWZ_7'] = sum(dict_genesene.values())
        else:
            dict_faelle[index_day] = 0
            dict_todesfaelle[index_day] = 0
            dict_genesene[index_day] = 0
            temp_list[2] = day
            temp_list[-3] = sum(dict_faelle.values())
            temp_list[-2] = sum(dict_todesfaelle.values())
            temp_list[-1] = sum(dict_genesene.values())
            temp_data.append(temp_list.copy())

        index_dict += 1

temp_df = pd.DataFrame(temp_data, columns=data_bl.columns)
data_bl = data_bl.append(temp_df, ignore_index=True)
```

Die ergänzten Daten mit den 7-Tagesinzidenzen werden nun nach Bundesland und Meldedatum sortiert.


```python
data_bl.sort_values(['IdBundesland_str', 'Meldedatum'], inplace = True)
data_bl.reset_index(inplace = True, drop = True)
```


```python
data_bl.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>IdBundesland</th>
      <th>Bundesland</th>
      <th>Meldedatum</th>
      <th>EWZ_BL</th>
      <th>AnzahlFall</th>
      <th>AnzahlTodesfall</th>
      <th>AnzahlGenesen</th>
      <th>IdBundesland_str</th>
      <th>FaelleEWZ</th>
      <th>TodesfaelleEWZ</th>
      <th>GeneseneEWZ</th>
      <th>FaelleEWZ_7</th>
      <th>TodesfaelleEWZ_7</th>
      <th>GeneseneEWZ_7</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>2020-01-02</td>
      <td>2910875</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>01</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>2020-01-03</td>
      <td>2910875</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>01</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>2020-01-04</td>
      <td>2910875</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>01</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>2020-01-05</td>
      <td>2910875</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>01</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>2020-01-06</td>
      <td>2910875</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>01</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>



#### Landkreise

Die Berechnung der 7-Tagesinzidenz für Landkreise funktioniert fast identisch zu der Berechnung der 7-Tagesinzidenz der Bundesländer

##### Landkreise: Tagesinzidenz berechnen

Für die Inzidenzberechnung wird zunächst die Tagesinzidenz, also Fälle/Todesfälle/Genesenen pro 100.000 Einwohner berechnet. Diese Werte werden als neue Spalte dem Dataframe hinzugefügt.


```python
data_ewz['FaelleEWZ'] = (data_ewz['AnzahlFall'] / data_ewz['EWZ']) * 100000
data_ewz['TodesfaelleEWZ'] = (data_ewz['AnzahlTodesfall'] / data_ewz['EWZ']) * 100000
data_ewz['GeneseneEWZ'] = (data_ewz['AnzahlGenesen'] / data_ewz['EWZ']) * 100000
data_ewz.tail()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AGS</th>
      <th>EWZ</th>
      <th>EWZ_BL</th>
      <th>IdBundesland</th>
      <th>Bundesland</th>
      <th>IdLandkreis</th>
      <th>Landkreis</th>
      <th>Meldedatum</th>
      <th>AnzahlFall</th>
      <th>AnzahlTodesfall</th>
      <th>AnzahlGenesen</th>
      <th>IdLandkreis_str</th>
      <th>FaelleEWZ</th>
      <th>TodesfaelleEWZ</th>
      <th>GeneseneEWZ</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>223182</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2022-01-14</td>
      <td>17</td>
      <td>0</td>
      <td>0</td>
      <td>16077</td>
      <td>19.240346</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>223183</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2022-01-15</td>
      <td>7</td>
      <td>0</td>
      <td>0</td>
      <td>16077</td>
      <td>7.922495</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>223184</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2022-01-17</td>
      <td>23</td>
      <td>0</td>
      <td>0</td>
      <td>16077</td>
      <td>26.031056</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>223185</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2022-01-18</td>
      <td>61</td>
      <td>0</td>
      <td>0</td>
      <td>16077</td>
      <td>69.038888</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>223186</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2022-01-19</td>
      <td>17</td>
      <td>0</td>
      <td>0</td>
      <td>16077</td>
      <td>19.240346</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>



#### Landkreise: 7-Tageinzidenz berechnen

Bei der Berechnung der 7-Tagesinzidenz muss beachtet werden, dass einige Meldedaten (besonders zu Beginn der Pandemie) nicht für alle Landkreise vorhanden sind, weil dort keine Fälle auftraten oder es Probleme bei der Meldung der Fälle gab.
Zunächst werden die drei dafür benötigten Spalten 'FaelleEWZ_7', 'TodesfaelleEWZ_7' und 'GeneseneEWZ_7' angelegt.

Die eigentliche Berechnung erfolgt über geschachtelte Schleifen.
Pro Landkreis wird eine Vorlage für einen neuen Listeneintrag angelegt, falls ein neuer Eintrag durch ein fehlendes Meldedatum erstellt werden muss. Außerdem wird für die Fälle, Todesfälle und Genesene je ein Dictionary aus der zuvor angelegten Vorlage erstellt und ein Index angelegt.

Anschließend werden alle Meldedaten aus der zuvor erstellten Liste durchlaufen.

Ist ein Eintrag für den betrachteten Tag vorhanden, dann wird die aktuelle Tagesinzidenz der Fälle/Todesfälle/Genesenen in das jeweilige Dictionary an der Stelle des Tagesindex eingefügt. Außerdem werden die Spalten der 7-Tagesinzidenzen durch die Summe der im Dictionary enthaltenen Werte gefüllt.

Ist für das betrachtete Datum kein Eintrag vorhanden wird 0 in das jeweilige Dictionary an der Stelle des Tagesindex eingefügt. Außerdem wird die erstellte Vorlage mit dem  Datum und den 7-Tagesinzidenzen als Summe der im Dictionary enthaltenen Werte gefüllt. Diese Liste wird an eine Liste aller hinzuzufügenden Daten angehängt.

Sind alle Landkreise und Tage durchlaufen wird die Liste mit den hinzuzufügenden Daten in ein Dataframe umgewandelt und an die Ursprungsdaten angehängt.


```python
data_ewz['FaelleEWZ_7'] = 0.0
data_ewz['TodesfaelleEWZ_7'] = 0.0
data_ewz['GeneseneEWZ_7'] = 0.0

temp_data = []
bl = 0

for index, kreis in kreise_id.iterrows():

    temp_list = [kreis['IdLandkreis_str'],kreis['EWZ'],kreis['EWZ_BL'],kreis['IdBundesland'],kreis['Bundesland'],kreis['IdLandkreis'],kreis['Landkreis'],0,0,0,0,kreis['IdLandkreis_str'],0,0,0,0,0,0]

    dict_faelle = deepcopy(dict_clear)
    dict_todesfaelle = deepcopy(dict_clear)
    dict_genesene = deepcopy(dict_clear)
    index_dict = 0

    temp_kreis = data_ewz.loc[data_ewz['AGS'] == kreis['IdLandkreis_str']]

    for day in date_list:
        index_day = index_dict%7

        temp = temp_kreis.loc[data_ewz['Meldedatum'] == day]
        if not temp.empty:
            i = temp.index[0]
            d = data_ewz.iloc[i]
            dict_faelle[index_day] = d['FaelleEWZ']
            dict_todesfaelle[index_day] = d['TodesfaelleEWZ']
            dict_genesene[index_day] = d['GeneseneEWZ']

            data_ewz.at[i, 'FaelleEWZ_7'] = sum(dict_faelle.values())
            data_ewz.at[i, 'TodesfaelleEWZ_7'] = sum(dict_todesfaelle.values())
            data_ewz.at[i, 'GeneseneEWZ_7'] = sum(dict_genesene.values())
        else:
            dict_faelle[index_day] = 0
            dict_todesfaelle[index_day] = 0
            dict_genesene[index_day] = 0
            temp_list[7] = day
            temp_list[-3] = sum(dict_faelle.values())
            temp_list[-2] = sum(dict_todesfaelle.values())
            temp_list[-1] = sum(dict_genesene.values())
            temp_data.append(temp_list.copy())

        index_dict += 1
temp_df = pd.DataFrame(temp_data, columns=data_ewz.columns)
data_ewz = data_ewz.append(temp_df, ignore_index=True)
```

Die ergänzten Daten mit den 7-Tagesinzidenzen werden nun nach Landkreis und Meldedatum sortiert.


```python
data_ewz.sort_values(['IdLandkreis_str', 'Meldedatum'], inplace = True)
data_ewz.reset_index(inplace = True, drop = True)
```


```python
data_ewz.tail()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AGS</th>
      <th>EWZ</th>
      <th>EWZ_BL</th>
      <th>IdBundesland</th>
      <th>Bundesland</th>
      <th>IdLandkreis</th>
      <th>Landkreis</th>
      <th>Meldedatum</th>
      <th>AnzahlFall</th>
      <th>AnzahlTodesfall</th>
      <th>AnzahlGenesen</th>
      <th>IdLandkreis_str</th>
      <th>FaelleEWZ</th>
      <th>TodesfaelleEWZ</th>
      <th>GeneseneEWZ</th>
      <th>FaelleEWZ_7</th>
      <th>TodesfaelleEWZ_7</th>
      <th>GeneseneEWZ_7</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>307834</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2022-01-15</td>
      <td>7</td>
      <td>0</td>
      <td>0</td>
      <td>16077</td>
      <td>7.922495</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>149.395627</td>
      <td>1.131785</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>307835</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2022-01-16</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>16077</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>146.000272</td>
      <td>0.000000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>307836</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2022-01-17</td>
      <td>23</td>
      <td>0</td>
      <td>0</td>
      <td>16077</td>
      <td>26.031056</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>127.891711</td>
      <td>0.000000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>307837</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2022-01-18</td>
      <td>61</td>
      <td>0</td>
      <td>0</td>
      <td>16077</td>
      <td>69.038888</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>164.108832</td>
      <td>0.000000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>307838</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2022-01-19</td>
      <td>17</td>
      <td>0</td>
      <td>0</td>
      <td>16077</td>
      <td>19.240346</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>160.713477</td>
      <td>0.000000</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>



Zwischenspeichern der Landkreisdaten mit 7-Tages-Inzidenz, um eine Neuberechung umgehen zu können.


```python
data_ewz.to_csv('home/data.csv', index=False)
```


```python
data_ewz = pd.read_csv('home/data.csv', parse_dates=['Meldedatum'], dtype={'AGS': str, 'IdLandkreis_str': str})
```


```python
data_ewz.tail()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AGS</th>
      <th>EWZ</th>
      <th>EWZ_BL</th>
      <th>IdBundesland</th>
      <th>Bundesland</th>
      <th>IdLandkreis</th>
      <th>Landkreis</th>
      <th>Meldedatum</th>
      <th>AnzahlFall</th>
      <th>AnzahlTodesfall</th>
      <th>AnzahlGenesen</th>
      <th>IdLandkreis_str</th>
      <th>FaelleEWZ</th>
      <th>TodesfaelleEWZ</th>
      <th>GeneseneEWZ</th>
      <th>FaelleEWZ_7</th>
      <th>TodesfaelleEWZ_7</th>
      <th>GeneseneEWZ_7</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>307834</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2022-01-15</td>
      <td>7</td>
      <td>0</td>
      <td>0</td>
      <td>16077</td>
      <td>7.922495</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>149.395627</td>
      <td>1.131785</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>307835</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2022-01-16</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>16077</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>146.000272</td>
      <td>0.000000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>307836</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2022-01-17</td>
      <td>23</td>
      <td>0</td>
      <td>0</td>
      <td>16077</td>
      <td>26.031056</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>127.891711</td>
      <td>0.000000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>307837</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2022-01-18</td>
      <td>61</td>
      <td>0</td>
      <td>0</td>
      <td>16077</td>
      <td>69.038888</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>164.108832</td>
      <td>0.000000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>307838</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2022-01-19</td>
      <td>17</td>
      <td>0</td>
      <td>0</td>
      <td>16077</td>
      <td>19.240346</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>160.713477</td>
      <td>0.000000</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>



## Analyse <a class="anchor" id="analyse"></a>

### Übersichtskarte

#### Daten auf Geometrie joinen

Joinen der Daten eines Tages mit den Geometrien, um eine Übersichtskarte erstellen zu können.


```python
data_kreise_day = pd.merge(data_ewz.loc[data_ewz['Meldedatum']=='2021-12-28'], kreise_geom, left_on="IdLandkreis_str", right_on="AGS", how='right')
data_kreise_day.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AGS_x</th>
      <th>EWZ</th>
      <th>EWZ_BL</th>
      <th>IdBundesland</th>
      <th>Bundesland</th>
      <th>IdLandkreis</th>
      <th>Landkreis</th>
      <th>Meldedatum</th>
      <th>AnzahlFall</th>
      <th>AnzahlTodesfall</th>
      <th>...</th>
      <th>TodesfaelleEWZ</th>
      <th>GeneseneEWZ</th>
      <th>FaelleEWZ_7</th>
      <th>TodesfaelleEWZ_7</th>
      <th>GeneseneEWZ_7</th>
      <th>AGS_y</th>
      <th>SHAPE</th>
      <th>Shape__Area</th>
      <th>Shape__Length</th>
      <th>AGS_int</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2021-12-28</td>
      <td>32</td>
      <td>0</td>
      <td>...</td>
      <td>0.000000</td>
      <td>34.469722</td>
      <td>186.803656</td>
      <td>0.000000</td>
      <td>185.691729</td>
      <td>01001</td>
      <td>{'rings': [[[526513.752884256, 6075133.4118775...</td>
      <td>4.918293e+07</td>
      <td>42752.592015</td>
      <td>1001</td>
    </tr>
    <tr>
      <th>1</th>
      <td>01002</td>
      <td>246601</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1002</td>
      <td>SK Kiel</td>
      <td>2021-12-28</td>
      <td>123</td>
      <td>0</td>
      <td>...</td>
      <td>0.000000</td>
      <td>48.661603</td>
      <td>165.854964</td>
      <td>0.000000</td>
      <td>164.232911</td>
      <td>01002</td>
      <td>{'rings': [[[575841.569494392, 6032148.0317960...</td>
      <td>1.122314e+08</td>
      <td>104373.457289</td>
      <td>1002</td>
    </tr>
    <tr>
      <th>2</th>
      <td>01003</td>
      <td>215846</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1003</td>
      <td>SK Lübeck</td>
      <td>2021-12-28</td>
      <td>101</td>
      <td>0</td>
      <td>...</td>
      <td>0.000000</td>
      <td>45.866034</td>
      <td>102.387814</td>
      <td>0.000000</td>
      <td>101.461227</td>
      <td>01003</td>
      <td>{'rings': [[[623056.150596513, 5983746.4452249...</td>
      <td>2.116771e+08</td>
      <td>146459.457897</td>
      <td>1003</td>
    </tr>
    <tr>
      <th>3</th>
      <td>01004</td>
      <td>79905</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1004</td>
      <td>SK Neumünster</td>
      <td>2021-12-28</td>
      <td>26</td>
      <td>0</td>
      <td>...</td>
      <td>0.000000</td>
      <td>30.035667</td>
      <td>163.944684</td>
      <td>0.000000</td>
      <td>161.441712</td>
      <td>01004</td>
      <td>{'rings': [[[565015.651588687, 6000637.5134813...</td>
      <td>7.140224e+07</td>
      <td>54863.995416</td>
      <td>1004</td>
    </tr>
    <tr>
      <th>4</th>
      <td>01051</td>
      <td>133251</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1051</td>
      <td>LK Dithmarschen</td>
      <td>2021-12-28</td>
      <td>91</td>
      <td>1</td>
      <td>...</td>
      <td>0.750463</td>
      <td>64.539853</td>
      <td>255.157560</td>
      <td>1.500927</td>
      <td>243.150145</td>
      <td>01051</td>
      <td>{'rings': [[[479877.791292057, 5990290.5867080...</td>
      <td>1.425511e+09</td>
      <td>250768.570200</td>
      <td>1051</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 23 columns</p>
</div>



Erstellen eines anzeigbaren Layers für die Karte.


```python
gis = GIS("home")
items = gis.content.search(query ='Corona-Übersicht')
for item in items:
    item.delete()
data_kreise_day_fl = data_kreise_day.spatial.to_featurelayer('Corona-Übersicht', tags=['Corona', 'COVID-19'], folder='Masterprojekt')
```

#### In Karte anzeigen

Anzeigen der Karte.

Dabei kann beim ersten Ausführen ein Fehler auftreten. Um diesen zu beheben muss die Zelle einmal mit gis=GIS("home") ausgeführt und die darauffolgende Zeile auskommentiert werden werden. Anschließend kann wieder die erste Zeile auskommentiert werden und die Zelle mit gis=GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis") ausgeführt werden.


```python
#gis = GIS("home")
gis = GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis")
map = gis.map("Germany")
classed_color_renderer =  {"renderer":"ClassedColorRenderer", "field_name":"anzahl_fall" }
map.add_layer(data_kreise_day_fl, classed_color_renderer)
map
```


    MapView(layout=Layout(height='400px', width='100%'))



<div class="map-static-img-preview-145a2da9-c128-41e5-9de5-ef1a1868aac6"><img src=""></img></div>



<div class="map-html-embed-preview-145a2da9-c128-41e5-9de5-ef1a1868aac6"></div>


### Verlauf <a class="anchor" id="analyse-verlauf"></a>

Um ein Verlaufdiagramm der Fälle/Todesfälle/Genesenen pro Bundesland zu erstellen muss zunächst eine Farbpalette erstellt werden und die Rahmenbedingungen gesetzt werden. Das Enddatum für das Diagramm wird auf den 02.01.2022 gesetzt. Anschließend werden alle Bundesländer nacheinander geplottet. Als letzter Schritt müssen alle Einstellungen des Diagramms gesetzt werden. Das Diagramm wird als PDF exportiert.

#### Diagramm Fälle


```python
# Vorbereitung
col = {'01':'blue', '02':'dodgerblue', '03':'cyan', '04':'lime', '05':'forestgreen', '06':'yellow', '07':'gold', '08':'darkorange', '09':'saddlebrown', '10':'red', '11':'darkred', '12':'deeppink', '13':'darkmagenta', '14':'mediumorchid', '15':'silver', '16':'midnightblue'}
fig, ax = plt.subplots(figsize=(35,15))
y_max = max(data_bl['FaelleEWZ_7'])
x_min = min(data_bl['Meldedatum'])
x_max = datetime.strptime("02/01/22", '%d/%m/%y')

# Daten
for bl in bl_id['BL_ID_str']:
    plt.plot( data_bl.loc[data_bl['IdBundesland_str'] == bl]['Meldedatum'], data_bl.loc[data_bl['IdBundesland_str'] == bl]['FaelleEWZ_7'], color=col[bl], linewidth=3, label=bl_id.loc[bl_id['BL_ID_str'] == bl]['BL'].item())

# Einstellungen
plt.rc("font", size = 22)
plt.rc("axes", labelsize = 20)
plt.rc("legend", fontsize = 22)

plt.legend(loc='upper left')
plt.xlabel("Meldedatum")
plt.ylabel("COVID-19-Fälle der letzten 7 Tage/100.000 Einwohner")
plt.title("7-Tageinzidenz der COVID-19-Fälle pro Bundesland")
plt.xlim([x_min, x_max])
plt.ylim([0, y_max+10])
plt.xticks(rotation=45, ha='right')

ax.xaxis.set_major_locator(mdates.WeekdayLocator(interval=2))

handles, labels = plt.gca().get_legend_handles_labels()
order = [0,8,9,10,11,12,13,14,15,1,2,3,4,5,6,7]
plt.legend([handles[idx] for idx in order],[labels[idx] for idx in order])

plt.savefig('VerlaufFaelle.pdf')  
```


![png](output_105_0.png)


#### Diagramm Todesfälle


```python
# Vorbereitung
col = {'01':'blue', '02':'dodgerblue', '03':'cyan', '04':'lime', '05':'forestgreen', '06':'yellow', '07':'gold', '08':'darkorange', '09':'saddlebrown', '10':'red', '11':'darkred', '12':'deeppink', '13':'darkmagenta', '14':'mediumorchid', '15':'silver', '16':'midnightblue'}
fig, ax = plt.subplots(figsize=(35,15))
y_max = max(data_bl['TodesfaelleEWZ_7'])
x_min = min(data_bl['Meldedatum'])
x_max = datetime.strptime("02/01/22", '%d/%m/%y')

# Daten
for bl in bl_id['BL_ID_str']:
    plt.plot( data_bl.loc[data_bl['IdBundesland_str'] == bl]['Meldedatum'], data_bl.loc[data_bl['IdBundesland_str'] == bl]['TodesfaelleEWZ_7'], color=col[bl], linewidth=3, label=bl_id.loc[bl_id['BL_ID_str'] == bl]['BL'].item())

# Einstellungen
plt.legend(loc='upper left')
plt.xlabel("Meldedatum der Erkrankung")
plt.ylabel("COVID-19-Todesfälle der letzten 7 Tage/100.000 Einwohner")
plt.title("7-Tageinzidenz der COVID-19-Todesfälle pro Bundesland")
plt.xlim([x_min, x_max])
plt.ylim([0, y_max+0.5])
plt.xticks(rotation=45, ha='right')

ax.xaxis.set_major_locator(mdates.WeekdayLocator(interval=2))

handles, labels = plt.gca().get_legend_handles_labels()
order = [0,8,9,10,11,12,13,14,15,1,2,3,4,5,6,7]
plt.legend([handles[idx] for idx in order],[labels[idx] for idx in order])

plt.savefig('VerlaufTodesfaelle.pdf')  
```


![png](output_107_0.png)


#### Diagramm Genesene


```python
# Vorbereitung
col = {'01':'blue', '02':'dodgerblue', '03':'cyan', '04':'lime', '05':'forestgreen', '06':'yellow', '07':'gold', '08':'darkorange', '09':'saddlebrown', '10':'red', '11':'darkred', '12':'deeppink', '13':'darkmagenta', '14':'mediumorchid', '15':'silver', '16':'midnightblue'}
fig, ax = plt.subplots(figsize=(35,15))
y_max = max(data_bl['GeneseneEWZ_7'])
x_min = min(data_bl['Meldedatum'])
x_max = datetime.strptime("02/01/22", '%d/%m/%y')

# Daten
for bl in bl_id['BL_ID_str']:
    plt.plot( data_bl.loc[data_bl['IdBundesland_str'] == bl]['Meldedatum'], data_bl.loc[data_bl['IdBundesland_str'] == bl]['GeneseneEWZ_7'], color=col[bl], linewidth=3, label=bl_id.loc[bl_id['BL_ID_str'] == bl]['BL'].item())

# Einstellungen
plt.legend(loc='upper left')
plt.xlabel("Meldedatum der Erkrankung")
plt.ylabel("COVID-19-Genesene der letzten 7 Tage/100.000 Einwohner")
plt.title("7-Tageinzidenz der COVID-19-Genesene pro Bundesland")
plt.xlim([x_min, x_max])
plt.ylim([0, y_max+5])
plt.xticks(rotation=45, ha='right')

ax.xaxis.set_major_locator(mdates.WeekdayLocator(interval=2))

handles, labels = plt.gca().get_legend_handles_labels()
order = [0,8,9,10,11,12,13,14,15,1,2,3,4,5,6,7]
plt.legend([handles[idx] for idx in order],[labels[idx] for idx in order]) 

plt.savefig('VerlaufGenesene.pdf')  
```


![png](output_109_0.png)


### Kartendarstellung der 7-Tage-Inzidenz <a class="anchor" id="analyse-map"></a>

Die 7-Tageinzidenz soll für alle vier Wellenhochpunkte dargestellt werden.

- 1. Welle: 16.03.2020
- 2. Welle: 16.12.2020
- 3. Welle: 21.04.2021
- 4. Welle: 24.11.2021

#### Maximum 1. Welle (16.03.2020)

Zunächst müssen die Daten für den Hochpunkt der 1. Welle am 16.03.2020 herausgefiltert und mit den Geometriedaten verknüpft werden.


```python
data_Max1W = data_ewz.loc[data_ewz['Meldedatum']=='2020-03-16']
data_Max1W.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AGS</th>
      <th>EWZ</th>
      <th>EWZ_BL</th>
      <th>IdBundesland</th>
      <th>Bundesland</th>
      <th>IdLandkreis</th>
      <th>Landkreis</th>
      <th>Meldedatum</th>
      <th>AnzahlFall</th>
      <th>AnzahlTodesfall</th>
      <th>AnzahlGenesen</th>
      <th>IdLandkreis_str</th>
      <th>FaelleEWZ</th>
      <th>TodesfaelleEWZ</th>
      <th>GeneseneEWZ</th>
      <th>FaelleEWZ_7</th>
      <th>TodesfaelleEWZ_7</th>
      <th>GeneseneEWZ_7</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>74</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2020-03-16</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>01001</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>4.447706</td>
      <td>0.0</td>
      <td>4.447706</td>
    </tr>
    <tr>
      <th>823</th>
      <td>01002</td>
      <td>246601</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1002</td>
      <td>SK Kiel</td>
      <td>2020-03-16</td>
      <td>5</td>
      <td>0</td>
      <td>5</td>
      <td>01002</td>
      <td>2.027567</td>
      <td>0.0</td>
      <td>2.027567</td>
      <td>7.299240</td>
      <td>0.0</td>
      <td>7.299240</td>
    </tr>
    <tr>
      <th>1572</th>
      <td>01003</td>
      <td>215846</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1003</td>
      <td>SK Lübeck</td>
      <td>2020-03-16</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>01003</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>3.706346</td>
      <td>0.0</td>
      <td>3.706346</td>
    </tr>
    <tr>
      <th>2321</th>
      <td>01004</td>
      <td>79905</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1004</td>
      <td>SK Neumünster</td>
      <td>2020-03-16</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>01004</td>
      <td>1.251486</td>
      <td>0.0</td>
      <td>1.251486</td>
      <td>1.251486</td>
      <td>0.0</td>
      <td>1.251486</td>
    </tr>
    <tr>
      <th>3070</th>
      <td>01051</td>
      <td>133251</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1051</td>
      <td>LK Dithmarschen</td>
      <td>2020-03-16</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>01051</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>3.752317</td>
      <td>0.0</td>
      <td>3.752317</td>
    </tr>
  </tbody>
</table>
</div>




```python
data_Max1W_Geom = pd.merge(data_Max1W, kreise_geom, left_on="IdLandkreis_str", right_on="AGS", how='right')
data_Max1W_Geom.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AGS_x</th>
      <th>EWZ</th>
      <th>EWZ_BL</th>
      <th>IdBundesland</th>
      <th>Bundesland</th>
      <th>IdLandkreis</th>
      <th>Landkreis</th>
      <th>Meldedatum</th>
      <th>AnzahlFall</th>
      <th>AnzahlTodesfall</th>
      <th>...</th>
      <th>TodesfaelleEWZ</th>
      <th>GeneseneEWZ</th>
      <th>FaelleEWZ_7</th>
      <th>TodesfaelleEWZ_7</th>
      <th>GeneseneEWZ_7</th>
      <th>AGS_y</th>
      <th>SHAPE</th>
      <th>Shape__Area</th>
      <th>Shape__Length</th>
      <th>AGS_int</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2020-03-16</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>4.447706</td>
      <td>0.0</td>
      <td>4.447706</td>
      <td>01001</td>
      <td>{'rings': [[[526513.752884256, 6075133.4118775...</td>
      <td>4.918293e+07</td>
      <td>42752.592015</td>
      <td>1001</td>
    </tr>
    <tr>
      <th>1</th>
      <td>01002</td>
      <td>246601</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1002</td>
      <td>SK Kiel</td>
      <td>2020-03-16</td>
      <td>5</td>
      <td>0</td>
      <td>...</td>
      <td>0.0</td>
      <td>2.027567</td>
      <td>7.299240</td>
      <td>0.0</td>
      <td>7.299240</td>
      <td>01002</td>
      <td>{'rings': [[[575841.569494392, 6032148.0317960...</td>
      <td>1.122314e+08</td>
      <td>104373.457289</td>
      <td>1002</td>
    </tr>
    <tr>
      <th>2</th>
      <td>01003</td>
      <td>215846</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1003</td>
      <td>SK Lübeck</td>
      <td>2020-03-16</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>3.706346</td>
      <td>0.0</td>
      <td>3.706346</td>
      <td>01003</td>
      <td>{'rings': [[[623056.150596513, 5983746.4452249...</td>
      <td>2.116771e+08</td>
      <td>146459.457897</td>
      <td>1003</td>
    </tr>
    <tr>
      <th>3</th>
      <td>01004</td>
      <td>79905</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1004</td>
      <td>SK Neumünster</td>
      <td>2020-03-16</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0.0</td>
      <td>1.251486</td>
      <td>1.251486</td>
      <td>0.0</td>
      <td>1.251486</td>
      <td>01004</td>
      <td>{'rings': [[[565015.651588687, 6000637.5134813...</td>
      <td>7.140224e+07</td>
      <td>54863.995416</td>
      <td>1004</td>
    </tr>
    <tr>
      <th>4</th>
      <td>01051</td>
      <td>133251</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1051</td>
      <td>LK Dithmarschen</td>
      <td>2020-03-16</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>3.752317</td>
      <td>0.0</td>
      <td>3.752317</td>
      <td>01051</td>
      <td>{'rings': [[[479877.791292057, 5990290.5867080...</td>
      <td>1.425511e+09</td>
      <td>250768.570200</td>
      <td>1051</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 23 columns</p>
</div>



Um die Daten darstellen zu können muss ein Layer in dem Projektordner erzeugt werden. Damit nicht zu viele Layer mit der Zeit angelegt werden wird ein möglicher zuvor erstellter Layer gelöscht.


```python
gis = GIS("home")
items = gis.content.search(query ='Corona-7Tageinzidenz1W')
for item in items:
    item.delete()
data_Max1W_fl = data_Max1W_Geom.spatial.to_featurelayer('Corona-7Tageinzidenz1W', tags=['Corona', 'COVID-19'], folder='Masterprojekt')
```

Dieser Layer kann nun in einer Karte angezeigt werden.


```python
gis = GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis")
map_Max1W = gis.map("Germany")
classed_color_renderer =  {"renderer":"ClassedColorRenderer", "field_name":"faelle_ewz_7" }
map_Max1W.add_layer(data_Max1W_fl, classed_color_renderer)
map_Max1W
```


    MapView(layout=Layout(height='400px', width='100%'))



<div class="map-static-img-preview-54f098cb-8bc8-46d2-b931-3730626698eb"><img src=""></img></div>



<div class="map-html-embed-preview-54f098cb-8bc8-46d2-b931-3730626698eb"></div>


#### Maximum 2. Welle (16.12.2020)

Zunächst müssen die Daten für den Hochpunkt der 2. Welle am 16.12.2020 herausgefiltert und mit den Geometriedaten verknüpft werden.


```python
data_Max2W = data_ewz.loc[data_ewz['Meldedatum']=='2020-12-16']
data_Max2W.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AGS</th>
      <th>EWZ</th>
      <th>EWZ_BL</th>
      <th>IdBundesland</th>
      <th>Bundesland</th>
      <th>IdLandkreis</th>
      <th>Landkreis</th>
      <th>Meldedatum</th>
      <th>AnzahlFall</th>
      <th>AnzahlTodesfall</th>
      <th>AnzahlGenesen</th>
      <th>IdLandkreis_str</th>
      <th>FaelleEWZ</th>
      <th>TodesfaelleEWZ</th>
      <th>GeneseneEWZ</th>
      <th>FaelleEWZ_7</th>
      <th>TodesfaelleEWZ_7</th>
      <th>GeneseneEWZ_7</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>349</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2020-12-16</td>
      <td>6</td>
      <td>0</td>
      <td>6</td>
      <td>01001</td>
      <td>6.671559</td>
      <td>0.000000</td>
      <td>6.671559</td>
      <td>53.372473</td>
      <td>4.447706</td>
      <td>48.924767</td>
    </tr>
    <tr>
      <th>1098</th>
      <td>01002</td>
      <td>246601</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1002</td>
      <td>SK Kiel</td>
      <td>2020-12-16</td>
      <td>65</td>
      <td>0</td>
      <td>65</td>
      <td>01002</td>
      <td>26.358368</td>
      <td>0.000000</td>
      <td>26.358368</td>
      <td>115.571307</td>
      <td>2.027567</td>
      <td>113.543741</td>
    </tr>
    <tr>
      <th>1847</th>
      <td>01003</td>
      <td>215846</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1003</td>
      <td>SK Lübeck</td>
      <td>2020-12-16</td>
      <td>59</td>
      <td>0</td>
      <td>59</td>
      <td>01003</td>
      <td>27.334303</td>
      <td>0.000000</td>
      <td>27.334303</td>
      <td>188.097069</td>
      <td>2.316466</td>
      <td>185.780603</td>
    </tr>
    <tr>
      <th>2596</th>
      <td>01004</td>
      <td>79905</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1004</td>
      <td>SK Neumünster</td>
      <td>2020-12-16</td>
      <td>5</td>
      <td>0</td>
      <td>5</td>
      <td>01004</td>
      <td>6.257431</td>
      <td>0.000000</td>
      <td>6.257431</td>
      <td>60.071335</td>
      <td>1.251486</td>
      <td>58.819849</td>
    </tr>
    <tr>
      <th>3345</th>
      <td>01051</td>
      <td>133251</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1051</td>
      <td>LK Dithmarschen</td>
      <td>2020-12-16</td>
      <td>10</td>
      <td>1</td>
      <td>9</td>
      <td>01051</td>
      <td>7.504634</td>
      <td>0.750463</td>
      <td>6.754171</td>
      <td>63.789390</td>
      <td>0.750463</td>
      <td>63.038927</td>
    </tr>
  </tbody>
</table>
</div>




```python
data_Max2W_Geom = pd.merge(data_Max2W, kreise_geom, left_on="IdLandkreis_str", right_on="AGS", how='right')
data_Max2W_Geom.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AGS_x</th>
      <th>EWZ</th>
      <th>EWZ_BL</th>
      <th>IdBundesland</th>
      <th>Bundesland</th>
      <th>IdLandkreis</th>
      <th>Landkreis</th>
      <th>Meldedatum</th>
      <th>AnzahlFall</th>
      <th>AnzahlTodesfall</th>
      <th>...</th>
      <th>TodesfaelleEWZ</th>
      <th>GeneseneEWZ</th>
      <th>FaelleEWZ_7</th>
      <th>TodesfaelleEWZ_7</th>
      <th>GeneseneEWZ_7</th>
      <th>AGS_y</th>
      <th>SHAPE</th>
      <th>Shape__Area</th>
      <th>Shape__Length</th>
      <th>AGS_int</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2020-12-16</td>
      <td>6</td>
      <td>0</td>
      <td>...</td>
      <td>0.000000</td>
      <td>6.671559</td>
      <td>53.372473</td>
      <td>4.447706</td>
      <td>48.924767</td>
      <td>01001</td>
      <td>{'rings': [[[526513.752884256, 6075133.4118775...</td>
      <td>4.918293e+07</td>
      <td>42752.592015</td>
      <td>1001</td>
    </tr>
    <tr>
      <th>1</th>
      <td>01002</td>
      <td>246601</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1002</td>
      <td>SK Kiel</td>
      <td>2020-12-16</td>
      <td>65</td>
      <td>0</td>
      <td>...</td>
      <td>0.000000</td>
      <td>26.358368</td>
      <td>115.571307</td>
      <td>2.027567</td>
      <td>113.543741</td>
      <td>01002</td>
      <td>{'rings': [[[575841.569494392, 6032148.0317960...</td>
      <td>1.122314e+08</td>
      <td>104373.457289</td>
      <td>1002</td>
    </tr>
    <tr>
      <th>2</th>
      <td>01003</td>
      <td>215846</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1003</td>
      <td>SK Lübeck</td>
      <td>2020-12-16</td>
      <td>59</td>
      <td>0</td>
      <td>...</td>
      <td>0.000000</td>
      <td>27.334303</td>
      <td>188.097069</td>
      <td>2.316466</td>
      <td>185.780603</td>
      <td>01003</td>
      <td>{'rings': [[[623056.150596513, 5983746.4452249...</td>
      <td>2.116771e+08</td>
      <td>146459.457897</td>
      <td>1003</td>
    </tr>
    <tr>
      <th>3</th>
      <td>01004</td>
      <td>79905</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1004</td>
      <td>SK Neumünster</td>
      <td>2020-12-16</td>
      <td>5</td>
      <td>0</td>
      <td>...</td>
      <td>0.000000</td>
      <td>6.257431</td>
      <td>60.071335</td>
      <td>1.251486</td>
      <td>58.819849</td>
      <td>01004</td>
      <td>{'rings': [[[565015.651588687, 6000637.5134813...</td>
      <td>7.140224e+07</td>
      <td>54863.995416</td>
      <td>1004</td>
    </tr>
    <tr>
      <th>4</th>
      <td>01051</td>
      <td>133251</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1051</td>
      <td>LK Dithmarschen</td>
      <td>2020-12-16</td>
      <td>10</td>
      <td>1</td>
      <td>...</td>
      <td>0.750463</td>
      <td>6.754171</td>
      <td>63.789390</td>
      <td>0.750463</td>
      <td>63.038927</td>
      <td>01051</td>
      <td>{'rings': [[[479877.791292057, 5990290.5867080...</td>
      <td>1.425511e+09</td>
      <td>250768.570200</td>
      <td>1051</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 23 columns</p>
</div>



Um die Daten darstellen zu können muss ein Layer in dem Projektordner erzeugt werden. Damit nicht zu viele Layer mit der Zeit angelegt werden wird ein möglicher zuvor erstellter Layer gelöscht.


```python
gis = GIS("home")
items = gis.content.search(query ='Corona-7Tageinzidenz2W')
for item in items:
    item.delete()
data_Max2W_fl = data_Max2W_Geom.spatial.to_featurelayer('Corona-7Tageinzidenz2W', tags=['Corona', 'COVID-19'], folder='Masterprojekt')
```

Dieser Layer kann nun in einer Karte angezeigt werden.


```python
gis = GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis")
map_Max2W = gis.map("Germany")
classed_color_renderer =  {"renderer":"ClassedColorRenderer", "field_name":"faelle_ewz_7" }
map_Max2W.add_layer(data_Max2W_fl, classed_color_renderer)
map_Max2W
```


    MapView(layout=Layout(height='400px', width='100%'))



<div class="map-static-img-preview-cc4d9043-6e09-41a6-bb2b-ddaaf408c5c4"><img src=""></img></div>



<div class="map-html-embed-preview-cc4d9043-6e09-41a6-bb2b-ddaaf408c5c4"></div>


#### Maximum 3. Welle (21.04.2021)

Zunächst müssen die Daten für den Hochpunkt der 2. Welle am 21.04.2021 herausgefiltert und mit den Geometriedaten verknüpft werden.


```python
data_Max3W = data_ewz.loc[data_ewz['Meldedatum']=='2021-04-21']
data_Max3W.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AGS</th>
      <th>EWZ</th>
      <th>EWZ_BL</th>
      <th>IdBundesland</th>
      <th>Bundesland</th>
      <th>IdLandkreis</th>
      <th>Landkreis</th>
      <th>Meldedatum</th>
      <th>AnzahlFall</th>
      <th>AnzahlTodesfall</th>
      <th>AnzahlGenesen</th>
      <th>IdLandkreis_str</th>
      <th>FaelleEWZ</th>
      <th>TodesfaelleEWZ</th>
      <th>GeneseneEWZ</th>
      <th>FaelleEWZ_7</th>
      <th>TodesfaelleEWZ_7</th>
      <th>GeneseneEWZ_7</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>475</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2021-04-21</td>
      <td>10</td>
      <td>0</td>
      <td>10</td>
      <td>01001</td>
      <td>11.119265</td>
      <td>0.0</td>
      <td>11.119265</td>
      <td>50.036694</td>
      <td>0.0</td>
      <td>50.036694</td>
    </tr>
    <tr>
      <th>1224</th>
      <td>01002</td>
      <td>246601</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1002</td>
      <td>SK Kiel</td>
      <td>2021-04-21</td>
      <td>35</td>
      <td>0</td>
      <td>35</td>
      <td>01002</td>
      <td>14.192968</td>
      <td>0.0</td>
      <td>14.192968</td>
      <td>81.913699</td>
      <td>0.0</td>
      <td>81.913699</td>
    </tr>
    <tr>
      <th>1973</th>
      <td>01003</td>
      <td>215846</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1003</td>
      <td>SK Lübeck</td>
      <td>2021-04-21</td>
      <td>14</td>
      <td>0</td>
      <td>14</td>
      <td>01003</td>
      <td>6.486106</td>
      <td>0.0</td>
      <td>6.486106</td>
      <td>62.544592</td>
      <td>0.0</td>
      <td>62.544592</td>
    </tr>
    <tr>
      <th>2722</th>
      <td>01004</td>
      <td>79905</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1004</td>
      <td>SK Neumünster</td>
      <td>2021-04-21</td>
      <td>2</td>
      <td>0</td>
      <td>2</td>
      <td>01004</td>
      <td>2.502972</td>
      <td>0.0</td>
      <td>2.502972</td>
      <td>53.813904</td>
      <td>0.0</td>
      <td>53.813904</td>
    </tr>
    <tr>
      <th>3471</th>
      <td>01051</td>
      <td>133251</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1051</td>
      <td>LK Dithmarschen</td>
      <td>2021-04-21</td>
      <td>24</td>
      <td>0</td>
      <td>24</td>
      <td>01051</td>
      <td>18.011122</td>
      <td>0.0</td>
      <td>18.011122</td>
      <td>68.292170</td>
      <td>0.0</td>
      <td>68.292170</td>
    </tr>
  </tbody>
</table>
</div>




```python
data_Max3W_Geom = pd.merge(data_Max3W, kreise_geom, left_on="IdLandkreis_str", right_on="AGS", how='right')
data_Max3W_Geom.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AGS_x</th>
      <th>EWZ</th>
      <th>EWZ_BL</th>
      <th>IdBundesland</th>
      <th>Bundesland</th>
      <th>IdLandkreis</th>
      <th>Landkreis</th>
      <th>Meldedatum</th>
      <th>AnzahlFall</th>
      <th>AnzahlTodesfall</th>
      <th>...</th>
      <th>TodesfaelleEWZ</th>
      <th>GeneseneEWZ</th>
      <th>FaelleEWZ_7</th>
      <th>TodesfaelleEWZ_7</th>
      <th>GeneseneEWZ_7</th>
      <th>AGS_y</th>
      <th>SHAPE</th>
      <th>Shape__Area</th>
      <th>Shape__Length</th>
      <th>AGS_int</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2021-04-21</td>
      <td>10</td>
      <td>0</td>
      <td>...</td>
      <td>0.0</td>
      <td>11.119265</td>
      <td>50.036694</td>
      <td>0.0</td>
      <td>50.036694</td>
      <td>01001</td>
      <td>{'rings': [[[526513.752884256, 6075133.4118775...</td>
      <td>4.918293e+07</td>
      <td>42752.592015</td>
      <td>1001</td>
    </tr>
    <tr>
      <th>1</th>
      <td>01002</td>
      <td>246601</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1002</td>
      <td>SK Kiel</td>
      <td>2021-04-21</td>
      <td>35</td>
      <td>0</td>
      <td>...</td>
      <td>0.0</td>
      <td>14.192968</td>
      <td>81.913699</td>
      <td>0.0</td>
      <td>81.913699</td>
      <td>01002</td>
      <td>{'rings': [[[575841.569494392, 6032148.0317960...</td>
      <td>1.122314e+08</td>
      <td>104373.457289</td>
      <td>1002</td>
    </tr>
    <tr>
      <th>2</th>
      <td>01003</td>
      <td>215846</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1003</td>
      <td>SK Lübeck</td>
      <td>2021-04-21</td>
      <td>14</td>
      <td>0</td>
      <td>...</td>
      <td>0.0</td>
      <td>6.486106</td>
      <td>62.544592</td>
      <td>0.0</td>
      <td>62.544592</td>
      <td>01003</td>
      <td>{'rings': [[[623056.150596513, 5983746.4452249...</td>
      <td>2.116771e+08</td>
      <td>146459.457897</td>
      <td>1003</td>
    </tr>
    <tr>
      <th>3</th>
      <td>01004</td>
      <td>79905</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1004</td>
      <td>SK Neumünster</td>
      <td>2021-04-21</td>
      <td>2</td>
      <td>0</td>
      <td>...</td>
      <td>0.0</td>
      <td>2.502972</td>
      <td>53.813904</td>
      <td>0.0</td>
      <td>53.813904</td>
      <td>01004</td>
      <td>{'rings': [[[565015.651588687, 6000637.5134813...</td>
      <td>7.140224e+07</td>
      <td>54863.995416</td>
      <td>1004</td>
    </tr>
    <tr>
      <th>4</th>
      <td>01051</td>
      <td>133251</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1051</td>
      <td>LK Dithmarschen</td>
      <td>2021-04-21</td>
      <td>24</td>
      <td>0</td>
      <td>...</td>
      <td>0.0</td>
      <td>18.011122</td>
      <td>68.292170</td>
      <td>0.0</td>
      <td>68.292170</td>
      <td>01051</td>
      <td>{'rings': [[[479877.791292057, 5990290.5867080...</td>
      <td>1.425511e+09</td>
      <td>250768.570200</td>
      <td>1051</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 23 columns</p>
</div>



Um die Daten darstellen zu können muss ein Layer in dem Projektordner erzeugt werden. Damit nicht zu viele Layer mit der Zeit angelegt werden wird ein möglicher zuvor erstellter Layer gelöscht.


```python
gis = GIS("home")
items = gis.content.search(query ='Corona-7Tageinzidenz3W')
for item in items:
    item.delete()
data_Max3W_fl = data_Max3W_Geom.spatial.to_featurelayer('Corona-7Tageinzidenz3W', tags=['Corona', 'COVID-19'], folder='Masterprojekt')
```

Dieser Layer kann nun in einer Karte angezeigt werden.


```python
gis = GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis")
map_Max3W = gis.map("Germany")
classed_color_renderer =  {"renderer":"ClassedColorRenderer", "field_name":"faelle_ewz_7" }
map_Max3W.add_layer(data_Max3W_fl, classed_color_renderer)
map_Max3W
```


    MapView(layout=Layout(height='400px', width='100%'))



<div class="map-static-img-preview-61ca1478-1684-4003-8d1b-8dd6fc62b88f"><img src=""></img></div>



<div class="map-html-embed-preview-61ca1478-1684-4003-8d1b-8dd6fc62b88f"></div>


#### Maximum 4. Welle (24.11.2021)

Zunächst müssen die Daten für den Hochpunkt der 4. Welle am 24.11.2021 herausgefiltert und mit den Geometriedaten verknüpft werden.


```python
data_Max4W = data_ewz.loc[data_ewz['Meldedatum']=='2021-11-24']
data_Max4W.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AGS</th>
      <th>EWZ</th>
      <th>EWZ_BL</th>
      <th>IdBundesland</th>
      <th>Bundesland</th>
      <th>IdLandkreis</th>
      <th>Landkreis</th>
      <th>Meldedatum</th>
      <th>AnzahlFall</th>
      <th>AnzahlTodesfall</th>
      <th>AnzahlGenesen</th>
      <th>IdLandkreis_str</th>
      <th>FaelleEWZ</th>
      <th>TodesfaelleEWZ</th>
      <th>GeneseneEWZ</th>
      <th>FaelleEWZ_7</th>
      <th>TodesfaelleEWZ_7</th>
      <th>GeneseneEWZ_7</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>692</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2021-11-24</td>
      <td>24</td>
      <td>0</td>
      <td>24</td>
      <td>01001</td>
      <td>26.686237</td>
      <td>0.0</td>
      <td>26.686237</td>
      <td>150.110081</td>
      <td>4.447706</td>
      <td>145.662375</td>
    </tr>
    <tr>
      <th>1441</th>
      <td>01002</td>
      <td>246601</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1002</td>
      <td>SK Kiel</td>
      <td>2021-11-24</td>
      <td>73</td>
      <td>0</td>
      <td>73</td>
      <td>01002</td>
      <td>29.602475</td>
      <td>0.0</td>
      <td>29.602475</td>
      <td>140.307622</td>
      <td>0.405513</td>
      <td>139.902109</td>
    </tr>
    <tr>
      <th>2190</th>
      <td>01003</td>
      <td>215846</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1003</td>
      <td>SK Lübeck</td>
      <td>2021-11-24</td>
      <td>79</td>
      <td>0</td>
      <td>79</td>
      <td>01003</td>
      <td>36.600169</td>
      <td>0.0</td>
      <td>36.600169</td>
      <td>166.785579</td>
      <td>0.463293</td>
      <td>166.322285</td>
    </tr>
    <tr>
      <th>2939</th>
      <td>01004</td>
      <td>79905</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1004</td>
      <td>SK Neumünster</td>
      <td>2021-11-24</td>
      <td>42</td>
      <td>0</td>
      <td>42</td>
      <td>01004</td>
      <td>52.562418</td>
      <td>0.0</td>
      <td>52.562418</td>
      <td>202.740755</td>
      <td>1.251486</td>
      <td>201.489269</td>
    </tr>
    <tr>
      <th>3688</th>
      <td>01051</td>
      <td>133251</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1051</td>
      <td>LK Dithmarschen</td>
      <td>2021-11-24</td>
      <td>19</td>
      <td>0</td>
      <td>19</td>
      <td>01051</td>
      <td>14.258805</td>
      <td>0.0</td>
      <td>14.258805</td>
      <td>93.807926</td>
      <td>0.000000</td>
      <td>93.807926</td>
    </tr>
  </tbody>
</table>
</div>




```python
data_Max4W_Geom = pd.merge(data_Max4W, kreise_geom, left_on="IdLandkreis_str", right_on="AGS", how='right')
data_Max4W_Geom.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AGS_x</th>
      <th>EWZ</th>
      <th>EWZ_BL</th>
      <th>IdBundesland</th>
      <th>Bundesland</th>
      <th>IdLandkreis</th>
      <th>Landkreis</th>
      <th>Meldedatum</th>
      <th>AnzahlFall</th>
      <th>AnzahlTodesfall</th>
      <th>...</th>
      <th>TodesfaelleEWZ</th>
      <th>GeneseneEWZ</th>
      <th>FaelleEWZ_7</th>
      <th>TodesfaelleEWZ_7</th>
      <th>GeneseneEWZ_7</th>
      <th>AGS_y</th>
      <th>SHAPE</th>
      <th>Shape__Area</th>
      <th>Shape__Length</th>
      <th>AGS_int</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2021-11-24</td>
      <td>24</td>
      <td>0</td>
      <td>...</td>
      <td>0.0</td>
      <td>26.686237</td>
      <td>150.110081</td>
      <td>4.447706</td>
      <td>145.662375</td>
      <td>01001</td>
      <td>{'rings': [[[526513.752884256, 6075133.4118775...</td>
      <td>4.918293e+07</td>
      <td>42752.592015</td>
      <td>1001</td>
    </tr>
    <tr>
      <th>1</th>
      <td>01002</td>
      <td>246601</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1002</td>
      <td>SK Kiel</td>
      <td>2021-11-24</td>
      <td>73</td>
      <td>0</td>
      <td>...</td>
      <td>0.0</td>
      <td>29.602475</td>
      <td>140.307622</td>
      <td>0.405513</td>
      <td>139.902109</td>
      <td>01002</td>
      <td>{'rings': [[[575841.569494392, 6032148.0317960...</td>
      <td>1.122314e+08</td>
      <td>104373.457289</td>
      <td>1002</td>
    </tr>
    <tr>
      <th>2</th>
      <td>01003</td>
      <td>215846</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1003</td>
      <td>SK Lübeck</td>
      <td>2021-11-24</td>
      <td>79</td>
      <td>0</td>
      <td>...</td>
      <td>0.0</td>
      <td>36.600169</td>
      <td>166.785579</td>
      <td>0.463293</td>
      <td>166.322285</td>
      <td>01003</td>
      <td>{'rings': [[[623056.150596513, 5983746.4452249...</td>
      <td>2.116771e+08</td>
      <td>146459.457897</td>
      <td>1003</td>
    </tr>
    <tr>
      <th>3</th>
      <td>01004</td>
      <td>79905</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1004</td>
      <td>SK Neumünster</td>
      <td>2021-11-24</td>
      <td>42</td>
      <td>0</td>
      <td>...</td>
      <td>0.0</td>
      <td>52.562418</td>
      <td>202.740755</td>
      <td>1.251486</td>
      <td>201.489269</td>
      <td>01004</td>
      <td>{'rings': [[[565015.651588687, 6000637.5134813...</td>
      <td>7.140224e+07</td>
      <td>54863.995416</td>
      <td>1004</td>
    </tr>
    <tr>
      <th>4</th>
      <td>01051</td>
      <td>133251</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1051</td>
      <td>LK Dithmarschen</td>
      <td>2021-11-24</td>
      <td>19</td>
      <td>0</td>
      <td>...</td>
      <td>0.0</td>
      <td>14.258805</td>
      <td>93.807926</td>
      <td>0.000000</td>
      <td>93.807926</td>
      <td>01051</td>
      <td>{'rings': [[[479877.791292057, 5990290.5867080...</td>
      <td>1.425511e+09</td>
      <td>250768.570200</td>
      <td>1051</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 23 columns</p>
</div>



Um die Daten darstellen zu können muss ein Layer in dem Projektordner erzeugt werden. Damit nicht zu viele Layer mit der Zeit angelegt werden wird ein möglicher zuvor erstellter Layer gelöscht.


```python
gis = GIS("home")
items = gis.content.search(query ='Corona-7Tageinzidenz4W')
for item in items:
    item.delete()
data_Max4W_fl = data_Max4W_Geom.spatial.to_featurelayer('Corona-7Tageinzidenz4W', tags=['Corona', 'COVID-19'], folder='Masterprojekt')
```

Dieser Layer kann nun in einer Karte angezeigt werden.


```python
gis = GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis")
map_Max4W = gis.map("Germany")
classed_color_renderer =  {"renderer":"ClassedColorRenderer", "field_name":"faelle_ewz_7" }
map_Max4W.add_layer(data_Max4W_fl, classed_color_renderer)
map_Max4W
```


    MapView(layout=Layout(height='400px', width='100%'))



<div class="map-static-img-preview-72cbbdba-d93a-459a-a897-85914e638960"><img src=""></img></div>



<div class="map-html-embed-preview-72cbbdba-d93a-459a-a897-85914e638960"></div>


### HotSpot-Analyse <a class="anchor" id="analyse-hsa"></a>

Es soll eine Hot Spot-Analyse für alle vier Wellenhochpunkte durchgeführt werden.

- 1. Welle: 16.03.2020
- 2. Welle: 16.12.2020
- 3. Welle: 21.04.2021
- 4. Welle: 24.11.2021

Eine Erklärung des Werkzeugs von ArcGIS ist unter diesem Link zu finden:
https://developers.arcgis.com/python/api-reference/arcgis.features.analyze_patterns.html#find-hot-spots

#### Maximum 1. Welle (16.03.2020)

Auch hier wird bei der Analyse ein Layer erzeugt. Damit nicht zu viele Layer mit der Zeit angelegt werden wird ein möglicher zuvor erstellter Layer gelöscht.

Nach der Durchführung der Hot Spot-Analyse über **arcgis.features.analyze_patterns.find_hot_spots()** wird der Ergebnislayer noch in den Projektordner verschoben.


```python
gis = GIS("home")
items = gis.content.search(query ='HotSpot_1W')
for item in items:
    item.delete()
hotspot_1W = arcgis.features.analyze_patterns.find_hot_spots(data_Max1W_fl, analysis_field="faelle_ewz_7", output_name="HotSpot_1W", distance_band=None, distance_band_unit=None)
hotspot_1W.move('Masterprojekt')
```




    {'success': True,
     'itemId': 'ee8798280ab24aa0a1fd86222011089f',
     'owner': 'ni2758',
     'folder': '352ee0cfa24142e5acf961c3c4dbd256'}



Dieser Layer kann nun in einer Karte angezeigt werden.


```python
gis = GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis")
map_HS_1W = gis.map("Germany")
map_HS_1W.add_layer(hotspot_1W)
map_HS_1W
```


    MapView(layout=Layout(height='400px', width='100%'))



<div class="map-static-img-preview-7a3f0c29-4817-474d-a781-a77de168f3a0"><img src=""></img></div>



<div class="map-html-embed-preview-7a3f0c29-4817-474d-a781-a77de168f3a0"></div>


#### Maximum 2. Welle (16.12.2020)

Auch hier wird bei der Analyse ein Layer erzeugt. Damit nicht zu viele Layer mit der Zeit angelegt werden wird ein möglicher zuvor erstellter Layer gelöscht.

Nach der Durchführung der Hot Spot-Analyse über **arcgis.features.analyze_patterns.find_hot_spots()** wird der Ergebnislayer noch in den Projektordner verschoben.


```python
gis = GIS("home")
items = gis.content.search(query ='HotSpot_2W')
for item in items:
    item.delete()
hotspot_2W = arcgis.features.analyze_patterns.find_hot_spots(data_Max2W_fl, analysis_field="faelle_ewz_7", output_name="HotSpot_2W", distance_band=None, distance_band_unit=None)
hotspot_2W.move('Masterprojekt')
```




    {'success': True,
     'itemId': '007a0ce24ac941039dc0d7abfdeba27e',
     'owner': 'ni2758',
     'folder': '352ee0cfa24142e5acf961c3c4dbd256'}



Dieser Layer kann nun in einer Karte angezeigt werden.


```python
gis = GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis")
map_HS_2W = gis.map("Germany")
map_HS_2W.add_layer(hotspot_2W)
map_HS_2W
```


    MapView(layout=Layout(height='400px', width='100%'))



<div class="map-static-img-preview-de3977f8-7bfb-4ce9-8424-e0c70e86e328"><img src=""></img></div>



<div class="map-html-embed-preview-de3977f8-7bfb-4ce9-8424-e0c70e86e328"></div>


#### Maximum 3. Welle (21.04.2021)

Auch hier wird bei der Analyse ein Layer erzeugt. Damit nicht zu viele Layer mit der Zeit angelegt werden wird ein möglicher zuvor erstellter Layer gelöscht.

Nach der Durchführung der Hot Spot-Analyse über **arcgis.features.analyze_patterns.find_hot_spots()** wird der Ergebnislayer noch in den Projektordner verschoben.


```python
gis = GIS("home")
items = gis.content.search(query ='HotSpot_3W')
for item in items:
    item.delete()
hotspot_3W = arcgis.features.analyze_patterns.find_hot_spots(data_Max3W_fl, analysis_field="faelle_ewz_7", output_name="HotSpot_3W", distance_band=None, distance_band_unit=None)
hotspot_3W.move('Masterprojekt')
```




    {'success': True,
     'itemId': '6e4db6699f774e9abe2cf405aa26ae5f',
     'owner': 'ni2758',
     'folder': '352ee0cfa24142e5acf961c3c4dbd256'}



Dieser Layer kann nun in einer Karte angezeigt werden.


```python
gis = GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis")
map_HS_3W = gis.map("Germany")
map_HS_3W.add_layer(hotspot_3W)
map_HS_3W
```


    MapView(layout=Layout(height='400px', width='100%'))



<div class="map-static-img-preview-344f8d3a-dbdd-488d-a2c8-ec9d1ee2313b"><img src=""></img></div>



<div class="map-html-embed-preview-344f8d3a-dbdd-488d-a2c8-ec9d1ee2313b"></div>


#### Maximum 4. Welle (24.11.2021)

Auch hier wird bei der Analyse ein Layer erzeugt. Damit nicht zu viele Layer mit der Zeit angelegt werden wird ein möglicher zuvor erstellter Layer gelöscht.

Nach der Durchführung der Hot Spot-Analyse über **arcgis.features.analyze_patterns.find_hot_spots()** wird der Ergebnislayer noch in den Projektordner verschoben.


```python
gis = GIS("home")
items = gis.content.search(query ='HotSpot_4W')
for item in items:
    item.delete()
hotspot_4W = arcgis.features.analyze_patterns.find_hot_spots(data_Max4W_fl, analysis_field="faelle_ewz_7", output_name="HotSpot_4W", distance_band=None, distance_band_unit=None)
hotspot_4W.move('Masterprojekt')
```




    {'success': True,
     'itemId': '389537c2ce774f75a36dfbd804043182',
     'owner': 'ni2758',
     'folder': '352ee0cfa24142e5acf961c3c4dbd256'}



Dieser Layer kann nun in einer Karte angezeigt werden.


```python
gis = GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis")
map_HS_4W = gis.map("Germany")
map_HS_4W.add_layer(hotspot_4W)
map_HS_4W
```


    MapView(layout=Layout(height='400px', width='100%'))



<div class="map-static-img-preview-30558d8c-fc12-4258-9f3b-757d65569186"><img src=""></img></div>



<div class="map-html-embed-preview-30558d8c-fc12-4258-9f3b-757d65569186"></div>


### Ausreißer-Analyse <a class="anchor" id="analyse-outlier"></a>

Es soll eine Ausreißer-Analyse für alle vier Wellenhochpunkte durchgeführt werden.

- 1. Welle: 16.03.2020
- 2. Welle: 16.12.2020
- 3. Welle: 21.04.2021
- 4. Welle: 24.11.2021

#### 1. Welle (16.03.2020)

Auch hier wird bei der Analyse ein Layer erzeugt. Damit nicht zu viele Layer mit der Zeit angelegt werden wird ein möglicher zuvor erstellter Layer gelöscht.

Nach der Durchführung der Ausreißer-Analyse über **arcgis.features.analyze_patterns.find_outliers()** wird der Ergebnislayer noch in den Projektordner verschoben.


```python
gis = GIS("home")
items = gis.content.search(query ='Outliers_1W')
for item in items:
    item.delete()
outliers_1W_Res = arcgis.features.analyze_patterns.find_outliers(data_Max1W_fl, analysis_field="faelle_ewz_7", output_name="Outliers_1W")
outliers_1W = outliers_1W_Res['outliers_result_layer']
outliers_1W.move('Masterprojekt')
```




    {'success': True,
     'itemId': 'a5d1c99eeb01408ebf6f8d78a3bc5b15',
     'owner': 'ni2758',
     'folder': '352ee0cfa24142e5acf961c3c4dbd256'}



Dieser Layer kann nun in einer Karte angezeigt werden.


```python
gis = GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis")
map_Out_1W = gis.map("Germany")
map_Out_1W.add_layer(outliers_1W)
map_Out_1W
```


    MapView(layout=Layout(height='400px', width='100%'))



<div class="map-static-img-preview-049eec35-1b9d-45bb-a834-932a92f6e108"><img src=""></img></div>



<div class="map-html-embed-preview-049eec35-1b9d-45bb-a834-932a92f6e108"></div>


#### 2. Welle (16.12.2020)

Auch hier wird bei der Analyse ein Layer erzeugt. Damit nicht zu viele Layer mit der Zeit angelegt werden wird ein möglicher zuvor erstellter Layer gelöscht.

Nach der Durchführung der Ausreißer-Analyse über **arcgis.features.analyze_patterns.find_outliers()** wird der Ergebnislayer noch in den Projektordner verschoben.


```python
gis = GIS("home")
items = gis.content.search(query ='Outliers_2W')
for item in items:
    item.delete()
outliers_2W_Res = arcgis.features.analyze_patterns.find_outliers(data_Max2W_fl, analysis_field="faelle_ewz_7", output_name="Outliers_2W")
outliers_2W = outliers_2W_Res['outliers_result_layer']
outliers_2W.move('Masterprojekt')
```




    {'success': True,
     'itemId': '79fa7d71c6064d5eb70efd07251c3e34',
     'owner': 'ni2758',
     'folder': '352ee0cfa24142e5acf961c3c4dbd256'}



Dieser Layer kann nun in einer Karte angezeigt werden.


```python
gis = GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis")
map_Out_2W = gis.map("Germany")
map_Out_2W.add_layer(outliers_2W)
map_Out_2W
```


    MapView(layout=Layout(height='400px', width='100%'))



<div class="map-static-img-preview-6135a2de-7534-4bf8-9b3c-226eec508a55"><img src=""></img></div>



<div class="map-html-embed-preview-6135a2de-7534-4bf8-9b3c-226eec508a55"></div>


#### 3. Welle (21.04.2021)

Auch hier wird bei der Analyse ein Layer erzeugt. Damit nicht zu viele Layer mit der Zeit angelegt werden wird ein möglicher zuvor erstellter Layer gelöscht.

Nach der Durchführung der Ausreißer-Analyse über **arcgis.features.analyze_patterns.find_outliers()** wird der Ergebnislayer noch in den Projektordner verschoben.


```python
gis = GIS("home")
items = gis.content.search(query ='Outliers_3W')
for item in items:
    item.delete()
outliers_3W_Res = arcgis.features.analyze_patterns.find_outliers(data_Max3W_fl, analysis_field="faelle_ewz_7", output_name="Outliers_3W")
outliers_3W = outliers_3W_Res['outliers_result_layer']
outliers_3W.move('Masterprojekt')
```




    {'success': True,
     'itemId': '34d4cde5e9614bd2a7c564e66c87fb86',
     'owner': 'ni2758',
     'folder': '352ee0cfa24142e5acf961c3c4dbd256'}



Dieser Layer kann nun in einer Karte angezeigt werden.


```python
gis = GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis")
map_Out_3W = gis.map("Germany")
map_Out_3W.add_layer(outliers_3W)
map_Out_3W
```


    MapView(layout=Layout(height='400px', width='100%'))



<div class="map-static-img-preview-47c862c9-b644-4992-a907-72b2130a9c2e"><img src=""></img></div>



<div class="map-html-embed-preview-47c862c9-b644-4992-a907-72b2130a9c2e"></div>


#### 4. Welle (24.11.2021)

Auch hier wird bei der Analyse ein Layer erzeugt. Damit nicht zu viele Layer mit der Zeit angelegt werden wird ein möglicher zuvor erstellter Layer gelöscht.

Nach der Durchführung der Ausreißer-Analyse über **arcgis.features.analyze_patterns.find_outliers()** wird der Ergebnislayer noch in den Projektordner verschoben.


```python
gis = GIS("home")
items = gis.content.search(query ='Outliers_4W')
for item in items:
    item.delete()
outliers_4W_Res = arcgis.features.analyze_patterns.find_outliers(data_Max4W_fl, analysis_field="faelle_ewz_7", output_name="Outliers_4W")
outliers_4W = outliers_4W_Res['outliers_result_layer']
outliers_4W.move('Masterprojekt')
```




    {'success': True,
     'itemId': '22853fc19fb34390b493a1448b67da59',
     'owner': 'ni2758',
     'folder': '352ee0cfa24142e5acf961c3c4dbd256'}



Dieser Layer kann nun in einer Karte angezeigt werden.


```python
gis = GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis")
map_Out_4W = gis.map("Germany")
map_Out_4W.add_layer(outliers_4W)
map_Out_4W
```


    MapView(layout=Layout(height='400px', width='100%'))



<div class="map-static-img-preview-3b1987ba-fd01-4637-b07c-a37db9d514a6"><img src=""></img></div>



<div class="map-html-embed-preview-3b1987ba-fd01-4637-b07c-a37db9d514a6"></div>


### Space-Time Cubes <a class="anchor" id="analyse-stc"></a>

Es sollen Space-Time Cubes für alle vier Wellen durchgeführt werden.

- 1. Welle: 02.03.2020 - 19.04.2020
- 2. Welle: 05.10.2020 - 31.01.2021
- 3. Welle: 01.03.2021 - 16.05.2021
- 4. Welle: 04.10.2021 - 02.01.2022

Dabei werden arcpy-Funktionen verwendet. Dafür müssen die Kreisgeometrien zunächst in der Geodatabase abgespeichert werden.


```python
path_geom = os.path.join(results_dir, 'kreise_geom')
kreise_geom.spatial.to_featureclass(path_geom)
```

    /opt/conda/lib/python3.7/site-packages/pandas/core/indexing.py:1720: SettingWithCopyWarning:
    
    
    A value is trying to be set on a copy of a slice from a DataFrame.
    Try using .loc[row_indexer,col_indexer] = value instead
    
    See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
    





    '/arcgis/home/Results.gdb/kreise_geom'



#### Space Time Cubes berechnen <a class="anchor" id="analyse-stc-create"></a>

Die Funktionsweise der Space-Time Cubes kann unter folgenden Link nachvollzogen werden: 
https://pro.arcgis.com/de/pro-app/latest/tool-reference/space-time-pattern-mining/createcubefromdefinedlocations.htm

##### kleine Datenmenge (10.12.2020 - 24.12.2020)

Testweise wurden der Space-Time Cube für eine kleiner Datenmenge von zwei Wochen (10.12.2020 - 24.12.2020) durchgeführt. Dieser Zeitraum muss aus den Daten extrahiert und ebenfalls in der Geodatabase als Tabelle abgespeichert werden.


```python
data_stc_test = data_ewz.loc[(data_ewz['Meldedatum']>='2020-12-10') & (data_ewz['Meldedatum']<='2020-12-24')]
data_stc_test
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AGS</th>
      <th>EWZ</th>
      <th>EWZ_BL</th>
      <th>IdBundesland</th>
      <th>Bundesland</th>
      <th>IdLandkreis</th>
      <th>Landkreis</th>
      <th>Meldedatum</th>
      <th>AnzahlFall</th>
      <th>AnzahlTodesfall</th>
      <th>AnzahlGenesen</th>
      <th>IdLandkreis_str</th>
      <th>FaelleEWZ</th>
      <th>TodesfaelleEWZ</th>
      <th>GeneseneEWZ</th>
      <th>FaelleEWZ_7</th>
      <th>TodesfaelleEWZ_7</th>
      <th>GeneseneEWZ_7</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>343</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2020-12-10</td>
      <td>10</td>
      <td>0</td>
      <td>10</td>
      <td>01001</td>
      <td>11.119265</td>
      <td>0.000000</td>
      <td>11.119265</td>
      <td>30.022016</td>
      <td>0.000000</td>
      <td>30.022016</td>
    </tr>
    <tr>
      <th>344</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2020-12-11</td>
      <td>6</td>
      <td>1</td>
      <td>5</td>
      <td>01001</td>
      <td>6.671559</td>
      <td>1.111927</td>
      <td>5.559633</td>
      <td>33.357796</td>
      <td>1.111927</td>
      <td>32.245869</td>
    </tr>
    <tr>
      <th>345</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2020-12-12</td>
      <td>5</td>
      <td>1</td>
      <td>4</td>
      <td>01001</td>
      <td>5.559633</td>
      <td>1.111927</td>
      <td>4.447706</td>
      <td>37.805502</td>
      <td>2.223853</td>
      <td>35.581649</td>
    </tr>
    <tr>
      <th>346</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2020-12-13</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>01001</td>
      <td>1.111927</td>
      <td>0.000000</td>
      <td>1.111927</td>
      <td>35.581649</td>
      <td>2.223853</td>
      <td>33.357796</td>
    </tr>
    <tr>
      <th>347</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2020-12-14</td>
      <td>15</td>
      <td>2</td>
      <td>13</td>
      <td>01001</td>
      <td>16.678898</td>
      <td>2.223853</td>
      <td>14.455045</td>
      <td>51.148620</td>
      <td>4.447706</td>
      <td>46.700914</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>307443</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2020-12-20</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>16077</td>
      <td>1.131785</td>
      <td>0.000000</td>
      <td>1.131785</td>
      <td>530.807189</td>
      <td>13.581421</td>
      <td>517.225768</td>
    </tr>
    <tr>
      <th>307444</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2020-12-21</td>
      <td>67</td>
      <td>5</td>
      <td>62</td>
      <td>16077</td>
      <td>75.829598</td>
      <td>5.658925</td>
      <td>70.170673</td>
      <td>588.528227</td>
      <td>18.108561</td>
      <td>570.419666</td>
    </tr>
    <tr>
      <th>307445</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2020-12-22</td>
      <td>70</td>
      <td>2</td>
      <td>68</td>
      <td>16077</td>
      <td>79.224954</td>
      <td>2.263570</td>
      <td>76.961383</td>
      <td>594.187152</td>
      <td>16.976776</td>
      <td>577.210376</td>
    </tr>
    <tr>
      <th>307446</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2020-12-23</td>
      <td>71</td>
      <td>4</td>
      <td>67</td>
      <td>16077</td>
      <td>80.356739</td>
      <td>4.527140</td>
      <td>75.829598</td>
      <td>553.442890</td>
      <td>18.108561</td>
      <td>535.334329</td>
    </tr>
    <tr>
      <th>307447</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2020-12-24</td>
      <td>146</td>
      <td>3</td>
      <td>143</td>
      <td>16077</td>
      <td>165.240618</td>
      <td>3.395355</td>
      <td>161.845262</td>
      <td>605.505002</td>
      <td>16.976776</td>
      <td>588.528227</td>
    </tr>
  </tbody>
</table>
<p>6165 rows × 18 columns</p>
</div>




```python
path_test = os.path.join(results_dir, 'data_test')
data_stc_test.spatial.to_table(path_test)
```




    '/arcgis/home/Results.gdb/data_test'



Falls der zu erstellende Space-Time Cube aus vorherigen Durchläufen bereits vorliegt wird dieser gelöscht.

Da die Daten an festgelegten Position vorliegen, wird der Space-Time Cubes über die arcpy Funktion **arcpy.stpm.CreateSpaceTimeCubeDefinedLocations()** berechnet und in der Geodatabase abgelegt.


```python
arcpy.management.Delete(os.path.join(home_dir, 'stc_Test.nc'))
stc_test = arcpy.stpm.CreateSpaceTimeCubeDefinedLocations(path_geom, os.path.join(home_dir, 'stc_Test.nc'), 'AGS_int','NO_TEMPORAL_AGGREGATION', 'meldedatum', '1 Days', '', '', 'FaelleEWZ_7 ZEROS', '', path_test, 'IdLandkreis')
```

    
    ---------- Space Time Cube Characteristics -----------
    Input feature time extent          2020-12-10 00:00:00
                                    to 2020-12-24 00:00:00
                                                          
    Number of time steps                                15
    Time step interval                               1 day
    Time step alignment                                End
                                                          
    First time step temporal bias                    0.00%
    First time step interval                         after
                                       2020-12-09 00:00:00
                                           to on or before
                                       2020-12-10 00:00:00
                                                          
    Last time step temporal bias                     0.00%
    Last time step interval                          after
                                       2020-12-23 00:00:00
                                           to on or before
                                       2020-12-24 00:00:00
                                                          
    Coordinate System               ETRS 1989 UTM Zone 32N
    Cube extent across space       (coordinates in meters)
    Min X                                      280371.0591
    Min Y                                     5235855.9768
    Max X                                      921292.3712
    Max Y                                     6101443.7125
    
    
    Locations                                          411
    % of locations with estimated observations        0.00
    - Total number                                       0
    Total observations                                6165
    % of all observations that were estimated         0.00
    - Total number                                       0
    
    
    ---- Overall Data Trend - FAELLEEWZ_7_NONE_ZEROS -----
    Trend direction                             Increasing
    Trend statistic                                 4.6518
    Trend p-value                                   0.0000
    


##### 1. Welle (02.03.2020 - 19.04.2020)

Die Daten der ersten Welle müssen aus den gesamten Daten extrahiert und ebenfalls in der Geodatabase als Tabelle abgespeichert werden.


```python
data_stc_1W = data_ewz.loc[(data_ewz['Meldedatum']>='2020-03-02') & (data_ewz['Meldedatum']<='2020-04-19')]
data_stc_1W
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AGS</th>
      <th>EWZ</th>
      <th>EWZ_BL</th>
      <th>IdBundesland</th>
      <th>Bundesland</th>
      <th>IdLandkreis</th>
      <th>Landkreis</th>
      <th>Meldedatum</th>
      <th>AnzahlFall</th>
      <th>AnzahlTodesfall</th>
      <th>AnzahlGenesen</th>
      <th>IdLandkreis_str</th>
      <th>FaelleEWZ</th>
      <th>TodesfaelleEWZ</th>
      <th>GeneseneEWZ</th>
      <th>FaelleEWZ_7</th>
      <th>TodesfaelleEWZ_7</th>
      <th>GeneseneEWZ_7</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>60</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2020-03-02</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>01001</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>61</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2020-03-03</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>01001</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>62</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2020-03-04</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>01001</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>63</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2020-03-05</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>01001</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>64</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2020-03-06</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>01001</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>307194</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2020-04-15</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>16077</td>
      <td>1.131785</td>
      <td>0.0</td>
      <td>1.131785</td>
      <td>5.658925</td>
      <td>1.131785</td>
      <td>4.527140</td>
    </tr>
    <tr>
      <th>307195</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2020-04-16</td>
      <td>3</td>
      <td>0</td>
      <td>3</td>
      <td>16077</td>
      <td>3.395355</td>
      <td>0.0</td>
      <td>3.395355</td>
      <td>7.922495</td>
      <td>0.000000</td>
      <td>7.922495</td>
    </tr>
    <tr>
      <th>307196</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2020-04-17</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>16077</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>5.658925</td>
      <td>0.000000</td>
      <td>5.658925</td>
    </tr>
    <tr>
      <th>307197</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2020-04-18</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>16077</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>5.658925</td>
      <td>0.000000</td>
      <td>5.658925</td>
    </tr>
    <tr>
      <th>307198</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2020-04-19</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>16077</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>5.658925</td>
      <td>0.000000</td>
      <td>5.658925</td>
    </tr>
  </tbody>
</table>
<p>20139 rows × 18 columns</p>
</div>




```python
path_1W = os.path.join(results_dir, 'data_1W')
data_stc_1W.spatial.to_table(path_1W)
```




    '/arcgis/home/Results.gdb/data_1W'



Falls der zu erstellende Space-Time Cube aus vorherigen Durchläufen bereits vorliegt wird dieser gelöscht.

Da die Daten an festgelegten Position vorliegen, wird der Space-Time Cubes über die arcpy Funktion **arcpy.stpm.CreateSpaceTimeCubeDefinedLocations()** berechnet und in der Geodatabase abgelegt.


```python
arcpy.management.Delete(os.path.join(home_dir, 'stc_1W.nc'))
stc_1W = arcpy.stpm.CreateSpaceTimeCubeDefinedLocations(path_geom, os.path.join(home_dir, 'stc_1W.nc'), 'AGS_int', 'APPLY_TEMPORAL_AGGREGATION', 'meldedatum', '3 Days', 'END_TIME', '', '','FaelleEWZ_7 MEAN ZEROS', path_1W, 'IdLandkreis')
```

    
    ---------- Space Time Cube Characteristics -----------
    Input feature time extent          2020-03-02 00:00:00
                                    to 2020-04-19 00:00:00
                                                          
    Number of time steps                                17
    Time step interval                              3 days
    Time step alignment                                End
                                                          
    First time step temporal bias                  100.00%
    First time step interval                         after
                                       2020-02-28 00:00:00
                                           to on or before
                                       2020-03-02 00:00:00
                                                          
    Last time step temporal bias                     0.00%
    Last time step interval                          after
                                       2020-04-16 00:00:00
                                           to on or before
                                       2020-04-19 00:00:00
                                                          
    Coordinate System               ETRS 1989 UTM Zone 32N
    Cube extent across space       (coordinates in meters)
    Min X                                      280371.0591
    Min Y                                     5235855.9768
    Max X                                      921292.3712
    Max Y                                     6101443.7125
    
    
    Locations                                          411
    % of locations with estimated observations        0.00
    - Total number                                       0
    Total observations                                6987
    % of all observations that were estimated         0.00
    - Total number                                       0
    
    
    ---- Overall Data Trend - FAELLEEWZ_7_MEAN_ZEROS -----
    Trend direction                             Increasing
    Trend statistic                                 3.5014
    Trend p-value                                   0.0005
    
    
    -- Overall Data Trend - TEMPORAL_AGGREGATION_COUNT ---
    Trend direction                        Not Significant
    Trend statistic                                 1.5309
    Trend p-value                                   0.1258
    


##### 2. Welle (05.10.2020 - 31.01.2021)

Die Daten der zweiten Welle müssen aus den gesamten Daten extrahiert und ebenfalls in der Geodatabase als Tabelle abgespeichert werden.


```python
data_stc_2W = data_ewz.loc[(data_ewz['Meldedatum']>='2020-10-05') & (data_ewz['Meldedatum']<='2021-01-31')]
data_stc_2W
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AGS</th>
      <th>EWZ</th>
      <th>EWZ_BL</th>
      <th>IdBundesland</th>
      <th>Bundesland</th>
      <th>IdLandkreis</th>
      <th>Landkreis</th>
      <th>Meldedatum</th>
      <th>AnzahlFall</th>
      <th>AnzahlTodesfall</th>
      <th>AnzahlGenesen</th>
      <th>IdLandkreis_str</th>
      <th>FaelleEWZ</th>
      <th>TodesfaelleEWZ</th>
      <th>GeneseneEWZ</th>
      <th>FaelleEWZ_7</th>
      <th>TodesfaelleEWZ_7</th>
      <th>GeneseneEWZ_7</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>277</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2020-10-05</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>01001</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>16.678898</td>
      <td>0.000000</td>
      <td>16.678898</td>
    </tr>
    <tr>
      <th>278</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2020-10-06</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>01001</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>13.343118</td>
      <td>0.000000</td>
      <td>13.343118</td>
    </tr>
    <tr>
      <th>279</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2020-10-07</td>
      <td>3</td>
      <td>0</td>
      <td>3</td>
      <td>01001</td>
      <td>3.335780</td>
      <td>0.000000</td>
      <td>3.335780</td>
      <td>13.343118</td>
      <td>0.000000</td>
      <td>13.343118</td>
    </tr>
    <tr>
      <th>280</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2020-10-08</td>
      <td>5</td>
      <td>0</td>
      <td>5</td>
      <td>01001</td>
      <td>5.559633</td>
      <td>0.000000</td>
      <td>5.559633</td>
      <td>12.231192</td>
      <td>0.000000</td>
      <td>12.231192</td>
    </tr>
    <tr>
      <th>281</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2020-10-09</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>01001</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>8.895412</td>
      <td>0.000000</td>
      <td>8.895412</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>307481</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2021-01-27</td>
      <td>32</td>
      <td>1</td>
      <td>31</td>
      <td>16077</td>
      <td>36.217122</td>
      <td>1.131785</td>
      <td>35.085337</td>
      <td>229.752365</td>
      <td>7.922495</td>
      <td>221.829870</td>
    </tr>
    <tr>
      <th>307482</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2021-01-28</td>
      <td>14</td>
      <td>0</td>
      <td>14</td>
      <td>16077</td>
      <td>15.844991</td>
      <td>0.000000</td>
      <td>15.844991</td>
      <td>185.612748</td>
      <td>5.658925</td>
      <td>179.953823</td>
    </tr>
    <tr>
      <th>307483</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2021-01-29</td>
      <td>32</td>
      <td>1</td>
      <td>31</td>
      <td>16077</td>
      <td>36.217122</td>
      <td>1.131785</td>
      <td>35.085337</td>
      <td>191.271674</td>
      <td>6.790710</td>
      <td>184.480963</td>
    </tr>
    <tr>
      <th>307484</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2021-01-30</td>
      <td>40</td>
      <td>5</td>
      <td>35</td>
      <td>16077</td>
      <td>45.271402</td>
      <td>5.658925</td>
      <td>39.612477</td>
      <td>202.589524</td>
      <td>11.317851</td>
      <td>191.271674</td>
    </tr>
    <tr>
      <th>307485</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2021-01-31</td>
      <td>10</td>
      <td>3</td>
      <td>7</td>
      <td>16077</td>
      <td>11.317851</td>
      <td>3.395355</td>
      <td>7.922495</td>
      <td>203.721309</td>
      <td>14.713206</td>
      <td>189.008104</td>
    </tr>
  </tbody>
</table>
<p>48909 rows × 18 columns</p>
</div>




```python
path_2W = os.path.join(results_dir, 'data_2W')
data_stc_2W.spatial.to_table(path_2W)
```




    '/arcgis/home/Results.gdb/data_2W'



Falls der zu erstellende Space-Time Cube aus vorherigen Durchläufen bereits vorliegt wird dieser gelöscht.

Da die Daten an festgelegten Position vorliegen, wird der Space-Time Cubes über die arcpy Funktion **arcpy.stpm.CreateSpaceTimeCubeDefinedLocations()** berechnet und in der Geodatabase abgelegt.


```python
arcpy.management.Delete(os.path.join(home_dir, 'stc_2W.nc'))
stc_2W = arcpy.stpm.CreateSpaceTimeCubeDefinedLocations(path_geom, os.path.join(home_dir, 'stc_2W.nc'), 'AGS_int', 'APPLY_TEMPORAL_AGGREGATION', 'meldedatum', '1 Weeks', 'END_TIME', '', '','FaelleEWZ_7 MEAN ZEROS', path_2W, 'IdLandkreis')
```

    
    ---------- Space Time Cube Characteristics -----------
    Input feature time extent          2020-10-05 00:00:00
                                    to 2021-01-31 00:00:00
                                                          
    Number of time steps                                17
    Time step interval                              1 week
    Time step alignment                                End
                                                          
    First time step temporal bias                   14.29%
    First time step interval                         after
                                       2020-10-04 00:00:00
                                           to on or before
                                       2020-10-11 00:00:00
                                                          
    Last time step temporal bias                     0.00%
    Last time step interval                          after
                                       2021-01-24 00:00:00
                                           to on or before
                                       2021-01-31 00:00:00
                                                          
    Coordinate System               ETRS 1989 UTM Zone 32N
    Cube extent across space       (coordinates in meters)
    Min X                                      280371.0591
    Min Y                                     5235855.9768
    Max X                                      921292.3712
    Max Y                                     6101443.7125
    
    
    Locations                                          411
    % of locations with estimated observations        0.00
    - Total number                                       0
    Total observations                                6987
    % of all observations that were estimated         0.00
    - Total number                                       0
    
    
    ---- Overall Data Trend - FAELLEEWZ_7_MEAN_ZEROS -----
    Trend direction                             Increasing
    Trend statistic                                 2.8423
    Trend p-value                                   0.0045
    
    
    -- Overall Data Trend - TEMPORAL_AGGREGATION_COUNT ---
    Trend direction                        Not Significant
    Trend statistic                                 0.0000
    Trend p-value                                   1.0000
    


##### 3. Welle (01.03.2021 - 16.05.2021)

Die Daten der dritten Welle müssen aus den gesamten Daten extrahiert und ebenfalls in der Geodatabase als Tabelle abgespeichert werden.


```python
data_stc_3W = data_ewz.loc[(data_ewz['Meldedatum']>='2021-03-01') & (data_ewz['Meldedatum']<='2021-05-16')]
data_stc_3W
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AGS</th>
      <th>EWZ</th>
      <th>EWZ_BL</th>
      <th>IdBundesland</th>
      <th>Bundesland</th>
      <th>IdLandkreis</th>
      <th>Landkreis</th>
      <th>Meldedatum</th>
      <th>AnzahlFall</th>
      <th>AnzahlTodesfall</th>
      <th>AnzahlGenesen</th>
      <th>IdLandkreis_str</th>
      <th>FaelleEWZ</th>
      <th>TodesfaelleEWZ</th>
      <th>GeneseneEWZ</th>
      <th>FaelleEWZ_7</th>
      <th>TodesfaelleEWZ_7</th>
      <th>GeneseneEWZ_7</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>424</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2021-03-01</td>
      <td>17</td>
      <td>0</td>
      <td>17</td>
      <td>01001</td>
      <td>18.902751</td>
      <td>0.000000</td>
      <td>18.902751</td>
      <td>162.341272</td>
      <td>0.000000</td>
      <td>162.341272</td>
    </tr>
    <tr>
      <th>425</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2021-03-02</td>
      <td>11</td>
      <td>1</td>
      <td>10</td>
      <td>01001</td>
      <td>12.231192</td>
      <td>1.111927</td>
      <td>11.119265</td>
      <td>153.445860</td>
      <td>1.111927</td>
      <td>152.333934</td>
    </tr>
    <tr>
      <th>426</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2021-03-03</td>
      <td>24</td>
      <td>0</td>
      <td>24</td>
      <td>01001</td>
      <td>26.686237</td>
      <td>0.000000</td>
      <td>26.686237</td>
      <td>145.662375</td>
      <td>1.111927</td>
      <td>144.550448</td>
    </tr>
    <tr>
      <th>427</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2021-03-04</td>
      <td>12</td>
      <td>0</td>
      <td>12</td>
      <td>01001</td>
      <td>13.343118</td>
      <td>0.000000</td>
      <td>13.343118</td>
      <td>132.319256</td>
      <td>1.111927</td>
      <td>131.207330</td>
    </tr>
    <tr>
      <th>428</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2021-03-05</td>
      <td>7</td>
      <td>0</td>
      <td>7</td>
      <td>01001</td>
      <td>7.783486</td>
      <td>0.000000</td>
      <td>7.783486</td>
      <td>110.080726</td>
      <td>1.111927</td>
      <td>108.968799</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>307586</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2021-05-12</td>
      <td>25</td>
      <td>0</td>
      <td>25</td>
      <td>16077</td>
      <td>28.294626</td>
      <td>0.000000</td>
      <td>28.294626</td>
      <td>201.457739</td>
      <td>5.658925</td>
      <td>195.798814</td>
    </tr>
    <tr>
      <th>307587</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2021-05-13</td>
      <td>6</td>
      <td>0</td>
      <td>6</td>
      <td>16077</td>
      <td>6.790710</td>
      <td>0.000000</td>
      <td>6.790710</td>
      <td>143.736702</td>
      <td>4.527140</td>
      <td>139.209561</td>
    </tr>
    <tr>
      <th>307588</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2021-05-14</td>
      <td>16</td>
      <td>0</td>
      <td>16</td>
      <td>16077</td>
      <td>18.108561</td>
      <td>0.000000</td>
      <td>18.108561</td>
      <td>142.604916</td>
      <td>2.263570</td>
      <td>140.341346</td>
    </tr>
    <tr>
      <th>307589</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2021-05-15</td>
      <td>3</td>
      <td>0</td>
      <td>3</td>
      <td>16077</td>
      <td>3.395355</td>
      <td>0.000000</td>
      <td>3.395355</td>
      <td>118.837430</td>
      <td>1.131785</td>
      <td>117.705645</td>
    </tr>
    <tr>
      <th>307590</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2021-05-16</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>16077</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>108.651365</td>
      <td>0.000000</td>
      <td>108.651365</td>
    </tr>
  </tbody>
</table>
<p>31647 rows × 18 columns</p>
</div>




```python
path_3W = os.path.join(results_dir, 'data_3W')
data_stc_3W.spatial.to_table(path_3W)
```




    '/arcgis/home/Results.gdb/data_3W'



Falls der zu erstellende Space-Time Cube aus vorherigen Durchläufen bereits vorliegt wird dieser gelöscht.

Da die Daten an festgelegten Position vorliegen, wird der Space-Time Cubes über die arcpy Funktion **arcpy.stpm.CreateSpaceTimeCubeDefinedLocations()** berechnet und in der Geodatabase abgelegt.


```python
arcpy.management.Delete(os.path.join(home_dir, 'stc_3W.nc'))
stc_3W = arcpy.stpm.CreateSpaceTimeCubeDefinedLocations(path_geom, os.path.join(home_dir, 'stc_3W.nc'), 'AGS_int', 'APPLY_TEMPORAL_AGGREGATION', 'meldedatum', '1 Weeks', 'END_TIME', '', '','FaelleEWZ_7 MEAN ZEROS', path_3W, 'IdLandkreis')
```

    
    ---------- Space Time Cube Characteristics -----------
    Input feature time extent          2021-03-01 00:00:00
                                    to 2021-05-16 00:00:00
                                                          
    Number of time steps                                11
    Time step interval                              1 week
    Time step alignment                                End
                                                          
    First time step temporal bias                   14.29%
    First time step interval                         after
                                       2021-02-28 00:00:00
                                           to on or before
                                       2021-03-07 00:00:00
                                                          
    Last time step temporal bias                     0.00%
    Last time step interval                          after
                                       2021-05-09 00:00:00
                                           to on or before
                                       2021-05-16 00:00:00
                                                          
    Coordinate System               ETRS 1989 UTM Zone 32N
    Cube extent across space       (coordinates in meters)
    Min X                                      280371.0591
    Min Y                                     5235855.9768
    Max X                                      921292.3712
    Max Y                                     6101443.7125
    
    
    Locations                                          411
    % of locations with estimated observations        0.00
    - Total number                                       0
    Total observations                                4521
    % of all observations that were estimated         0.00
    - Total number                                       0
    
    
    ---- Overall Data Trend - FAELLEEWZ_7_MEAN_ZEROS -----
    Trend direction                             Increasing
    Trend statistic                                 1.8684
    Trend p-value                                   0.0617
    
    
    -- Overall Data Trend - TEMPORAL_AGGREGATION_COUNT ---
    Trend direction                        Not Significant
    Trend statistic                                 0.0000
    Trend p-value                                   1.0000
    


##### 4. Welle (04.10.2021 - 02.01.2022)

Die Daten der vierten Welle müssen aus den gesamten Daten extrahiert und ebenfalls in der Geodatabase als Tabelle abgespeichert werden.


```python
data_stc_4W = data_ewz.loc[(data_ewz['Meldedatum']>='2021-10-04') & (data_ewz['Meldedatum']<='2022-01-02')]
data_stc_4W
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AGS</th>
      <th>EWZ</th>
      <th>EWZ_BL</th>
      <th>IdBundesland</th>
      <th>Bundesland</th>
      <th>IdLandkreis</th>
      <th>Landkreis</th>
      <th>Meldedatum</th>
      <th>AnzahlFall</th>
      <th>AnzahlTodesfall</th>
      <th>AnzahlGenesen</th>
      <th>IdLandkreis_str</th>
      <th>FaelleEWZ</th>
      <th>TodesfaelleEWZ</th>
      <th>GeneseneEWZ</th>
      <th>FaelleEWZ_7</th>
      <th>TodesfaelleEWZ_7</th>
      <th>GeneseneEWZ_7</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>641</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2021-10-04</td>
      <td>5</td>
      <td>0</td>
      <td>5</td>
      <td>01001</td>
      <td>5.559633</td>
      <td>0.000000</td>
      <td>5.559633</td>
      <td>33.357796</td>
      <td>0.000000</td>
      <td>33.357796</td>
    </tr>
    <tr>
      <th>642</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2021-10-05</td>
      <td>2</td>
      <td>0</td>
      <td>2</td>
      <td>01001</td>
      <td>2.223853</td>
      <td>0.000000</td>
      <td>2.223853</td>
      <td>26.686237</td>
      <td>0.000000</td>
      <td>26.686237</td>
    </tr>
    <tr>
      <th>643</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2021-10-06</td>
      <td>4</td>
      <td>0</td>
      <td>4</td>
      <td>01001</td>
      <td>4.447706</td>
      <td>0.000000</td>
      <td>4.447706</td>
      <td>22.238530</td>
      <td>0.000000</td>
      <td>22.238530</td>
    </tr>
    <tr>
      <th>644</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2021-10-07</td>
      <td>6</td>
      <td>0</td>
      <td>6</td>
      <td>01001</td>
      <td>6.671559</td>
      <td>0.000000</td>
      <td>6.671559</td>
      <td>26.686237</td>
      <td>0.000000</td>
      <td>26.686237</td>
    </tr>
    <tr>
      <th>645</th>
      <td>01001</td>
      <td>89934</td>
      <td>2910875</td>
      <td>1</td>
      <td>Schleswig-Holstein</td>
      <td>1001</td>
      <td>SK Flensburg</td>
      <td>2021-10-08</td>
      <td>3</td>
      <td>0</td>
      <td>3</td>
      <td>01001</td>
      <td>3.335780</td>
      <td>0.000000</td>
      <td>3.335780</td>
      <td>25.574310</td>
      <td>0.000000</td>
      <td>25.574310</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>307817</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2021-12-29</td>
      <td>68</td>
      <td>1</td>
      <td>2</td>
      <td>16077</td>
      <td>76.961383</td>
      <td>1.131785</td>
      <td>2.263570</td>
      <td>328.217665</td>
      <td>1.131785</td>
      <td>70.170673</td>
    </tr>
    <tr>
      <th>307818</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2021-12-30</td>
      <td>54</td>
      <td>0</td>
      <td>4</td>
      <td>16077</td>
      <td>61.116393</td>
      <td>0.000000</td>
      <td>4.527140</td>
      <td>329.349450</td>
      <td>1.131785</td>
      <td>14.713206</td>
    </tr>
    <tr>
      <th>307819</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2021-12-31</td>
      <td>28</td>
      <td>1</td>
      <td>1</td>
      <td>16077</td>
      <td>31.689981</td>
      <td>1.131785</td>
      <td>1.131785</td>
      <td>330.481235</td>
      <td>2.263570</td>
      <td>12.449636</td>
    </tr>
    <tr>
      <th>307820</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2022-01-01</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>16077</td>
      <td>6.790710</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>327.085880</td>
      <td>2.263570</td>
      <td>11.317851</td>
    </tr>
    <tr>
      <th>307821</th>
      <td>16077</td>
      <td>88356</td>
      <td>2120237</td>
      <td>16</td>
      <td>Thüringen</td>
      <td>16077</td>
      <td>LK Altenburger Land</td>
      <td>2022-01-02</td>
      <td>10</td>
      <td>0</td>
      <td>1</td>
      <td>16077</td>
      <td>11.317851</td>
      <td>0.000000</td>
      <td>1.131785</td>
      <td>335.008375</td>
      <td>2.263570</td>
      <td>11.317851</td>
    </tr>
  </tbody>
</table>
<p>37401 rows × 18 columns</p>
</div>




```python
path_4W = os.path.join(results_dir, 'data_4W')
data_stc_4W.spatial.to_table(path_4W)
```




    '/arcgis/home/Results.gdb/data_4W'



Falls der zu erstellende Space-Time Cube aus vorherigen Durchläufen bereits vorliegt wird dieser gelöscht.

Da die Daten an festgelegten Position vorliegen, wird der Space-Time Cubes über die arcpy Funktion **arcpy.stpm.CreateSpaceTimeCubeDefinedLocations()** berechnet und in der Geodatabase abgelegt.


```python
arcpy.management.Delete(os.path.join(home_dir, 'stc_4W.nc'))
stc_4W = arcpy.stpm.CreateSpaceTimeCubeDefinedLocations(path_geom, os.path.join(home_dir, 'stc_4W.nc'), 'AGS_int', 'APPLY_TEMPORAL_AGGREGATION', 'meldedatum', '1 Weeks', 'END_TIME', '', '','FaelleEWZ_7 MEAN ZEROS', path_4W, 'IdLandkreis')
```

#### Emerging Hot Spot Analyse <a class="anchor" id="analyse-stc-emerg"></a>

Mit Hilfe der zuvor erstellten Space-Time Cubes soll nun eine Emerging Hot Spot-Analyse durchgeführt werden.

Die Funktionsweise des Werkzeugs kann hier nachvollzogen werden:
https://pro.arcgis.com/de/pro-app/latest/tool-reference/space-time-pattern-mining/emerginghotspots.htm

##### kleine Datenmenge (10.12.2020 - 24.12.2020)

Falls das Ergebnis der zu erstellenden Emerging Hot Spot-Analyse aus vorherigen Durchläufen bereits vorliegt wird dieses gelöscht.

Die Emerging Hot Spot-Analyse wird über die arcpy-Funktion **arcpy.stpm.EmergingHotSpotAnalysis()** mit Hilfe der Space-Time Cubes berechnet und in der Geodatabase abgelegt.


```python
arcpy.management.Delete(os.path.join(results_dir, 'emerg_Test'))
emerg = arcpy.stpm.EmergingHotSpotAnalysis(os.path.join(home_dir, 'stc_Test.nc'), "FAELLEEWZ_7_NONE_ZEROS", os.path.join(results_dir, 'emerg_Test'))
```

    WARNING 110020: The default Neighborhood Distance is 65567.520785 meters.
    
    
    ----------- Input Space Time Cube Details -----------
    Time step interval                               1 day
                                                          
    Shape Type                                     Polygon
                                                          
    First time step temporal bias                    0.00%
    First time step interval                         after
                                       2020-12-09 00:00:00
                                           to on or before
                                       2020-12-10 00:00:00
                                                          
    Last time step temporal bias                     0.00%
    Last time step interval                          after
                                       2020-12-23 00:00:00
                                           to on or before
                                       2020-12-24 00:00:00
                                                          
    Number of time steps                                15
    Number of locations analyzed                       411
    Number of space time bins analyzed                6165
    -----------------------------------------------------
    
    
    ----------------- Analysis Details ----------------
    Neighborhood distance            65567.520785 meters
    Neighborhood time step intervals                   1
                                        (spanning 1 day)
    ---------------------------------------------------
    
    
    --------- Summary of Results ---------
                          HOT          COLD
    New                     0             1
    Consecutive            40             0
    Intensifying           37             1
    Persistent              2            12
    Diminishing             0            52
    Sporadic                1             7
    Oscillating             2             0
    Historical              0             0
    --------------------------------------
    All locations with hot or cold spot trends: 155 of 411
    
    
    Category Definitions
    ----------------------------------------------------------------------
    
    Last time step is hot:
    - New: the most recent time step interval is hot for the first time
    - Consecutive: a single uninterrupted run of hot time step intervals, comprised of less than 90% of all intervals
    - Intensifying: at least 90% of the time step intervals are hot, and becoming hotter over time
    - Persistent: at least 90% of the time step intervals are hot, with no trend up or down
    - Diminishing: at least 90% of the time step intervals are hot, and becoming less hot over time
    - Sporadic: some of the time step intervals are hot
    - Oscillating: some of the time step intervals are hot, some are cold
    
    Last time step is not hot:
    - Historical: at least 90% of the time step intervals are hot, but the most recent time step interval is not
    ----------------------------------------------------------------------
    
    Last time step is cold:
    - New: the most recent time step interval is cold for the first time
    - Consecutive: a single uninterrupted run of cold time step intervals, comprised of less than 90% of all
    - Intensifying: at least 90% of the time step intervals are cold, and becoming colder over time
    - Persistent: at least 90% of the time step intervals are cold, with no trend up or down
    - Diminishing: at least 90% of the time step intervals are cold, and becoming less cold over time intervals
    - Sporadic: some of the time step intervals are cold
    - Oscillating: some of the time step intervals are cold, some are hot
    
    Last time step is not cold:
    - Historical: at least 90% of the time step intervals are cold, but the most recent time step interval is not
    ----------------------------------------------------------------------
    


Das Ergebnis der Analyse wird in ein "spatially-enabled" Dataframe umgewandelt um im ArcGIS-Enterprise ein Layer erzeugen zu können.


```python
emerg_Test_SDF = pd.DataFrame.spatial.from_featureclass(os.path.join(results_dir,'Emerg_Test'))
```

Um die Daten darstellen zu können muss ein Layer in dem Projektordner erzeugt werden. Damit nicht zu viele Layer mit der Zeit angelegt werden wird ein möglicher zuvor erstellter Layer gelöscht.


```python
gis = GIS("home")
items = gis.content.search(query ='Emerg_Test')
for item in items:
    item.delete()
emerg_test = emerg_Test_SDF.spatial.to_featurelayer('Emerg_Test', tags=['Corona', 'Covid-19'], folder='Masterprojekt')
```

Dieser Layer kann nun in einer Karte angezeigt werden.


```python
#gis = GIS("home")
gis = GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis")
map_Emerg_Test = gis.map("Germany")
classed_color_renderer =  {"renderer":"ClassedColorRenderer", "field_name":"category" }
#vis3D_Test_SEDF.spatial.plot(vis3D_Test_map, col="HS_BIN", cmap='bwr', renderer_type='c', method='esriClassifyNaturalBreaks', min_value=-3, class_count=7, alpha=0.8, line_width=0.2)

map_Emerg_Test.add_layer(emerg_test, classed_color_renderer)
map_Emerg_Test
```


    MapView(layout=Layout(height='400px', width='100%'))



<div class="map-static-img-preview-49c07473-0f3a-4cc5-bf3b-40ff2cd5045e"><img src=""></img></div>



<div class="map-html-embed-preview-49c07473-0f3a-4cc5-bf3b-40ff2cd5045e"></div>


##### 1. Welle (02.03.2020 - 19.04.2020)

Falls das Ergebnis der zu erstellenden Emerging Hot Spot-Analyse aus vorherigen Durchläufen bereits vorliegt wird dieses gelöscht.

Die Emerging Hot Spot-Analyse wird über die arcpy Funktion **arcpy.stpm.EmergingHotSpotAnalysis()** mit Hilfe der Space-Time Cubes berechnet und in der Geodatabase abgelegt.


```python
arcpy.management.Delete(os.path.join(results_dir, 'emerg_1W'))
emerg = arcpy.stpm.EmergingHotSpotAnalysis(os.path.join(home_dir, 'stc_1W.nc'), "FAELLEEWZ_7_MEAN_ZEROS", os.path.join(results_dir, 'emerg_1W'))
```

    WARNING 110020: The default Neighborhood Distance is 65567.520785 meters.
    
    
    ----------- Input Space Time Cube Details -----------
    Time step interval                              3 days
                                                          
    Shape Type                                     Polygon
                                                          
    First time step temporal bias                  100.00%
    First time step interval                         after
                                       2020-02-28 00:00:00
                                           to on or before
                                       2020-03-02 00:00:00
                                                          
    Last time step temporal bias                     0.00%
    Last time step interval                          after
                                       2020-04-16 00:00:00
                                           to on or before
                                       2020-04-19 00:00:00
                                                          
    Number of time steps                                17
    Number of locations analyzed                       411
    Number of space time bins analyzed                6987
    -----------------------------------------------------
    
    
    ----------------- Analysis Details ----------------
    Neighborhood distance            65567.520785 meters
    Neighborhood time step intervals                   1
                                       (spanning 3 days)
    ---------------------------------------------------
    
    
    --------- Summary of Results ---------
                          HOT          COLD
    New                     0             0
    Consecutive             0             0
    Intensifying            0             0
    Persistent              0             0
    Diminishing             0             0
    Sporadic                0            56
    Oscillating           101             0
    Historical              0             0
    --------------------------------------
    All locations with hot or cold spot trends: 157 of 411
    
    
    Category Definitions
    ----------------------------------------------------------------------
    
    Last time step is hot:
    - New: the most recent time step interval is hot for the first time
    - Consecutive: a single uninterrupted run of hot time step intervals, comprised of less than 90% of all intervals
    - Intensifying: at least 90% of the time step intervals are hot, and becoming hotter over time
    - Persistent: at least 90% of the time step intervals are hot, with no trend up or down
    - Diminishing: at least 90% of the time step intervals are hot, and becoming less hot over time
    - Sporadic: some of the time step intervals are hot
    - Oscillating: some of the time step intervals are hot, some are cold
    
    Last time step is not hot:
    - Historical: at least 90% of the time step intervals are hot, but the most recent time step interval is not
    ----------------------------------------------------------------------
    
    Last time step is cold:
    - New: the most recent time step interval is cold for the first time
    - Consecutive: a single uninterrupted run of cold time step intervals, comprised of less than 90% of all
    - Intensifying: at least 90% of the time step intervals are cold, and becoming colder over time
    - Persistent: at least 90% of the time step intervals are cold, with no trend up or down
    - Diminishing: at least 90% of the time step intervals are cold, and becoming less cold over time intervals
    - Sporadic: some of the time step intervals are cold
    - Oscillating: some of the time step intervals are cold, some are hot
    
    Last time step is not cold:
    - Historical: at least 90% of the time step intervals are cold, but the most recent time step interval is not
    ----------------------------------------------------------------------
    


Das Ergebnis der Analyse wird in ein "spatially-enabled" Dataframe umgewandelt um im ArcGIS-Enterprise ein Layer erzeugen zu können.


```python
emerg_1W_SDF = pd.DataFrame.spatial.from_featureclass(os.path.join(results_dir,'emerg_1W'))
```

Um die Daten darstellen zu können muss ein Layer in dem Projektordner erzeugt werden. Damit nicht zu viele Layer mit der Zeit angelegt werden wird ein möglicher zuvor erstellter Layer gelöscht.


```python
gis = GIS("home")
items = gis.content.search(query ='emerg_1W')
for item in items:
    item.delete()
emerg_1W = emerg_1W_SDF.spatial.to_featurelayer('emerg_1W', tags=['Corona', 'Covid-19'], folder='Masterprojekt')
```

Dieser Layer kann nun in einer Karte angezeigt werden.


```python
gis = GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis")
map_emerg_1W = gis.map("Germany")
classed_color_renderer =  {"renderer":"ClassedColorRenderer", "field_name":"category" }
map_emerg_1W.add_layer(emerg_1W, classed_color_renderer)
map_emerg_1W
```


    MapView(layout=Layout(height='400px', width='100%'))



<div class="map-static-img-preview-75b09874-deed-4a38-acae-bc67ae211798"><img src=""></img></div>



<div class="map-html-embed-preview-75b09874-deed-4a38-acae-bc67ae211798"></div>


##### 2. Welle (05.10.2020 - 31.01.2021)

Falls das Ergebnis der zu erstellenden Emerging Hot Spot-Analyse aus vorherigen Durchläufen bereits vorliegt wird dieses gelöscht.

Die Emerging Hot Spot-Analyse wird über die arcpy Funktion **arcpy.stpm.EmergingHotSpotAnalysis()** mit Hilfe der Space-Time Cubes berechnet und in der Geodatabase abgelegt.


```python
arcpy.management.Delete(os.path.join(results_dir, 'emerg_2W'))
emerg = arcpy.stpm.EmergingHotSpotAnalysis(os.path.join(home_dir, 'stc_2W.nc'), "FAELLEEWZ_7_MEAN_ZEROS", os.path.join(results_dir, 'emerg_2W'))
```

    WARNING 110020: The default Neighborhood Distance is 65567.520785 meters.
    
    
    ----------- Input Space Time Cube Details -----------
    Time step interval                              1 week
                                                          
    Shape Type                                     Polygon
                                                          
    First time step temporal bias                   14.29%
    First time step interval                         after
                                       2020-10-04 00:00:00
                                           to on or before
                                       2020-10-11 00:00:00
                                                          
    Last time step temporal bias                     0.00%
    Last time step interval                          after
                                       2021-01-24 00:00:00
                                           to on or before
                                       2021-01-31 00:00:00
                                                          
    Number of time steps                                17
    Number of locations analyzed                       411
    Number of space time bins analyzed                6987
    -----------------------------------------------------
    
    
    ----------------- Analysis Details ----------------
    Neighborhood distance            65567.520785 meters
    Neighborhood time step intervals                   1
                                       (spanning 1 week)
    ---------------------------------------------------
    
    
    --------- Summary of Results ---------
                          HOT          COLD
    New                     0             0
    Consecutive             0             0
    Intensifying            0             0
    Persistent              0             1
    Diminishing             0            22
    Sporadic                0            37
    Oscillating            59           135
    Historical              0             0
    --------------------------------------
    All locations with hot or cold spot trends: 254 of 411
    
    
    Category Definitions
    ----------------------------------------------------------------------
    
    Last time step is hot:
    - New: the most recent time step interval is hot for the first time
    - Consecutive: a single uninterrupted run of hot time step intervals, comprised of less than 90% of all intervals
    - Intensifying: at least 90% of the time step intervals are hot, and becoming hotter over time
    - Persistent: at least 90% of the time step intervals are hot, with no trend up or down
    - Diminishing: at least 90% of the time step intervals are hot, and becoming less hot over time
    - Sporadic: some of the time step intervals are hot
    - Oscillating: some of the time step intervals are hot, some are cold
    
    Last time step is not hot:
    - Historical: at least 90% of the time step intervals are hot, but the most recent time step interval is not
    ----------------------------------------------------------------------
    
    Last time step is cold:
    - New: the most recent time step interval is cold for the first time
    - Consecutive: a single uninterrupted run of cold time step intervals, comprised of less than 90% of all
    - Intensifying: at least 90% of the time step intervals are cold, and becoming colder over time
    - Persistent: at least 90% of the time step intervals are cold, with no trend up or down
    - Diminishing: at least 90% of the time step intervals are cold, and becoming less cold over time intervals
    - Sporadic: some of the time step intervals are cold
    - Oscillating: some of the time step intervals are cold, some are hot
    
    Last time step is not cold:
    - Historical: at least 90% of the time step intervals are cold, but the most recent time step interval is not
    ----------------------------------------------------------------------
    


Das Ergebnis der Analyse wird in ein "spatially-enabled" Dataframe umgewandelt um im ArcGIS-Enterprise ein Layer erzeugen zu können.


```python
emerg_2W_SDF = pd.DataFrame.spatial.from_featureclass(os.path.join(results_dir,'emerg_2W'))
```

Um die Daten darstellen zu können muss ein Layer in dem Projektordner erzeugt werden. Damit nicht zu viele Layer mit der Zeit angelegt werden wird ein möglicher zuvor erstellter Layer gelöscht.


```python
gis = GIS("home")
items = gis.content.search(query ='emerg_2W')
for item in items:
    item.delete()
emerg_2W = emerg_2W_SDF.spatial.to_featurelayer('emerg_2W', tags=['Corona', 'Covid-19'], folder='Masterprojekt')
```

Dieser Layer kann nun in einer Karte angezeigt werden.


```python
gis = GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis")
map_emerg_2W = gis.map("Germany")
classed_color_renderer =  {"renderer":"ClassedColorRenderer", "field_name":"category" }
map_emerg_2W.add_layer(emerg_2W, classed_color_renderer)
map_emerg_2W
```


    MapView(layout=Layout(height='400px', width='100%'))



<div class="map-static-img-preview-97365b86-970d-46b2-8a76-6a23cc9446ac"><img src=""></img></div>



<div class="map-html-embed-preview-97365b86-970d-46b2-8a76-6a23cc9446ac"></div>


##### 3. Welle (01.03.2021 - 16.05.2021)

Falls das Ergebnis der zu erstellenden Emerging Hot Spot-Analyse aus vorherigen Durchläufen bereits vorliegt wird dieses gelöscht.

Die Emerging Hot Spot-Analyse wird über die arcpy Funktion **arcpy.stpm.EmergingHotSpotAnalysis()** mit Hilfe der Space-Time Cubes berechnet und in der Geodatabase abgelegt.


```python
arcpy.management.Delete(os.path.join(results_dir, 'emerg_3W'))
emerg = arcpy.stpm.EmergingHotSpotAnalysis(os.path.join(home_dir, 'stc_3W.nc'), "FAELLEEWZ_7_MEAN_ZEROS", os.path.join(results_dir, 'emerg_3W'))
```

    WARNING 110020: The default Neighborhood Distance is 65567.520785 meters.
    
    
    ----------- Input Space Time Cube Details -----------
    Time step interval                              1 week
                                                          
    Shape Type                                     Polygon
                                                          
    First time step temporal bias                   14.29%
    First time step interval                         after
                                       2021-02-28 00:00:00
                                           to on or before
                                       2021-03-07 00:00:00
                                                          
    Last time step temporal bias                     0.00%
    Last time step interval                          after
                                       2021-05-09 00:00:00
                                           to on or before
                                       2021-05-16 00:00:00
                                                          
    Number of time steps                                11
    Number of locations analyzed                       411
    Number of space time bins analyzed                4521
    -----------------------------------------------------
    
    
    ----------------- Analysis Details ----------------
    Neighborhood distance            65567.520785 meters
    Neighborhood time step intervals                   1
                                       (spanning 1 week)
    ---------------------------------------------------
    
    
    --------- Summary of Results ---------
                          HOT          COLD
    New                     0             6
    Consecutive            30             0
    Intensifying            1             2
    Persistent              6            14
    Diminishing             0             0
    Sporadic                0            81
    Oscillating            25            37
    Historical              2             0
    --------------------------------------
    All locations with hot or cold spot trends: 204 of 411
    
    
    Category Definitions
    ----------------------------------------------------------------------
    
    Last time step is hot:
    - New: the most recent time step interval is hot for the first time
    - Consecutive: a single uninterrupted run of hot time step intervals, comprised of less than 90% of all intervals
    - Intensifying: at least 90% of the time step intervals are hot, and becoming hotter over time
    - Persistent: at least 90% of the time step intervals are hot, with no trend up or down
    - Diminishing: at least 90% of the time step intervals are hot, and becoming less hot over time
    - Sporadic: some of the time step intervals are hot
    - Oscillating: some of the time step intervals are hot, some are cold
    
    Last time step is not hot:
    - Historical: at least 90% of the time step intervals are hot, but the most recent time step interval is not
    ----------------------------------------------------------------------
    
    Last time step is cold:
    - New: the most recent time step interval is cold for the first time
    - Consecutive: a single uninterrupted run of cold time step intervals, comprised of less than 90% of all
    - Intensifying: at least 90% of the time step intervals are cold, and becoming colder over time
    - Persistent: at least 90% of the time step intervals are cold, with no trend up or down
    - Diminishing: at least 90% of the time step intervals are cold, and becoming less cold over time intervals
    - Sporadic: some of the time step intervals are cold
    - Oscillating: some of the time step intervals are cold, some are hot
    
    Last time step is not cold:
    - Historical: at least 90% of the time step intervals are cold, but the most recent time step interval is not
    ----------------------------------------------------------------------
    


Das Ergebnis der Analyse wird in ein "spatially-enabled" Dataframe umgewandelt um im ArcGIS-Enterprise ein Layer erzeugen zu können.


```python
emerg_3W_SDF = pd.DataFrame.spatial.from_featureclass(os.path.join(results_dir,'emerg_3W'))
```

Um die Daten darstellen zu können muss ein Layer in dem Projektordner erzeugt werden. Damit nicht zu viele Layer mit der Zeit angelegt werden wird ein möglicher zuvor erstellter Layer gelöscht.


```python
gis = GIS("home")
items = gis.content.search(query ='emerg_3W')
for item in items:
    item.delete()
emerg_3W = emerg_3W_SDF.spatial.to_featurelayer('emerg_3W', tags=['Corona', 'Covid-19'], folder='Masterprojekt')
```

Dieser Layer kann nun in einer Karte angezeigt werden.


```python
gis = GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis")
map_emerg_3W = gis.map("Germany")
classed_color_renderer =  {"renderer":"ClassedColorRenderer", "field_name":"category" }
map_emerg_3W.add_layer(emerg_3W, classed_color_renderer)
map_emerg_3W
```


    MapView(layout=Layout(height='400px', width='100%'))



<div class="map-static-img-preview-bd9bdab2-e00a-489b-a309-9d8114db5ed8"><img src=""></img></div>



<div class="map-html-embed-preview-bd9bdab2-e00a-489b-a309-9d8114db5ed8"></div>


##### 4. Welle (04.10.2021 - 02.01.2022)

Falls das Ergebnis der zu erstellenden Emerging Hot Spot-Analyse aus vorherigen Durchläufen bereits vorliegt wird dieses gelöscht.

Die Emerging Hot Spot-Analyse wird über die arcpy Funktion **arcpy.stpm.EmergingHotSpotAnalysis()** mit Hilfe der Space-Time Cubes berechnet und in der Geodatabase abgelegt.


```python
arcpy.management.Delete(os.path.join(results_dir, 'emerg_4W'))
emerg = arcpy.stpm.EmergingHotSpotAnalysis(os.path.join(home_dir, 'stc_4W.nc'), "FAELLEEWZ_7_MEAN_ZEROS", os.path.join(results_dir, 'emerg_4W'))
```

    WARNING 110020: The default Neighborhood Distance is 65567.520785 meters.
    
    
    ----------- Input Space Time Cube Details -----------
    Time step interval                              1 week
                                                          
    Shape Type                                     Polygon
                                                          
    First time step temporal bias                   14.29%
    First time step interval                         after
                                       2021-10-03 00:00:00
                                           to on or before
                                       2021-10-10 00:00:00
                                                          
    Last time step temporal bias                     0.00%
    Last time step interval                          after
                                       2021-12-26 00:00:00
                                           to on or before
                                       2022-01-02 00:00:00
                                                          
    Number of time steps                                13
    Number of locations analyzed                       411
    Number of space time bins analyzed                5343
    -----------------------------------------------------
    
    
    ----------------- Analysis Details ----------------
    Neighborhood distance            65567.520785 meters
    Neighborhood time step intervals                   1
                                       (spanning 1 week)
    ---------------------------------------------------
    
    
    --------- Summary of Results ---------
                          HOT          COLD
    New                     0             0
    Consecutive             1             0
    Intensifying            0             0
    Persistent              0             0
    Diminishing             0            14
    Sporadic                0            95
    Oscillating            58            49
    Historical              0             9
    --------------------------------------
    All locations with hot or cold spot trends: 226 of 411
    
    
    Category Definitions
    ----------------------------------------------------------------------
    
    Last time step is hot:
    - New: the most recent time step interval is hot for the first time
    - Consecutive: a single uninterrupted run of hot time step intervals, comprised of less than 90% of all intervals
    - Intensifying: at least 90% of the time step intervals are hot, and becoming hotter over time
    - Persistent: at least 90% of the time step intervals are hot, with no trend up or down
    - Diminishing: at least 90% of the time step intervals are hot, and becoming less hot over time
    - Sporadic: some of the time step intervals are hot
    - Oscillating: some of the time step intervals are hot, some are cold
    
    Last time step is not hot:
    - Historical: at least 90% of the time step intervals are hot, but the most recent time step interval is not
    ----------------------------------------------------------------------
    
    Last time step is cold:
    - New: the most recent time step interval is cold for the first time
    - Consecutive: a single uninterrupted run of cold time step intervals, comprised of less than 90% of all
    - Intensifying: at least 90% of the time step intervals are cold, and becoming colder over time
    - Persistent: at least 90% of the time step intervals are cold, with no trend up or down
    - Diminishing: at least 90% of the time step intervals are cold, and becoming less cold over time intervals
    - Sporadic: some of the time step intervals are cold
    - Oscillating: some of the time step intervals are cold, some are hot
    
    Last time step is not cold:
    - Historical: at least 90% of the time step intervals are cold, but the most recent time step interval is not
    ----------------------------------------------------------------------
    


Das Ergebnis der Analyse wird in ein "spatially-enabled" Dataframe umgewandelt um im ArcGIS-Enterprise ein Layer erzeugen zu können.


```python
emerg_4W_SDF = pd.DataFrame.spatial.from_featureclass(os.path.join(results_dir,'emerg_4W'))
```

Um die Daten darstellen zu können muss ein Layer in dem Projektordner erzeugt werden. Damit nicht zu viele Layer mit der Zeit angelegt werden wird ein möglicher zuvor erstellter Layer gelöscht.


```python
gis = GIS("home")
items = gis.content.search(query ='emerg_4W')
for item in items:
    item.delete()
emerg_4W = emerg_4W_SDF.spatial.to_featurelayer('emerg_4W', tags=['Corona', 'Covid-19'], folder='Masterprojekt')
```

Dieser Layer kann nun in einer Karte angezeigt werden.


```python
gis = GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis")
map_emerg_4W = gis.map("Germany")
classed_color_renderer =  {"renderer":"ClassedColorRenderer", "field_name":"category" }
map_emerg_4W.add_layer(emerg_4W, classed_color_renderer)
map_emerg_4W
```


    MapView(layout=Layout(height='400px', width='100%'))



<div class="map-static-img-preview-3a90231b-f257-43e1-a01e-eb98887c23cf"><img src=""></img></div>



<div class="map-html-embed-preview-3a90231b-f257-43e1-a01e-eb98887c23cf"></div>


#### Visualisierung in 3D <a class="anchor" id="analyse-stc-vis3D"></a>

Die erstellten Space-Time Cubes können auch in einer 3-dimensionalen Karte angezeigt werden.

Der folgende Link erläutert das Vorgehen näher:
https://pro.arcgis.com/en/pro-app/latest/tool-reference/space-time-pattern-mining/visualizecube3d.htm

Für die Visualisierung wird eine Farbpalette benötigt.


```python
palette = ['blue', 'cornflowerblue', 'lightskyblue', 'white', 'salmon', 'tomato', 'red']
cmap = matplotlib.colors.LinearSegmentedColormap.from_list("", ['blue', 'cornflowerblue', 'lightskyblue', 'white', 'salmon', 'tomato', 'red'])
```

##### kleine Datenmenge (10.12.2020 - 24.12.2020)

Das dreidimonsionale Rendering wirde über die Funktion **arcpy.stpm.VisualizeSpaceTimeCube3D()** durchgeführt. Dabei werden die einzelnen Bin als Ergebnis einer Hot Spot-Analyse dargestellt. Das Ergebnis wird in der Geodatabase abgelegt.


```python
arcpy.stpm.VisualizeSpaceTimeCube3D(os.path.join(home_dir, 'stc_Test.nc'), "FAELLEEWZ_7_NONE_ZEROS", "HOT_AND_COLD_SPOT_RESULTS", os.path.join(results_dir,'vis3D_Test'))
```

    WARNING 110044: The time it takes to render the cube in three dimensions may vary considerably based on the number of features and the graphics card associated with your CPU.





<div class='gpresult'><h2>Messages</h2><div id='messages' data-messages='["Start Time: Thursday, January 20, 2022 4:12:31 PM","WARNING 110044: The time it takes to render the cube in three dimensions may vary considerably based on the number of features and the graphics card associated with your CPU.","Succeeded at Thursday, January 20, 2022 4:12:35 PM (Elapsed Time: 3.77 seconds)"]' data-show='true'><div id = 'default' /></div></div>



Das Ergebnis der Analyse wird in ein "spatially-enabled" Dataframe umgewandelt um im ArcGIS-Enterprise ein Layer erzeugen zu können.


```python
vis3D_Test_SEDF = pd.DataFrame.spatial.from_featureclass(os.path.join(results_dir,'vis3D_Test'))
vis3D_Test_SEDF.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>OBJECTID</th>
      <th>TIME_STEP</th>
      <th>START_DATE</th>
      <th>END_DATE</th>
      <th>TIME_EXAG</th>
      <th>ELEMENT</th>
      <th>LOCATION</th>
      <th>AGS_INT</th>
      <th>VALUE</th>
      <th>HS_ZSCORE</th>
      <th>HS_PVALUE</th>
      <th>HS_BIN</th>
      <th>SHAPE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>2020-12-09 00:00:01</td>
      <td>2020-12-10</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0</td>
      <td>1001</td>
      <td>30.022016</td>
      <td>-3.191161</td>
      <td>0.001417</td>
      <td>-3</td>
      <td>{"x": 528200.8448999999, "y": 6070953.82719999...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>2020-12-10 00:00:01</td>
      <td>2020-12-11</td>
      <td>1731.175471</td>
      <td>411</td>
      <td>0</td>
      <td>1001</td>
      <td>33.357796</td>
      <td>-4.467113</td>
      <td>0.000008</td>
      <td>-3</td>
      <td>{"x": 528200.8448999999, "y": 6070953.82719999...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>2</td>
      <td>2020-12-11 00:00:01</td>
      <td>2020-12-12</td>
      <td>3462.350943</td>
      <td>822</td>
      <td>0</td>
      <td>1001</td>
      <td>37.805502</td>
      <td>-4.355985</td>
      <td>0.000013</td>
      <td>-3</td>
      <td>{"x": 528200.8448999999, "y": 6070953.82719999...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>3</td>
      <td>2020-12-12 00:00:01</td>
      <td>2020-12-13</td>
      <td>5193.526414</td>
      <td>1233</td>
      <td>0</td>
      <td>1001</td>
      <td>35.581649</td>
      <td>-4.292429</td>
      <td>0.000018</td>
      <td>-3</td>
      <td>{"x": 528200.8448999999, "y": 6070953.82719999...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>4</td>
      <td>2020-12-13 00:00:01</td>
      <td>2020-12-14</td>
      <td>6924.701886</td>
      <td>1644</td>
      <td>0</td>
      <td>1001</td>
      <td>51.148620</td>
      <td>-4.223450</td>
      <td>0.000024</td>
      <td>-3</td>
      <td>{"x": 528200.8448999999, "y": 6070953.82719999...</td>
    </tr>
  </tbody>
</table>
</div>



Dieser Layer kann nun in einer Karte angezeigt werden.


```python
gis = GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis")
vis3D_Test_map = gis.map("Germany", mode='3D')
vis3D_Test_map.basemap = 'dark-gray-vector'
vis3D_Test_SEDF.spatial.plot(vis3D_Test_map, col="HS_BIN", cmap='bwr', renderer_type='c', method='esriClassifyNaturalBreaks', min_value=-3, class_count=7, alpha=0.8, line_width=0.2)
vis3D_Test_map
```


    MapView(layout=Layout(height='400px', width='100%'), mode='3D')



<div class="map-static-img-preview-8fb340f7-0cae-4dcd-a0ba-491bdd71e8a8"><img src=""></img></div>



<div class="map-html-embed-preview-8fb340f7-0cae-4dcd-a0ba-491bdd71e8a8"></div>


##### 1. Welle (02.03.2020 - 19.04.2020)

Das dreidimonsionale Rendering wirde über die Funktion **arcpy.stpm.VisualizeSpaceTimeCube3D()** durchgeführt. Dabei werden die einzelnen Bin als Ergebnis einer Hot Spot-Analyse dargestellt. Das Ergebnis wird in der Geodatabase abgelegt.


```python
arcpy.stpm.VisualizeSpaceTimeCube3D(os.path.join(home_dir, 'stc_1W.nc'), "FAELLEEWZ_7_MEAN_ZEROS", "HOT_AND_COLD_SPOT_RESULTS", os.path.join(results_dir,'vis3D_1W'))
```

    WARNING 110044: The time it takes to render the cube in three dimensions may vary considerably based on the number of features and the graphics card associated with your CPU.





<div class='gpresult'><h2>Messages</h2><div id='messages' data-messages='["Start Time: Thursday, January 20, 2022 4:13:10 PM","WARNING 110044: The time it takes to render the cube in three dimensions may vary considerably based on the number of features and the graphics card associated with your CPU.","Succeeded at Thursday, January 20, 2022 4:13:14 PM (Elapsed Time: 4.18 seconds)"]' data-show='true'><div id = 'default' /></div></div>



Das Ergebnis der Analyse wird in ein "spatially-enabled" Dataframe umgewandelt um im ArcGIS-Enterprise ein Layer erzeugen zu können.


```python
vis3D_1W_SEDF = pd.DataFrame.spatial.from_featureclass(os.path.join(results_dir,'vis3D_1W'))
vis3D_1W_SEDF.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>OBJECTID</th>
      <th>TIME_STEP</th>
      <th>START_DATE</th>
      <th>END_DATE</th>
      <th>TIME_EXAG</th>
      <th>ELEMENT</th>
      <th>LOCATION</th>
      <th>AGS_INT</th>
      <th>VALUE</th>
      <th>HS_ZSCORE</th>
      <th>HS_PVALUE</th>
      <th>HS_BIN</th>
      <th>SHAPE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>2020-02-28 00:00:01</td>
      <td>2020-03-02</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0</td>
      <td>1001</td>
      <td>0.000000</td>
      <td>-1.477572</td>
      <td>0.139522</td>
      <td>0</td>
      <td>{"x": 528200.8448999999, "y": 6070953.82719999...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>2020-03-02 00:00:01</td>
      <td>2020-03-05</td>
      <td>1731.175471</td>
      <td>411</td>
      <td>0</td>
      <td>1001</td>
      <td>0.000000</td>
      <td>-2.090201</td>
      <td>0.036600</td>
      <td>-1</td>
      <td>{"x": 528200.8448999999, "y": 6070953.82719999...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>2</td>
      <td>2020-03-05 00:00:01</td>
      <td>2020-03-08</td>
      <td>3462.350943</td>
      <td>822</td>
      <td>0</td>
      <td>1001</td>
      <td>0.000000</td>
      <td>-2.090201</td>
      <td>0.036600</td>
      <td>-1</td>
      <td>{"x": 528200.8448999999, "y": 6070953.82719999...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>3</td>
      <td>2020-03-08 00:00:01</td>
      <td>2020-03-11</td>
      <td>5193.526414</td>
      <td>1233</td>
      <td>0</td>
      <td>1001</td>
      <td>0.000000</td>
      <td>-2.085518</td>
      <td>0.037022</td>
      <td>-1</td>
      <td>{"x": 528200.8448999999, "y": 6070953.82719999...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>4</td>
      <td>2020-03-11 00:00:01</td>
      <td>2020-03-14</td>
      <td>6924.701886</td>
      <td>1644</td>
      <td>0</td>
      <td>1001</td>
      <td>1.482569</td>
      <td>-1.992148</td>
      <td>0.046355</td>
      <td>-1</td>
      <td>{"x": 528200.8448999999, "y": 6070953.82719999...</td>
    </tr>
  </tbody>
</table>
</div>



Dieser Layer kann nun in einer Karte angezeigt werden.


```python
gis = GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis")
vis3D_1W_map = gis.map("Germany", mode='3D')
vis3D_1W_map.basemap = 'dark-gray-vector'
vis3D_1W_SEDF.spatial.plot(vis3D_1W_map, col="HS_BIN", cmap='bwr', renderer_type='c', method='esriClassifyNaturalBreaks', min_value=-3, class_count=7, alpha=0.8, line_width=0.2)
vis3D_1W_map
```


    MapView(layout=Layout(height='400px', width='100%'), mode='3D')



<div class="map-static-img-preview-04791820-54b4-4cf5-aaed-6d4493c84018"><img src=""></img></div>



<div class="map-html-embed-preview-04791820-54b4-4cf5-aaed-6d4493c84018"></div>


##### 2. Welle (05.10.2020 - 31.01.2021)

Das dreidimonsionale Rendering wirde über die Funktion **arcpy.stpm.VisualizeSpaceTimeCube3D()** durchgeführt. Dabei werden die einzelnen Bin als Ergebnis einer Hot Spot-Analyse dargestellt. Das Ergebnis wird in der Geodatabase abgelegt.


```python
arcpy.stpm.VisualizeSpaceTimeCube3D(os.path.join(home_dir, 'stc_2W.nc'), "FAELLEEWZ_7_MEAN_ZEROS", "HOT_AND_COLD_SPOT_RESULTS", os.path.join(results_dir,'vis3D_2W'))
```

    WARNING 110044: The time it takes to render the cube in three dimensions may vary considerably based on the number of features and the graphics card associated with your CPU.





<div class='gpresult'><h2>Messages</h2><div id='messages' data-messages='["Start Time: Thursday, January 20, 2022 4:13:23 PM","WARNING 110044: The time it takes to render the cube in three dimensions may vary considerably based on the number of features and the graphics card associated with your CPU.","Succeeded at Thursday, January 20, 2022 4:13:28 PM (Elapsed Time: 4.76 seconds)"]' data-show='true'><div id = 'default' /></div></div>



Das Ergebnis der Analyse wird in ein "spatially-enabled" Dataframe umgewandelt um im ArcGIS-Enterprise ein Layer erzeugen zu können.


```python
vis3D_2W_SEDF = pd.DataFrame.spatial.from_featureclass(os.path.join(results_dir,'vis3D_2W'))
vis3D_2W_SEDF.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>OBJECTID</th>
      <th>TIME_STEP</th>
      <th>START_DATE</th>
      <th>END_DATE</th>
      <th>TIME_EXAG</th>
      <th>ELEMENT</th>
      <th>LOCATION</th>
      <th>AGS_INT</th>
      <th>VALUE</th>
      <th>HS_ZSCORE</th>
      <th>HS_PVALUE</th>
      <th>HS_BIN</th>
      <th>SHAPE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>2020-10-04 00:00:01</td>
      <td>2020-10-11</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0</td>
      <td>1001</td>
      <td>13.025425</td>
      <td>-2.784648</td>
      <td>0.005359</td>
      <td>-2</td>
      <td>{"x": 528200.8448999999, "y": 6070953.82719999...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>2020-10-11 00:00:01</td>
      <td>2020-10-18</td>
      <td>1731.175471</td>
      <td>411</td>
      <td>0</td>
      <td>1001</td>
      <td>16.361205</td>
      <td>-3.923569</td>
      <td>0.000087</td>
      <td>-3</td>
      <td>{"x": 528200.8448999999, "y": 6070953.82719999...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>2</td>
      <td>2020-10-18 00:00:01</td>
      <td>2020-10-25</td>
      <td>3462.350943</td>
      <td>822</td>
      <td>0</td>
      <td>1001</td>
      <td>26.209697</td>
      <td>-3.729581</td>
      <td>0.000192</td>
      <td>-3</td>
      <td>{"x": 528200.8448999999, "y": 6070953.82719999...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>3</td>
      <td>2020-10-25 00:00:01</td>
      <td>2020-11-01</td>
      <td>5193.526414</td>
      <td>1233</td>
      <td>0</td>
      <td>1001</td>
      <td>41.617821</td>
      <td>-3.196640</td>
      <td>0.001390</td>
      <td>-3</td>
      <td>{"x": 528200.8448999999, "y": 6070953.82719999...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>4</td>
      <td>2020-11-01 00:00:01</td>
      <td>2020-11-08</td>
      <td>6924.701886</td>
      <td>1644</td>
      <td>0</td>
      <td>1001</td>
      <td>33.040102</td>
      <td>-2.776131</td>
      <td>0.005501</td>
      <td>-2</td>
      <td>{"x": 528200.8448999999, "y": 6070953.82719999...</td>
    </tr>
  </tbody>
</table>
</div>



Dieser Layer kann nun in einer Karte angezeigt werden.


```python
gis = GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis")
vis3D_2W_map = gis.map("Germany", mode='3D')
vis3D_2W_map.basemap = 'dark-gray-vector'
vis3D_2W_SEDF.spatial.plot(vis3D_2W_map, col="HS_BIN", cmap='bwr', renderer_type='c', method='esriClassifyNaturalBreaks', min_value=-3, class_count=7, alpha=0.8, line_width=0.2)
vis3D_2W_map
```


    MapView(layout=Layout(height='400px', width='100%'), mode='3D')



<div class="map-static-img-preview-13541549-492c-4a96-89fa-21de65672497"><img src=""></img></div>



<div class="map-html-embed-preview-13541549-492c-4a96-89fa-21de65672497"></div>


##### 3. Welle (01.03.2021 - 16.05.2021)

Das dreidimonsionale Rendering wirde über die Funktion **arcpy.stpm.VisualizeSpaceTimeCube3D()** durchgeführt. Dabei werden die einzelnen Bin als Ergebnis einer Hot Spot-Analyse dargestellt. Das Ergebnis wird in der Geodatabase abgelegt.


```python
arcpy.stpm.VisualizeSpaceTimeCube3D(os.path.join(home_dir, 'stc_3W.nc'), "FAELLEEWZ_7_MEAN_ZEROS", "HOT_AND_COLD_SPOT_RESULTS", os.path.join(results_dir,'vis3D_3W'))
```

    WARNING 110044: The time it takes to render the cube in three dimensions may vary considerably based on the number of features and the graphics card associated with your CPU.





<div class='gpresult'><h2>Messages</h2><div id='messages' data-messages='["Start Time: Thursday, January 20, 2022 4:13:38 PM","WARNING 110044: The time it takes to render the cube in three dimensions may vary considerably based on the number of features and the graphics card associated with your CPU.","Succeeded at Thursday, January 20, 2022 4:13:42 PM (Elapsed Time: 4.30 seconds)"]' data-show='true'><div id = 'default' /></div></div>



Das Ergebnis der Analyse wird in ein "spatially-enabled" Dataframe umgewandelt um im ArcGIS-Enterprise ein Layer erzeugen zu können.


```python
vis3D_3W_SEDF = pd.DataFrame.spatial.from_featureclass(os.path.join(results_dir,'vis3D_3W'))
vis3D_3W_SEDF.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>OBJECTID</th>
      <th>TIME_STEP</th>
      <th>START_DATE</th>
      <th>END_DATE</th>
      <th>TIME_EXAG</th>
      <th>ELEMENT</th>
      <th>LOCATION</th>
      <th>AGS_INT</th>
      <th>VALUE</th>
      <th>HS_ZSCORE</th>
      <th>HS_PVALUE</th>
      <th>HS_BIN</th>
      <th>SHAPE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>2021-02-28 00:00:01</td>
      <td>2021-03-07</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0</td>
      <td>1001</td>
      <td>129.301170</td>
      <td>-1.806122</td>
      <td>0.070899</td>
      <td>0</td>
      <td>{"x": 528200.8448999999, "y": 6070953.82719999...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>2021-03-07 00:00:01</td>
      <td>2021-03-14</td>
      <td>1731.175471</td>
      <td>411</td>
      <td>0</td>
      <td>1001</td>
      <td>85.618342</td>
      <td>-2.888612</td>
      <td>0.003869</td>
      <td>-3</td>
      <td>{"x": 528200.8448999999, "y": 6070953.82719999...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>2</td>
      <td>2021-03-14 00:00:01</td>
      <td>2021-03-21</td>
      <td>3462.350943</td>
      <td>822</td>
      <td>0</td>
      <td>1001</td>
      <td>79.582170</td>
      <td>-3.250591</td>
      <td>0.001152</td>
      <td>-3</td>
      <td>{"x": 528200.8448999999, "y": 6070953.82719999...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>3</td>
      <td>2021-03-21 00:00:01</td>
      <td>2021-03-28</td>
      <td>5193.526414</td>
      <td>1233</td>
      <td>0</td>
      <td>1001</td>
      <td>99.438001</td>
      <td>-3.215061</td>
      <td>0.001304</td>
      <td>-3</td>
      <td>{"x": 528200.8448999999, "y": 6070953.82719999...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>4</td>
      <td>2021-03-28 00:00:01</td>
      <td>2021-04-04</td>
      <td>6924.701886</td>
      <td>1644</td>
      <td>0</td>
      <td>1001</td>
      <td>96.737608</td>
      <td>-3.185058</td>
      <td>0.001447</td>
      <td>-3</td>
      <td>{"x": 528200.8448999999, "y": 6070953.82719999...</td>
    </tr>
  </tbody>
</table>
</div>



Dieser Layer kann nun in einer Karte angezeigt werden.


```python
gis = GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis")
vis3D_3W_map = gis.map("Germany", mode='3D')
vis3D_3W_map.basemap = 'dark-gray-vector'
vis3D_3W_SEDF.spatial.plot(vis3D_3W_map, col="HS_BIN", cmap='bwr', renderer_type='c', method='esriClassifyNaturalBreaks', min_value=-3, class_count=7, alpha=0.8, line_width=0.2)
vis3D_3W_map
```


    MapView(layout=Layout(height='400px', width='100%'), mode='3D')



<div class="map-static-img-preview-829b4de8-e409-43d0-a722-b87d7ab148c4"><img src=""></img></div>



<div class="map-html-embed-preview-829b4de8-e409-43d0-a722-b87d7ab148c4"></div>


##### 4. Welle (04.10.2021 - 02.01.2022)

Das dreidimonsionale Rendering wirde über die Funktion **arcpy.stpm.VisualizeSpaceTimeCube3D()** durchgeführt. Dabei werden die einzelnen Bin als Ergebnis einer Hot Spot-Analyse dargestellt. Das Ergebnis wird in der Geodatabase abgelegt.


```python
arcpy.stpm.VisualizeSpaceTimeCube3D(os.path.join(home_dir, 'stc_4W.nc'), "FAELLEEWZ_7_MEAN_ZEROS", "HOT_AND_COLD_SPOT_RESULTS", os.path.join(results_dir,'vis3D_4W'))
```

    WARNING 110044: The time it takes to render the cube in three dimensions may vary considerably based on the number of features and the graphics card associated with your CPU.





<div class='gpresult'><h2>Messages</h2><div id='messages' data-messages='["Start Time: Thursday, January 20, 2022 4:13:50 PM","WARNING 110044: The time it takes to render the cube in three dimensions may vary considerably based on the number of features and the graphics card associated with your CPU.","Succeeded at Thursday, January 20, 2022 4:13:54 PM (Elapsed Time: 4.00 seconds)"]' data-show='true'><div id = 'default' /></div></div>



Das Ergebnis der Analyse wird in ein "spatially-enabled" Dataframe umgewandelt um im ArcGIS-Enterprise ein Layer erzeugen zu können.


```python
vis3D_4W_SEDF = pd.DataFrame.spatial.from_featureclass(os.path.join(results_dir,'vis3D_4W'))
vis3D_4W_SEDF.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>OBJECTID</th>
      <th>TIME_STEP</th>
      <th>START_DATE</th>
      <th>END_DATE</th>
      <th>TIME_EXAG</th>
      <th>ELEMENT</th>
      <th>LOCATION</th>
      <th>AGS_INT</th>
      <th>VALUE</th>
      <th>HS_ZSCORE</th>
      <th>HS_PVALUE</th>
      <th>HS_BIN</th>
      <th>SHAPE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>2021-10-03 00:00:01</td>
      <td>2021-10-10</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0</td>
      <td>1001</td>
      <td>27.957010</td>
      <td>-2.036691</td>
      <td>0.041681</td>
      <td>-1</td>
      <td>{"x": 528200.8448999999, "y": 6070953.82719999...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>2021-10-10 00:00:01</td>
      <td>2021-10-17</td>
      <td>1731.175471</td>
      <td>411</td>
      <td>0</td>
      <td>1001</td>
      <td>36.693575</td>
      <td>-2.870626</td>
      <td>0.004097</td>
      <td>-3</td>
      <td>{"x": 528200.8448999999, "y": 6070953.82719999...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>2</td>
      <td>2021-10-17 00:00:01</td>
      <td>2021-10-24</td>
      <td>3462.350943</td>
      <td>822</td>
      <td>0</td>
      <td>1001</td>
      <td>54.643246</td>
      <td>-2.756112</td>
      <td>0.005849</td>
      <td>-2</td>
      <td>{"x": 528200.8448999999, "y": 6070953.82719999...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>3</td>
      <td>2021-10-24 00:00:01</td>
      <td>2021-10-31</td>
      <td>5193.526414</td>
      <td>1233</td>
      <td>0</td>
      <td>1001</td>
      <td>71.163298</td>
      <td>-2.558101</td>
      <td>0.010525</td>
      <td>-2</td>
      <td>{"x": 528200.8448999999, "y": 6070953.82719999...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>4</td>
      <td>2021-10-31 00:00:01</td>
      <td>2021-11-07</td>
      <td>6924.701886</td>
      <td>1644</td>
      <td>0</td>
      <td>1001</td>
      <td>96.102221</td>
      <td>-2.347003</td>
      <td>0.018925</td>
      <td>-2</td>
      <td>{"x": 528200.8448999999, "y": 6070953.82719999...</td>
    </tr>
  </tbody>
</table>
</div>



Dieser Layer kann nun in einer Karte angezeigt werden.


```python
gis = GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis")
vis3D_4W_map = gis.map("Germany", mode='3D')
vis3D_4W_map.basemap = 'dark-gray-vector'
vis3D_4W_SEDF.spatial.plot(vis3D_4W_map, col="HS_BIN", cmap='bwr', renderer_type='c', method='esriClassifyNaturalBreaks', min_value=-3, class_count=7, alpha=0.8, line_width=0.2)
vis3D_4W_map
```


    MapView(layout=Layout(height='400px', width='100%'), mode='3D')



<div class="map-static-img-preview-215367aa-c73a-4e4f-8ab7-53fc5e401d5d"><img src=""></img></div>



<div class="map-html-embed-preview-215367aa-c73a-4e4f-8ab7-53fc5e401d5d"></div>


#### Time Series Clustering <a class="anchor" id="analyse-stc-clust"></a>

Mit Hilfe der zuvor erstellten Space-Time Cubes sollen ähnliche Verläufe innerhalb der Wellen über ein Space Time Clustering zusammengefasst werden.

Die Funktionsweise des Werkzeugs kann hier nachvollzogen werden:
https://pro.arcgis.com/en/pro-app/latest/tool-reference/space-time-pattern-mining/time-series-clustering.htm

Bei jedem Ausführen des Werkzeugs wird ein anderes Ergebnis berechnet. Dies geschieht aufgrund der zufällig gewählten Startpunkte beim Clustering.

##### kleine Datenmenge (10.12.2020 - 24.12.2020)

Falls das Ergebnis des zu erstellenden Time Series Clustering aus vorherigen Durchläufen bereits vorliegt wird dieses gelöscht.

Das Time Series Clustering wird über die arcpy Funktion **arcpy.stpm.TimeSeriesClustering()** mit Hilfe der Space-Time Cubes berechnet und in der Geodatabase abgelegt.


```python
arcpy.management.Delete(os.path.join(results_dir, 'clust_test'))
arcpy.stpm.TimeSeriesClustering(os.path.join(home_dir, 'stc_Test.nc'), "FAELLEEWZ_7_NONE_ZEROS", os.path.join(results_dir,'clust_test'), "VALUE", '', '', '', 'CREATE_POPUP')
```

    
    - Random Seed: 6516
    
    ----------- Input Space Time Cube Details -----------
    Time step interval                               1 day
                                                          
    Shape Type                                     Polygon
                                                          
    First time step temporal bias                    0.00%
    First time step interval                         after
                                       2020-12-09 00:00:00
                                           to on or before
                                       2020-12-10 00:00:00
                                                          
    Last time step temporal bias                     0.00%
    Last time step interval                          after
                                       2020-12-23 00:00:00
                                           to on or before
                                       2020-12-24 00:00:00
                                                          
    Number of time steps                                15
    Number of locations analyzed                       411
    Number of space time bins analyzed                6165
    -----------------------------------------------------
    
    ------ Pseudo F-Statistic Summary ------
    Number of Clusters      Highest Pseudo F
    2                                491.167
    3                                596.985
    4                                595.661
    5                                646.942
    6                                630.422
    7                                595.829
    8                                564.557
    9                                534.868
    10                               515.814
    ----------------------------------------
    Optimal number of clusters is 5 based on the highest pseudo F-statistic.
    
    
    ------ Trend Statistics for Average Time-Series ------
    Cluster ID     Direction           Statistic     p-value
    1              Increasing             4.6518      0.0000
    2              Increasing             4.6518      0.0000
    3              Increasing             4.7508      0.0000
    4              Increasing             4.7508      0.0000
    5              Not Significant        1.5836      0.1133
    ------------------------------------------------------
    
    - Number of Locations per Cluster -
    Cluster ID      Number of Locations
    1                               176
    2                               112
    3                                84
    4                                28
    5                                11
    -----------------------------------





<div class='gpresult'><h2>Messages</h2><div id='messages' data-messages='["Start Time: Thursday, January 20, 2022 4:14:06 PM","\n- Random Seed: 6516","","----------- Input Space Time Cube Details -----------\nTime step interval                               1 day\n                                                      \nShape Type                                     Polygon\n                                                      \nFirst time step temporal bias                    0.00%\nFirst time step interval                         after\n                                   2020-12-09 00:00:00\n                                       to on or before\n                                   2020-12-10 00:00:00\n                                                      \nLast time step temporal bias                     0.00%\nLast time step interval                          after\n                                   2020-12-23 00:00:00\n                                       to on or before\n                                   2020-12-24 00:00:00\n                                                      \nNumber of time steps                                15\nNumber of locations analyzed                       411\nNumber of space time bins analyzed                6165\n-----------------------------------------------------\n\n------ Pseudo F-Statistic Summary ------\nNumber of Clusters      Highest Pseudo F\n2                                491.167\n3                                596.985\n4                                595.661\n5                                646.942\n6                                630.422\n7                                595.829\n8                                564.557\n9                                534.868\n10                               515.814\n----------------------------------------\nOptimal number of clusters is 5 based on the highest pseudo F-statistic.\n\n\n------ Trend Statistics for Average Time-Series ------\nCluster ID     Direction           Statistic     p-value\n1              Increasing             4.6518      0.0000\n2              Increasing             4.6518      0.0000\n3              Increasing             4.7508      0.0000\n4              Increasing             4.7508      0.0000\n5              Not Significant        1.5836      0.1133\n------------------------------------------------------\n\n- Number of Locations per Cluster -\nCluster ID      Number of Locations\n1                               176\n2                               112\n3                                84\n4                                28\n5                                11\n-----------------------------------","Succeeded at Thursday, January 20, 2022 4:14:09 PM (Elapsed Time: 3.33 seconds)"]' data-show='true'><div id = 'default' /></div></div>



Das Ergebnis der Analyse wird in ein "spatially-enabled" Dataframe umgewandelt um es anzeigen lassen zu können.


```python
clust_Test_sedf = pd.DataFrame.spatial.from_featureclass(os.path.join(results_dir,'clust_test'))
clust_Test_sedf
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>OBJECTID</th>
      <th>LOCATION</th>
      <th>CLUSTER_ID</th>
      <th>CENTER_REP</th>
      <th>HTML_CHART</th>
      <th>SHAPE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>3</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[526513.7528999997, 6075133.411900...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>3</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[575841.5695000002, 6032148.0318],...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[623056.1506000003, 5983746.4452],...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[565015.6516000004, 6000637.513499...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>4</td>
      <td>3</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[479877.7912999997, 5990290.5867],...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>406</th>
      <td>407</td>
      <td>406</td>
      <td>2</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[786759.0349000003, 5831877.2039],...</td>
    </tr>
    <tr>
      <th>407</th>
      <td>408</td>
      <td>407</td>
      <td>2</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[793370.5291999998, 5821756.8627],...</td>
    </tr>
    <tr>
      <th>408</th>
      <td>409</td>
      <td>408</td>
      <td>2</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[796652.4819999998, 5832431.731000...</td>
    </tr>
    <tr>
      <th>409</th>
      <td>410</td>
      <td>409</td>
      <td>2</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[802213.7055000002, 5828350.9388],...</td>
    </tr>
    <tr>
      <th>410</th>
      <td>411</td>
      <td>410</td>
      <td>2</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[798532.9009999996, 5813120.180199...</td>
    </tr>
  </tbody>
</table>
<p>411 rows × 6 columns</p>
</div>



Dieser Layer kann nun angezeigt in einer Karte werden.

Bei der Ausführung kam es bei uns zu einem serverseitigen Anzeigefehler. Daher kann unter [Datenexport](#export) die Geodatabase mit den Ergebnissen der Analysen exportiert werden und das Ergebnnis desktopseitig mit Hilfe von ArcGIS Pro angezeigt werden.


```python
gis = GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis")
clust_Test_map = gis.map("Germany")
#clust_Test_sedf.spatial.plot(clust_Test_map, col="CLUSTER_ID", renderer_type='u', cmap="Set3")
clust_Test_sedf.spatial.plot(clust_Test_map)
clust_Test_map
```

##### 1. Welle (02.03.2020 - 19.04.2020)

Falls das Ergebnis des zu erstellenden Time Series Clustering aus vorherigen Durchläufen bereits vorliegt wird dieses gelöscht.

Das Time Series Clustering wird über die arcpy Funktion **arcpy.stpm.TimeSeriesClustering()** mit Hilfe der Space-Time Cubes berechnet und in der Geodatabase abgelegt.


```python
arcpy.management.Delete(os.path.join(results_dir, 'clust_1W'))
arcpy.stpm.TimeSeriesClustering(os.path.join(home_dir, 'stc_1W.nc'), "FAELLEEWZ_7_MEAN_ZEROS", os.path.join(results_dir,'clust_1W'), "VALUE", '', '', '', 'CREATE_POPUP')
```

    
    - Random Seed: 1047
    
    ----------- Input Space Time Cube Details -----------
    Time step interval                              3 days
                                                          
    Shape Type                                     Polygon
                                                          
    First time step temporal bias                  100.00%
    First time step interval                         after
                                       2020-02-28 00:00:00
                                           to on or before
                                       2020-03-02 00:00:00
                                                          
    Last time step temporal bias                     0.00%
    Last time step interval                          after
                                       2020-04-16 00:00:00
                                           to on or before
                                       2020-04-19 00:00:00
                                                          
    Number of time steps                                17
    Number of locations analyzed                       411
    Number of space time bins analyzed                6987
    -----------------------------------------------------
    
    ------ Pseudo F-Statistic Summary ------
    Number of Clusters      Highest Pseudo F
    2                                343.575
    3                                345.399
    4                                344.554
    5                                349.053
    6                                316.089
    7                                303.930
    8                                284.093
    9                                291.650
    10                               282.693
    ----------------------------------------
    Optimal number of clusters is 5 based on the highest pseudo F-statistic.
    
    
    ---- Trend Statistics for Average Time-Series ---
    Cluster ID     Direction      Statistic     p-value
    1              Increasing        2.9247      0.0034
    2              Increasing        3.2542      0.0011
    3              Increasing        3.5838      0.0003
    4              Increasing        3.6661      0.0002
    5              Increasing        3.2231      0.0013
    -------------------------------------------------
    
    - Number of Locations per Cluster -
    Cluster ID      Number of Locations
    1                               184
    2                               138
    3                                71
    4                                17
    5                                 1
    -----------------------------------





<div class='gpresult'><h2>Messages</h2><div id='messages' data-messages='["Start Time: Thursday, January 20, 2022 4:15:03 PM","\n- Random Seed: 1047","","----------- Input Space Time Cube Details -----------\nTime step interval                              3 days\n                                                      \nShape Type                                     Polygon\n                                                      \nFirst time step temporal bias                  100.00%\nFirst time step interval                         after\n                                   2020-02-28 00:00:00\n                                       to on or before\n                                   2020-03-02 00:00:00\n                                                      \nLast time step temporal bias                     0.00%\nLast time step interval                          after\n                                   2020-04-16 00:00:00\n                                       to on or before\n                                   2020-04-19 00:00:00\n                                                      \nNumber of time steps                                17\nNumber of locations analyzed                       411\nNumber of space time bins analyzed                6987\n-----------------------------------------------------\n\n------ Pseudo F-Statistic Summary ------\nNumber of Clusters      Highest Pseudo F\n2                                343.575\n3                                345.399\n4                                344.554\n5                                349.053\n6                                316.089\n7                                303.930\n8                                284.093\n9                                291.650\n10                               282.693\n----------------------------------------\nOptimal number of clusters is 5 based on the highest pseudo F-statistic.\n\n\n---- Trend Statistics for Average Time-Series ---\nCluster ID     Direction      Statistic     p-value\n1              Increasing        2.9247      0.0034\n2              Increasing        3.2542      0.0011\n3              Increasing        3.5838      0.0003\n4              Increasing        3.6661      0.0002\n5              Increasing        3.2231      0.0013\n-------------------------------------------------\n\n- Number of Locations per Cluster -\nCluster ID      Number of Locations\n1                               184\n2                               138\n3                                71\n4                                17\n5                                 1\n-----------------------------------","Succeeded at Thursday, January 20, 2022 4:15:06 PM (Elapsed Time: 3.00 seconds)"]' data-show='true'><div id = 'default' /></div></div>



Das Ergebnis der Analyse wird in ein "spatially-enabled" Dataframe umgewandelt um es anzeigen lassen zu können.


```python
clust_1W_sedf = pd.DataFrame.spatial.from_featureclass(os.path.join(results_dir,'clust_1W'))
clust_1W_sedf
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>OBJECTID</th>
      <th>LOCATION</th>
      <th>CLUSTER_ID</th>
      <th>CENTER_REP</th>
      <th>HTML_CHART</th>
      <th>SHAPE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[526513.7528999997, 6075133.411900...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[575841.5695000002, 6032148.0318],...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[623056.1506000003, 5983746.4452],...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>3</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[565015.6516000004, 6000637.513499...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>4</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[479877.7912999997, 5990290.5867],...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>406</th>
      <td>407</td>
      <td>406</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[786759.0349000003, 5831877.2039],...</td>
    </tr>
    <tr>
      <th>407</th>
      <td>408</td>
      <td>407</td>
      <td>2</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[793370.5291999998, 5821756.8627],...</td>
    </tr>
    <tr>
      <th>408</th>
      <td>409</td>
      <td>408</td>
      <td>2</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[796652.4819999998, 5832431.731000...</td>
    </tr>
    <tr>
      <th>409</th>
      <td>410</td>
      <td>409</td>
      <td>2</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[802213.7055000002, 5828350.9388],...</td>
    </tr>
    <tr>
      <th>410</th>
      <td>411</td>
      <td>410</td>
      <td>2</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[798532.9009999996, 5813120.180199...</td>
    </tr>
  </tbody>
</table>
<p>411 rows × 6 columns</p>
</div>



Dieser Layer kann nun angezeigt in einer Karte werden.

Bei der Ausführung kam es bei uns zu einem serverseitigen Anzeigefehler. Daher kann unter [Datenexport](#export) die Geodatabase mit den Ergebnissen der Analysen exportiert werden und das Ergebnnis desktopseitig mit Hilfe von ArcGIS Pro angezeigt werden.


```python
gis = GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis")
clust_1W_map = gis.map("Germany")
#clust_1W_sedf.spatial.plot(clust_1W_map, col="CLUSTER_ID", renderer_type='u', cmap="Set3")
clust_1W_sedf.spatial.plot(clust_1W_map)
clust_1W_map
```

##### 2. Welle (05.10.2020 - 31.01.2021)

Falls das Ergebnis des zu erstellenden Time Series Clustering aus vorherigen Durchläufen bereits vorliegt wird dieses gelöscht.

Das Time Series Clustering wird über die arcpy Funktion **arcpy.stpm.TimeSeriesClustering()** mit Hilfe der Space-Time Cubes berechnet und in der Geodatabase abgelegt.


```python
arcpy.management.Delete(os.path.join(results_dir, 'clust_2W'))
arcpy.stpm.TimeSeriesClustering(os.path.join(home_dir, 'stc_2W.nc'), "FAELLEEWZ_7_MEAN_ZEROS", os.path.join(results_dir,'clust_2W'), "VALUE", '', '', '', 'CREATE_POPUP')
```

    
    - Random Seed: 6285
    
    ----------- Input Space Time Cube Details -----------
    Time step interval                              1 week
                                                          
    Shape Type                                     Polygon
                                                          
    First time step temporal bias                   14.29%
    First time step interval                         after
                                       2020-10-04 00:00:00
                                           to on or before
                                       2020-10-11 00:00:00
                                                          
    Last time step temporal bias                     0.00%
    Last time step interval                          after
                                       2021-01-24 00:00:00
                                           to on or before
                                       2021-01-31 00:00:00
                                                          
    Number of time steps                                17
    Number of locations analyzed                       411
    Number of space time bins analyzed                6987
    -----------------------------------------------------
    
    ------ Pseudo F-Statistic Summary ------
    Number of Clusters      Highest Pseudo F
    2                                239.648
    3                                217.090
    4                                211.833
    5                                197.259
    6                                180.188
    7                                167.297
    8                                159.630
    9                                154.939
    10                               142.569
    ----------------------------------------
    Optimal number of clusters is 2 based on the highest pseudo F-statistic.
    
    
    ---- Trend Statistics for Average Time-Series ---
    Cluster ID     Direction      Statistic     p-value
    1              Increasing        2.0184      0.0435
    2              Increasing        3.0894      0.0020
    -------------------------------------------------
    
    - Number of Locations per Cluster -
    Cluster ID      Number of Locations
    1                               367
    2                                44
    -----------------------------------





<div class='gpresult'><h2>Messages</h2><div id='messages' data-messages='["Start Time: Thursday, January 20, 2022 4:15:56 PM","\n- Random Seed: 6285","","----------- Input Space Time Cube Details -----------\nTime step interval                              1 week\n                                                      \nShape Type                                     Polygon\n                                                      \nFirst time step temporal bias                   14.29%\nFirst time step interval                         after\n                                   2020-10-04 00:00:00\n                                       to on or before\n                                   2020-10-11 00:00:00\n                                                      \nLast time step temporal bias                     0.00%\nLast time step interval                          after\n                                   2021-01-24 00:00:00\n                                       to on or before\n                                   2021-01-31 00:00:00\n                                                      \nNumber of time steps                                17\nNumber of locations analyzed                       411\nNumber of space time bins analyzed                6987\n-----------------------------------------------------\n\n------ Pseudo F-Statistic Summary ------\nNumber of Clusters      Highest Pseudo F\n2                                239.648\n3                                217.090\n4                                211.833\n5                                197.259\n6                                180.188\n7                                167.297\n8                                159.630\n9                                154.939\n10                               142.569\n----------------------------------------\nOptimal number of clusters is 2 based on the highest pseudo F-statistic.\n\n\n---- Trend Statistics for Average Time-Series ---\nCluster ID     Direction      Statistic     p-value\n1              Increasing        2.0184      0.0435\n2              Increasing        3.0894      0.0020\n-------------------------------------------------\n\n- Number of Locations per Cluster -\nCluster ID      Number of Locations\n1                               367\n2                                44\n-----------------------------------","Succeeded at Thursday, January 20, 2022 4:15:59 PM (Elapsed Time: 3.09 seconds)"]' data-show='true'><div id = 'default' /></div></div>



Das Ergebnis der Analyse wird in ein "spatially-enabled" Dataframe umgewandelt um es anzeigen lassen zu können.


```python
clust_2W_sedf = pd.DataFrame.spatial.from_featureclass(os.path.join(results_dir,'clust_2W'))
clust_2W_sedf
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>OBJECTID</th>
      <th>LOCATION</th>
      <th>CLUSTER_ID</th>
      <th>CENTER_REP</th>
      <th>HTML_CHART</th>
      <th>SHAPE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[526513.7528999997, 6075133.411900...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[575841.5695000002, 6032148.0318],...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[623056.1506000003, 5983746.4452],...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>3</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[565015.6516000004, 6000637.513499...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>4</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[479877.7912999997, 5990290.5867],...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>406</th>
      <td>407</td>
      <td>406</td>
      <td>2</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[786759.0349000003, 5831877.2039],...</td>
    </tr>
    <tr>
      <th>407</th>
      <td>408</td>
      <td>407</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[793370.5291999998, 5821756.8627],...</td>
    </tr>
    <tr>
      <th>408</th>
      <td>409</td>
      <td>408</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[796652.4819999998, 5832431.731000...</td>
    </tr>
    <tr>
      <th>409</th>
      <td>410</td>
      <td>409</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[802213.7055000002, 5828350.9388],...</td>
    </tr>
    <tr>
      <th>410</th>
      <td>411</td>
      <td>410</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[798532.9009999996, 5813120.180199...</td>
    </tr>
  </tbody>
</table>
<p>411 rows × 6 columns</p>
</div>



Dieser Layer kann nun angezeigt in einer Karte werden.

Bei der Ausführung kam es bei uns zu einem serverseitigen Anzeigefehler. Daher kann unter [Datenexport](#export) die Geodatabase mit den Ergebnissen der Analysen exportiert werden und das Ergebnnis desktopseitig mit Hilfe von ArcGIS Pro angezeigt werden.


```python
gis = GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis")
clust_2W_map = gis.map("Germany")
#clust_2W_sedf.spatial.plot(clust_2W_map, col="CLUSTER_ID", renderer_type='u', cmap="Set3")
clust_2W_sedf.spatial.plot(clust_2W_map)
clust_2W_map
```

##### 3. Welle (01.03.2021 - 16.05.2021)

Falls das Ergebnis des zu erstellenden Time Series Clustering aus vorherigen Durchläufen bereits vorliegt wird dieses gelöscht.

Das Time Series Clustering wird über die arcpy Funktion **arcpy.stpm.TimeSeriesClustering()** mit Hilfe der Space-Time Cubes berechnet und in der Geodatabase abgelegt.


```python
arcpy.management.Delete(os.path.join(results_dir, 'clust_3W'))
arcpy.stpm.TimeSeriesClustering(os.path.join(home_dir, 'stc_3W.nc'), "FAELLEEWZ_7_MEAN_ZEROS", os.path.join(results_dir,'clust_3W'), "VALUE", '', '', '', 'CREATE_POPUP')
```

    
    - Random Seed: 4872
    
    ----------- Input Space Time Cube Details -----------
    Time step interval                              1 week
                                                          
    Shape Type                                     Polygon
                                                          
    First time step temporal bias                   14.29%
    First time step interval                         after
                                       2021-02-28 00:00:00
                                           to on or before
                                       2021-03-07 00:00:00
                                                          
    Last time step temporal bias                     0.00%
    Last time step interval                          after
                                       2021-05-09 00:00:00
                                           to on or before
                                       2021-05-16 00:00:00
                                                          
    Number of time steps                                11
    Number of locations analyzed                       411
    Number of space time bins analyzed                4521
    -----------------------------------------------------
    
    ------ Pseudo F-Statistic Summary ------
    Number of Clusters      Highest Pseudo F
    2                                303.085
    3                                285.452
    4                                248.587
    5                                226.151
    6                                214.919
    7                                202.793
    8                                190.374
    9                                186.982
    10                               175.717
    ----------------------------------------
    Optimal number of clusters is 2 based on the highest pseudo F-statistic.
    
    
    ------ Trend Statistics for Average Time-Series ------
    Cluster ID     Direction           Statistic     p-value
    1              Increasing             2.0241      0.0430
    2              Not Significant        1.2456      0.2129
    ------------------------------------------------------
    
    - Number of Locations per Cluster -
    Cluster ID      Number of Locations
    1                               317
    2                                94
    -----------------------------------





<div class='gpresult'><h2>Messages</h2><div id='messages' data-messages='["Start Time: Thursday, January 20, 2022 4:16:10 PM","\n- Random Seed: 4872","","----------- Input Space Time Cube Details -----------\nTime step interval                              1 week\n                                                      \nShape Type                                     Polygon\n                                                      \nFirst time step temporal bias                   14.29%\nFirst time step interval                         after\n                                   2021-02-28 00:00:00\n                                       to on or before\n                                   2021-03-07 00:00:00\n                                                      \nLast time step temporal bias                     0.00%\nLast time step interval                          after\n                                   2021-05-09 00:00:00\n                                       to on or before\n                                   2021-05-16 00:00:00\n                                                      \nNumber of time steps                                11\nNumber of locations analyzed                       411\nNumber of space time bins analyzed                4521\n-----------------------------------------------------\n\n------ Pseudo F-Statistic Summary ------\nNumber of Clusters      Highest Pseudo F\n2                                303.085\n3                                285.452\n4                                248.587\n5                                226.151\n6                                214.919\n7                                202.793\n8                                190.374\n9                                186.982\n10                               175.717\n----------------------------------------\nOptimal number of clusters is 2 based on the highest pseudo F-statistic.\n\n\n------ Trend Statistics for Average Time-Series ------\nCluster ID     Direction           Statistic     p-value\n1              Increasing             2.0241      0.0430\n2              Not Significant        1.2456      0.2129\n------------------------------------------------------\n\n- Number of Locations per Cluster -\nCluster ID      Number of Locations\n1                               317\n2                                94\n-----------------------------------","Succeeded at Thursday, January 20, 2022 4:16:13 PM (Elapsed Time: 3.46 seconds)"]' data-show='true'><div id = 'default' /></div></div>



Das Ergebnis der Analyse wird in ein "spatially-enabled" Dataframe umgewandelt um es anzeigen lassen zu können.


```python
clust_3W_sedf = pd.DataFrame.spatial.from_featureclass(os.path.join(results_dir,'clust_3W'))
clust_3W_sedf
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>OBJECTID</th>
      <th>LOCATION</th>
      <th>CLUSTER_ID</th>
      <th>CENTER_REP</th>
      <th>HTML_CHART</th>
      <th>SHAPE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[526513.7528999997, 6075133.411900...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[575841.5695000002, 6032148.0318],...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[623056.1506000003, 5983746.4452],...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>3</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[565015.6516000004, 6000637.513499...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>4</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[479877.7912999997, 5990290.5867],...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>406</th>
      <td>407</td>
      <td>406</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[786759.0349000003, 5831877.2039],...</td>
    </tr>
    <tr>
      <th>407</th>
      <td>408</td>
      <td>407</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[793370.5291999998, 5821756.8627],...</td>
    </tr>
    <tr>
      <th>408</th>
      <td>409</td>
      <td>408</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[796652.4819999998, 5832431.731000...</td>
    </tr>
    <tr>
      <th>409</th>
      <td>410</td>
      <td>409</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[802213.7055000002, 5828350.9388],...</td>
    </tr>
    <tr>
      <th>410</th>
      <td>411</td>
      <td>410</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[798532.9009999996, 5813120.180199...</td>
    </tr>
  </tbody>
</table>
<p>411 rows × 6 columns</p>
</div>



Dieser Layer kann nun angezeigt in einer Karte werden.

Bei der Ausführung kam es bei uns zu einem serverseitigen Anzeigefehler. Daher kann unter [Datenexport](#export) die Geodatabase mit den Ergebnissen der Analysen exportiert werden und das Ergebnnis desktopseitig mit Hilfe von ArcGIS Pro angezeigt werden.


```python
gis = GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis")
clust_3W_map = gis.map("Germany")
#clust_3W_sedf.spatial.plot(clust_3W_map, col="CLUSTER_ID", renderer_type='u', cmap="Set3")
clust_3W_sedf.spatial.plot(clust_3W_map)
clust_3W_map
```

##### 4. Welle (04.10.2021 - 02.01.2022)

Falls das Ergebnis des zu erstellenden Time Series Clustering aus vorherigen Durchläufen bereits vorliegt wird dieses gelöscht.

Das Time Series Clustering wird über die arcpy Funktion **arcpy.stpm.TimeSeriesClustering()** mit Hilfe der Space-Time Cubes berechnet und in der Geodatabase abgelegt.


```python
arcpy.management.Delete(os.path.join(results_dir, 'clust_4W'))
arcpy.stpm.TimeSeriesClustering(os.path.join(home_dir, 'stc_4W.nc'), "FAELLEEWZ_7_MEAN_ZEROS", os.path.join(results_dir,'clust_4W'), "VALUE", '', '', '', 'CREATE_POPUP')
```

    
    - Random Seed: 3630
    
    ----------- Input Space Time Cube Details -----------
    Time step interval                              1 week
                                                          
    Shape Type                                     Polygon
                                                          
    First time step temporal bias                   14.29%
    First time step interval                         after
                                       2021-10-03 00:00:00
                                           to on or before
                                       2021-10-10 00:00:00
                                                          
    Last time step temporal bias                     0.00%
    Last time step interval                          after
                                       2021-12-26 00:00:00
                                           to on or before
                                       2022-01-02 00:00:00
                                                          
    Number of time steps                                13
    Number of locations analyzed                       411
    Number of space time bins analyzed                5343
    -----------------------------------------------------
    
    ------ Pseudo F-Statistic Summary ------
    Number of Clusters      Highest Pseudo F
    2                                489.769
    3                                499.579
    4                                456.322
    5                                435.479
    6                                416.585
    7                                404.540
    8                                375.463
    9                                348.351
    10                               357.360
    ----------------------------------------
    Optimal number of clusters is 3 based on the highest pseudo F-statistic.
    
    
    ---- Trend Statistics for Average Time-Series ---
    Cluster ID     Direction      Statistic     p-value
    1              Increasing        2.7454      0.0060
    2              Increasing        2.1353      0.0327
    3              Increasing        2.2573      0.0240
    -------------------------------------------------
    
    - Number of Locations per Cluster -
    Cluster ID      Number of Locations
    1                               218
    2                               151
    3                                42
    -----------------------------------





<div class='gpresult'><h2>Messages</h2><div id='messages' data-messages='["Start Time: Thursday, January 20, 2022 4:16:26 PM","\n- Random Seed: 3630","","----------- Input Space Time Cube Details -----------\nTime step interval                              1 week\n                                                      \nShape Type                                     Polygon\n                                                      \nFirst time step temporal bias                   14.29%\nFirst time step interval                         after\n                                   2021-10-03 00:00:00\n                                       to on or before\n                                   2021-10-10 00:00:00\n                                                      \nLast time step temporal bias                     0.00%\nLast time step interval                          after\n                                   2021-12-26 00:00:00\n                                       to on or before\n                                   2022-01-02 00:00:00\n                                                      \nNumber of time steps                                13\nNumber of locations analyzed                       411\nNumber of space time bins analyzed                5343\n-----------------------------------------------------\n\n------ Pseudo F-Statistic Summary ------\nNumber of Clusters      Highest Pseudo F\n2                                489.769\n3                                499.579\n4                                456.322\n5                                435.479\n6                                416.585\n7                                404.540\n8                                375.463\n9                                348.351\n10                               357.360\n----------------------------------------\nOptimal number of clusters is 3 based on the highest pseudo F-statistic.\n\n\n---- Trend Statistics for Average Time-Series ---\nCluster ID     Direction      Statistic     p-value\n1              Increasing        2.7454      0.0060\n2              Increasing        2.1353      0.0327\n3              Increasing        2.2573      0.0240\n-------------------------------------------------\n\n- Number of Locations per Cluster -\nCluster ID      Number of Locations\n1                               218\n2                               151\n3                                42\n-----------------------------------","Succeeded at Thursday, January 20, 2022 4:16:31 PM (Elapsed Time: 4.30 seconds)"]' data-show='true'><div id = 'default' /></div></div>



Das Ergebnis der Analyse wird in ein "spatially-enabled" Dataframe umgewandelt um es anzeigen lassen zu können.


```python
clust_4W_sedf = pd.DataFrame.spatial.from_featureclass(os.path.join(results_dir,'clust_4W'))
clust_4W_sedf
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>OBJECTID</th>
      <th>LOCATION</th>
      <th>CLUSTER_ID</th>
      <th>CENTER_REP</th>
      <th>HTML_CHART</th>
      <th>SHAPE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[526513.7528999997, 6075133.411900...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[575841.5695000002, 6032148.0318],...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[623056.1506000003, 5983746.4452],...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>3</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[565015.6516000004, 6000637.513499...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>4</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[479877.7912999997, 5990290.5867],...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>406</th>
      <td>407</td>
      <td>406</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[786759.0349000003, 5831877.2039],...</td>
    </tr>
    <tr>
      <th>407</th>
      <td>408</td>
      <td>407</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[793370.5291999998, 5821756.8627],...</td>
    </tr>
    <tr>
      <th>408</th>
      <td>409</td>
      <td>408</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[796652.4819999998, 5832431.731000...</td>
    </tr>
    <tr>
      <th>409</th>
      <td>410</td>
      <td>409</td>
      <td>2</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[802213.7055000002, 5828350.9388],...</td>
    </tr>
    <tr>
      <th>410</th>
      <td>411</td>
      <td>410</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;html&gt;\n    &lt;head&gt;\n      &lt;meta charset = "utf...</td>
      <td>{"rings": [[[798532.9009999996, 5813120.180199...</td>
    </tr>
  </tbody>
</table>
<p>411 rows × 6 columns</p>
</div>



Dieser Layer kann nun angezeigt in einer Karte werden.

Bei der Ausführung kam es bei uns zu einem serverseitigen Anzeigefehler. Daher kann unter [Datenexport](#export) die Geodatabase mit den Ergebnissen der Analysen exportiert werden und das Ergebnnis desktopseitig mit Hilfe von ArcGIS Pro angezeigt werden.


```python
gis = GIS(url="https://arcgis.services.fbbgg.hs-woe.de/arcgis")
clust_4W_map = gis.map("Germany")
#clust_4W_sedf.spatial.plot(clust_4W_map, col="CLUSTER_ID", renderer_type='u', cmap="Set3")
clust_4W_sedf.spatial.plot(clust_4W_map)
clust_4W_map
```

## Datenexport <a class="anchor" id="export"></a>

Über den folgenden Ablauf kann die Geodatabase im home-Verzeichnis des ArcGIS-Enterprise heruntergeladen werden. Diese kann entpackt und in ArcGIS Pro eingeladen werden. Damit können alle darin enthaltenen Ergebnisse angezeigt werden.


```python
import zipfile
zip = zipfile.ZipFile(os.path.join(home_dir, 'Results.zip'), 'w', zipfile.ZIP_DEFLATED)
path = os.path.normpath(results_dir)
for (dirpath, dirnames, filenames) in os.walk(path):
    for file in filenames:
        zip.write(os.path.join(dirpath, file),
        os.path.join(os.path.basename(path), os.path.join(dirpath, file)[len(path)+len(os.sep):]))
zip.close()
```
